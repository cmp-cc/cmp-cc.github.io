----
title: 贫血模型和充血模型
date: 2013-12-14 16:53:00
categories: 
- 架构设计
tags:
- DDD (领域驱动设计)
- Java
----

大多数情况下，我忍不住赋予Model行为，我并不知道它是否合理，了解一下领域模型中的贫血模型和充血模型，无意中发现还有胀血模型和失血模型。 如下是自己（cmp-cc）的理解：

## 模型 （Model）
* 无论是贫血模型还是充血模型，他们都符合POJO （也可以认为JavaBean）。
**Model包含属性的`get`、`set`方法**
* 模型的本质充当数据容器（保存状态，传递状态）。
**模型是一种特殊的数据结构**


## 失血模型
**失血模型就是POJO对象，模型仅仅包含数据的定义和getter/setter方法，业务逻辑和应用逻辑都放到服务层（Service）中。** 

层次表示：
> UI(视图层) -> Control(控制层) -> Service（服务层） -> DAO （持久化层） ->domain object （领域对象 Model ）

* 领域对象不具备任何行为（仅仅是一个POJO对象），所有的行为都在Service层。
* 领域对象的作用。
   * 充当数据容器。
   * 对象关系映射（ORM）
* 这种模型很容易理解和掌握。
* 优点
   * 层次结构清晰，单项依赖，易于维护。
* 缺点
   * Service 层挤压严重。（业务逻辑职责） 
   * 部分与数据操作相关的行为，必须通过Service层进行修改。

## 贫血模型
**贫血模型中包含了一些业务逻辑，但不包含依赖持久层的业务逻辑。这部分依赖于持久层的业务逻辑将会放到服务层中。**

层次表示：
> UI(视图层) -> Control(控制层) -> Service（服务层） -> DAO （持久化层） ->domain object （Model）

* 继承失血模型特性
* 领域对象具备简单行为，如下特点。
    * 行为不具备持久化特性。（不与数据库打交道，也就是不依赖于DAO层）
    * 具备与数据相关的业务行为。（部分Service行为 移至 Model）
* 同样与失血模型同样的痛处
   * 系统越复杂，维护成本越高，Service层（业务逻辑）挤压严重。

## 充血模型
**充血模型中包含了所有的业务逻辑，包括依赖于持久层的业务逻辑。所以，使用充血模型的领域层是依赖于持久层。

层次表示：
> UI -> Control -> Service -> domain object <--> DAO

* Service 层被减轻，不和DAO打交道，只包含业务逻辑。
*  领域对象 和 DAO 双向依赖。
* 优点
   * 减轻了Service层。
* 缺点
   * Service 将直接依赖于领域对象。 领域对象同样具备部分业务，可能会造成职责混乱，或者使领域对象不具备业务I行为
   * 领域对象与DAO双向依赖，部分职责容易混响。



## 胀血模型
**胀血模型就是把和业务逻辑不想关的其他应用逻辑（如授权、事务等）都放到领域模型中。我感觉胀血模型反而是另外一种的失血模型，因为服务层消失了，领域层干了服务层的事，到头来还是什么都没变。**

层次表示：
> UI -> Control -> domain object <--> DAO

* 没有了服务层，领域对象包含所有业务逻辑，并双向依赖与持久化层。
* 优点
   * 分层极其简单
* 缺点
   * 领域对象职责过多，挤压严重，极其不稳定，不易维护。
   * 控制层访问领域对象能够看到不必要的行为。


## 总结
失血模型和胀血模型并不被提倡，主要原因：领域模型内聚职责过少，或者过多。
关于贫血模型和充血模型的选型，其实跟语言架构有关（Robin提出）：
* 如果使用Spring，必须贫血模型。
* 如果使用RoR，直接充血模型。





#### 参考
http://blog.csdn.net/always_my_fault/article/details/2063612
http://www.oschina.net/question/54100_10400
http://www.360doc.com/content/12/0423/03/9318309_205785083.shtml