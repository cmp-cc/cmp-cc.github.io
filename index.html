<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="I am cmp-cc" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="I am cmp-cc">
<meta property="og:url" content="http://cmp-cc.github.io/index.html">
<meta property="og:site_name" content="I am cmp-cc">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="I am cmp-cc">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> I am cmp-cc </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?0fb6f1a75a76726c10a144a8257465e3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">I am cmp-cc</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">一直在打杂，从未被超越。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/30/2016/Gradle 使用异常处理/" itemprop="url">
                  Gradle 使用异常处理
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-30T14:43:00+08:00" content="2016-05-30">
              2016-05-30
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Project-Build/" itemprop="url" rel="index">
                    <span itemprop="name">Project Build</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Project-Build/Gradle/" itemprop="url" rel="index">
                    <span itemprop="name">Gradle</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/30/2016/Gradle 使用异常处理/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/30/2016/Gradle 使用异常处理/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>Gradle 使用遇到的异常及其解决方案，持续更新</strong></p>
<h2 id="Xlint-unchecked"><a href="#Xlint-unchecked" class="headerlink" title="-Xlint:unchecked"></a>-Xlint:unchecked</h2><h3 id="异常描述"><a href="#异常描述" class="headerlink" title="异常描述"></a>异常描述</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">:azkaban-common:compileJava  </span><br><span class="line">C:\Users\root\.gradle\caches\modules-2\files-2.1\com.google.guava\guava\13.0.1\d6f22b1e60a2f1ef99e22c9f5fde270b2088365\guava-13.0.1.jar(com/google/common/util/concurrent/Monitor.class): 警告: 无法找到类型 &apos;GuardedBy&apos; 的注释方法 &apos;value()&apos;: 找不到javax.annotation.concurrent.GuardedBy的类文件</span><br><span class="line">C:\Users\root\.gradle\caches\modules-2\files-2.1\com.google.guava\guava\13.0.1\d6f22b1e60a2f1ef99e22c9f5fde270b2088365\guava-13.0.1.jar(com/google/common/util/concurrent/Monitor.class): 警告: 无法找到类型 &apos;GuardedBy&apos; 的注释方法 &apos;value()&apos;</span><br><span class="line">C:\Users\root\.gradle\caches\modules-2\files-2.1\com.google.guava\guava\13.0.1\d6f22b1e60a2f1ef99e22c9f5fde270b2088365\guava-13.0.1.jar(com/google/common/util/concurrent/Monitor.class): 警告: 无法找到类型 &apos;GuardedBy&apos; 的注释方法 &apos;value()&apos;</span><br><span class="line">C:\Users\root\.gradle\caches\modules-2\files-2.1\com.google.guava\guava\13.0.1\d6f22b1e60a2f1ef99e22c9f5fde270b2088365\guava-13.0.1.jar(com/google/common/util/concurrent/Monitor.class): 警告: 无法找到类型 &apos;GuardedBy&apos; 的注释方法 &apos;value()&apos;</span><br><span class="line">C:\Users\root\.gradle\caches\modules-2\files-2.1\com.google.guava\guava\13.0.1\d6f22b1e60a2f1ef99e22c9f5fde270b2088365\guava-13.0.1.jar(com/google/common/util/concurrent/Monitor.class): 警告: 无法找到类型 &apos;GuardedBy&apos; 的注释方法 &apos;value()&apos;</span><br><span class="line">C:\Users\root\.gradle\caches\modules-2\files-2.1\com.google.guava\guava\13.0.1\d6f22b1e60a2f1ef99e22c9f5fde270b2088365\guava-13.0.1.jar(com/google/common/util/concurrent/Monitor.class): 警告: 无法找到类型 &apos;GuardedBy&apos; 的注释方法 &apos;value()&apos;</span><br><span class="line">C:\Users\root\.gradle\caches\modules-2\files-2.1\com.google.guava\guava\13.0.1\d6f22b1e60a2f1ef99e22c9f5fde270b2088365\guava-13.0.1.jar(com/google/common/util/concurrent/Monitor.class): 警告: 无法找到类型 &apos;GuardedBy&apos; 的注释方法 &apos;value()&apos;</span><br><span class="line">C:\Users\root\.gradle\caches\modules-2\files-2.1\com.google.guava\guava\13.0.1\d6f22b1e60a2f1ef99e22c9f5fde270b2088365\guava-13.0.1.jar(com/google/common/util/concurrent/Monitor.class): 警告: 无法找到类型 &apos;GuardedBy&apos; 的注释方法 &apos;value()&apos;</span><br><span class="line">C:\Users\root\Desktop\笔记\Azkaban\Resources\azkaban-new\azkaban-master\azkaban-common\src\main\java\azkaban\executor\ExecutorInfo.java:109: 警告: [EqualsHashCode] Classes that override equals should also override hashCode.</span><br><span class="line">    public boolean equals(Object obj)</span><br><span class="line">                   ^</span><br><span class="line">    (see http://errorprone.info/bugpattern/EqualsHashCode)</span><br><span class="line">注: 某些输入文件使用了未经检查或不安全的操作。</span><br><span class="line">注: 有关详细信息, 请使用 -Xlint:unchecked 重新编译。</span><br><span class="line">9 个警告</span><br></pre></td></tr></table></figure>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>参考：<a href="http://stackoverflow.com/questions/18689365/how-to-add-xlintunchecked-to-my-android-gradle-based-project" target="_blank" rel="external">http://stackoverflow.com/questions/18689365/how-to-add-xlintunchecked-to-my-android-gradle-based-project</a></p>
<p>Gradle 添加如下配置，可消除Java编译警告<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Gradle wrapper task.</span><br><span class="line"> * 当前的Gradle 版本</span><br><span class="line"> */</span><br><span class="line">task wrapper(type: Wrapper) &#123;</span><br><span class="line">  gradleVersion = &apos;2.13&apos;</span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">allprojects &#123;</span><br><span class="line">    gradle.projectsEvaluated &#123;</span><br><span class="line">        tasks.withType(JavaCompile) &#123;</span><br><span class="line">            options.compilerArgs &lt;&lt; &quot;-Xlint:unchecked&quot; &lt;&lt; &quot;-Xlint:deprecation&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/27/2016/Azkaban 工作流升级3.0/" itemprop="url">
                  Azkaban 工作流升级3.0
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-27T14:06:00+08:00" content="2016-05-27">
              2016-05-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Workflow/" itemprop="url" rel="index">
                    <span itemprop="name">Workflow</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Workflow/Bigdata-Workflow/" itemprop="url" rel="index">
                    <span itemprop="name">Bigdata Workflow</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/27/2016/Azkaban 工作流升级3.0/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/27/2016/Azkaban 工作流升级3.0/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>前一段时间安装部署Azkaban 2.5 版本，数据运维的童鞋在使用中，确实解决了脚本工作流（依赖）、调度、监控等问题。</p>
<ul>
<li>但是Azkaban还是存在很多问题和不足<ul>
<li>不支持远程脚本调度（必须在固定的机器、没有远程登陆）</li>
<li>创建项目不支持中文 （这个Bug一直没有修复）</li>
<li>日志使用高级查询，通过Filter过滤时间，会出现时间格式转换异常。</li>
<li>等等</li>
</ul>
</li>
</ul>
<p><strong>Azkaban 3.0 虽然没有正式推出，但可以投入使用，也希望解决一下简单问题</strong></p>
<p>Azkaban 3.0 目前只能源码安装。</p>
<ul>
<li>升级Azkaban 3.0 分为如下三个步骤<ul>
<li>构建Azkaban源码，生成Zip或者Gz包</li>
<li>导入Azkaban3.0 数据库</li>
<li>配置启动<code>azkaban-web-server</code> 和 <code>azkaban-exec-server</code></li>
</ul>
</li>
</ul>
<h2 id="构建Azkaban-源码"><a href="#构建Azkaban-源码" class="headerlink" title="构建Azkaban 源码"></a>构建Azkaban 源码</h2><p>你可以选择如下方式的一种</p>
<h3 id="一个新环境下构建"><a href="#一个新环境下构建" class="headerlink" title="一个新环境下构建"></a>一个新环境下构建</h3><p><strong>安装Linux 基础工具、Java环境、Git</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo yum groupinstall -y &quot;Development Tools&quot;</span><br><span class="line">sudo yum install -y java-1.7.0-openjdk.x86_64 java-1.7.0-openjdk-devel.x86_64 git mysql-connector-java</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>如果有<code>Java环境 和Git</code>忽略如上</p>
</blockquote>
<p><strong>编译azkaban</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/azkaban/azkaban.git</span><br><span class="line">cd azkaban</span><br><span class="line">./gradlew distZip</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>distZip</code> 构建zip文件。如果使用<code>distTar</code>表示生成tar文件。 </p>
</blockquote>
<hr>
<h3 id="可能遇到的异常"><a href="#可能遇到的异常" class="headerlink" title="可能遇到的异常"></a>可能遇到的异常</h3><p><strong>你需要多少执行，甚至需要手工编译</strong></p>
<ul>
<li>无法更新依赖<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">FAILURE: Build failed with an exception.</span><br><span class="line"></span><br><span class="line">* What went wrong:</span><br><span class="line">A problem occurred configuring root project &apos;azkaban&apos;.</span><br><span class="line">&gt; Could not resolve all dependencies for configuration &apos;:classpath&apos;.</span><br><span class="line">   &gt; Could not resolve net.ltgt.gradle:gradle-errorprone-plugin:0.0.8.</span><br><span class="line">     Required by:</span><br><span class="line">         com.linkedin:azkaban:3.0.0</span><br><span class="line">      &gt; Could not GET &apos;https://plugins.gradle.org/m2/net/ltgt/gradle/gradle-errorprone-plugin/0.0.8/gradle-errorprone-plugin-0.0.8.pom&apos;.</span><br><span class="line">         &gt; peer not authenticated</span><br><span class="line"></span><br><span class="line">* Try:</span><br><span class="line">Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.</span><br><span class="line"></span><br><span class="line">BUILD FAILED</span><br><span class="line"></span><br><span class="line">Total time: 45.497 secs</span><br><span class="line">[root@test-liupengwei azkaban]# vi build.gradle</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>如上是网络的原因，无法到<code>https://plugins.gradle.org/m2/</code>下载Gradle 插件</p>
</blockquote>
<ul>
<li>构建失败<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">    (see http://errorprone.info/bugpattern/WaitNotInLoop)</span><br><span class="line">/root/build2/azkaban-3.0.0/azkaban-execserver/src/test/java/azkaban/execapp/event/BlockingStatusTest.java:86: warning: [WaitNotInLoop] Because of spurious wakeups, wait(long) must always be called in a loop</span><br><span class="line">      wait(3000);</span><br><span class="line">          ^</span><br><span class="line">    (see http://errorprone.info/bugpattern/WaitNotInLoop)</span><br><span class="line">/root/build2/azkaban-3.0.0/azkaban-execserver/src/test/java/azkaban/execapp/event/BlockingStatusTest.java:92: warning: [WaitNotInLoop] Because of spurious wakeups, wait(long) must always be called in a loop</span><br><span class="line">      wait(1000);</span><br><span class="line">          ^</span><br><span class="line">    (see http://errorprone.info/bugpattern/WaitNotInLoop)</span><br><span class="line">/root/build2/azkaban-3.0.0/azkaban-execserver/src/test/java/azkaban/execapp/event/BlockingStatusTest.java:111: warning: [WaitNotInLoop] Because of spurious wakeups, wait(long) must always be called in a loop</span><br><span class="line">      wait(2000);</span><br><span class="line">          ^</span><br><span class="line">    (see http://errorprone.info/bugpattern/WaitNotInLoop)</span><br><span class="line">/root/build2/azkaban-3.0.0/azkaban-execserver/src/test/java/azkaban/execapp/event/BlockingStatusTest.java:118: warning: [WaitNotInLoop] Because of spurious wakeups, wait(long) must always be called in a loop</span><br><span class="line">      wait(2000);</span><br><span class="line">          ^</span><br><span class="line">    (see http://errorprone.info/bugpattern/WaitNotInLoop)</span><br><span class="line">16 warnings</span><br><span class="line">:azkaban-execserver:processTestResources UP-TO-DATE</span><br><span class="line">:azkaban-execserver:testClasses</span><br><span class="line">:azkaban-execserver:test</span><br><span class="line"></span><br><span class="line">azkaban.execapp.event.BlockingStatusTest &gt; testUnfinishedBlockSeveralChanges FAILED</span><br><span class="line">    java.lang.AssertionError at BlockingStatusTest.java:100</span><br><span class="line"></span><br><span class="line">71 tests completed, 1 failed, 40 skipped</span><br><span class="line">:azkaban-execserver:test FAILED</span><br><span class="line"></span><br><span class="line">FAILURE: Build failed with an exception.</span><br><span class="line"></span><br><span class="line">* What went wrong:</span><br><span class="line">Execution failed for task &apos;:azkaban-execserver:test&apos;.</span><br><span class="line">&gt; There were failing tests. See the report at: file:///root/build2/azkaban-3.0.0/azkaban-execserver/build/reports/tests/index.html</span><br><span class="line"></span><br><span class="line">* Try:</span><br><span class="line">Run with --stacktrace option to get the stack trace. Run with --info or --debug option to get more log output.</span><br><span class="line"></span><br><span class="line">BUILD FAILED</span><br><span class="line"></span><br><span class="line">Total time: 15 mins 44.721 secs</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>如上异常是因为构建过程中部分单元测试无法通过。</p>
</blockquote>
<h3 id="手工-构建（Gradle）Azkaban"><a href="#手工-构建（Gradle）Azkaban" class="headerlink" title="手工 构建（Gradle）Azkaban"></a>手工 构建（Gradle）Azkaban</h3><ul>
<li><p>下载Gradle，并配置环境变量</p>
<ul>
<li><a href="https://services.gradle.org/distributions/gradle-2.13-all.zip" target="_blank" rel="external">https://services.gradle.org/distributions/gradle-2.13-all.zip</a></li>
<li>环境path 下添加bin路径</li>
</ul>
</li>
<li><p>修改build.gradle Maven数据源 （可选）<br><strong>如果下载依赖缓慢可配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">  repositories &#123;</span><br><span class="line">   /**</span><br><span class="line">    * 如下增加 jcenter()  源 或 oschain源</span><br><span class="line">    */</span><br><span class="line">    jcenter()  </span><br><span class="line">    mavenCentral()</span><br><span class="line">    maven &#123;</span><br><span class="line">      url &apos;https://plugins.gradle.org/m2/&apos;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  dependencies &#123;</span><br><span class="line">    classpath &apos;com.linkedin:gradle-dustjs-plugin:1.0.0&apos;</span><br><span class="line">    classpath &apos;de.obqo.gradle:gradle-lesscss-plugin:1.0-1.3.3&apos;</span><br><span class="line">    classpath &apos;net.ltgt.gradle:gradle-errorprone-plugin:0.0.8&apos;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">apply plugin: &apos;distribution&apos;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">  repositories &#123;</span><br><span class="line">    /**</span><br><span class="line">    * 如下增加 jcenter()  源 或 oschain源</span><br><span class="line">    */</span><br><span class="line">    jcenter()</span><br><span class="line">    mavenCentral()</span><br><span class="line">    mavenLocal()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>忽略部分单元测试<br><strong>有些Unit命令无法执行,并不推荐在Window中进行Azkaban源码构建</strong></p>
<ul>
<li><p>修改<code>azkaban\azkaban-common\src\test\java\azkaban\jobExecutor\ProcessJobTest.java</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/*</span><br><span class="line">  @Test</span><br><span class="line">  public void testFailedUnixCommand() throws Exception &#123;</span><br><span class="line">    // Initialize the Props</span><br><span class="line">    props.put(ProcessJob.COMMAND, &quot;xls -al&quot;);</span><br><span class="line"></span><br><span class="line">    try &#123;</span><br><span class="line">      job.run();</span><br><span class="line">    &#125; catch (RuntimeException e) &#123;</span><br><span class="line">      Assert.assertTrue(true);</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">*/</span><br><span class="line">/*  @Test</span><br><span class="line">  public void testMultipleUnixCommands() throws Exception &#123;</span><br><span class="line">    // Initialize the Props</span><br><span class="line">    props.put(ProcessJob.COMMAND, &quot;pwd&quot;);  //window 没有pwd命令</span><br><span class="line">    props.put(&quot;command.1&quot;, &quot;date&quot;);</span><br><span class="line">    props.put(&quot;command.2&quot;, &quot;whoami&quot;);</span><br><span class="line"></span><br><span class="line">    job.run();</span><br><span class="line">  &#125;</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改<code>azkaban\azkaban-common\src\test\java\azkaban\jobExecutor\PythonJobTest.java</code><br><strong>Window 构建修改，Linux构建不需要修改</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">    @BeforeClass</span><br><span class="line">public static void init() &#123;</span><br><span class="line"></span><br><span class="line">  long time = (new Date()).getTime();</span><br><span class="line">  scriptFile = &quot;d:/tmp/azkaban_python&quot; + time + &quot;.py&quot;;   //选择一个window盘符</span><br><span class="line">  // dump script file</span><br><span class="line">  try &#123;</span><br><span class="line">    Utils.dumpFile(scriptFile, scriptContent);</span><br><span class="line">  &#125; catch (IOException e) &#123;</span><br><span class="line">    e.printStackTrace(System.err);</span><br><span class="line">    Assert.fail(&quot;error in creating script file:&quot; + e.getLocalizedMessage());</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>执行如下命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gradle distZip --debug</span><br></pre></td></tr></table></figure>
</li>
<li><p>构建成功<br><strong>查看：azkaban\build\distributions目录</strong></p>
</li>
</ul>
<img src="/2016/05/27/2016/Azkaban%20工作流升级3.0/a3c3e5d8-87b1-46fc-bd60-36892b1861e1.png" alt="安装成功文件" title="安装成功文件">
<h2 id="安装Azkaban"><a href="#安装Azkaban" class="headerlink" title="安装Azkaban"></a>安装Azkaban</h2><p>关于Azkaban的安装，请参考<a href="http://cmp-cc.github.io/2016/04/27/2016/%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%B7%A5%E4%BD%9C%E6%B5%81%20Azkaban%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/">这篇文件：Azkaban2.5安装指南</a></p>
<ul>
<li>不同之处，你需要使用自己编译的Azkaban3.0进行配置。 数据库导入<code>azkaban.sql-3.0.0.zip</code>中<code>create-all-sql-3.0.0.sql</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd azkaban/build/distributions/ </span><br><span class="line">zunip azkaban-sql-3.0.0.zip</span><br><span class="line">cd azkaban-sql-3.0.0</span><br><span class="line">mysql -uroot -p -D azkaban2 &lt; create-all-sql-3.0.0.sql</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>注意：azkaban2 数据库必须存在</p>
</blockquote>
<ul>
<li>同时你需要要执行<code>azkaban.sql-3.0.0.zip</code>中<code>update.active_executing_flows.3.0.sql</code>和<code>update.execution_flows.3.0.sql</code>文件,如果不执行，可能会出现如下异常<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; azkaban.executor.ExecutorManagerException: Error fetching active flows</span><br><span class="line">        at azkaban.executor.JdbcExecutorLoader.fetchActiveFlows(JdbcExecutorLoader.java:216)</span><br><span class="line">        at azkaban.executor.ExecutorManager.loadRunningFlows(ExecutorManager.java:431)</span><br><span class="line">        at azkaban.executor.ExecutorManager.&lt;init&gt;(ExecutorManager.java:126)</span><br><span class="line">        at azkaban.webapp.AzkabanWebServer.loadExecutorManager(AzkabanWebServer.java:261)</span><br><span class="line">        at azkaban.webapp.AzkabanWebServer.&lt;init&gt;(AzkabanWebServer.java:197)</span><br><span class="line">        at azkaban.webapp.AzkabanWebServer.main(AzkabanWebServer.java:739)</span><br><span class="line">Caused by: java.sql.SQLException: Unknown column &apos;ex.executor_id&apos; in &apos;on clause&apos; Query: SELECT ex.exec_id exec_id, ex.enc_type enc_type, ex.flow_data flow_data, et.host host, et.port port, ax.update_time axUpdateTime, et.id executorId, et.active executorStatus FROM execution_flows ex INNER JOIN  active_executing_flows ax ON ex.exec_id = ax.exec_id INNER JOIN  executors et ON ex.executor_id = et.id Parameters: []</span><br><span class="line">        at org.apache.commons.dbutils.AbstractQueryRunner.rethrow(AbstractQueryRunner.java:363)</span><br><span class="line">        at org.apache.commons.dbutils.QueryRunner.query(QueryRunner.java:350)</span><br><span class="line">        at org.apache.commons.dbutils.QueryRunner.query(QueryRunner.java:306)</span><br><span class="line">        at azkaban.executor.JdbcExecutorLoader.fetchActiveFlows(JdbcExecutorLoader.java:212)</span><br><span class="line">        ... 5 more</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p -D azkaban2 &lt; update.active_executing_flows.3.0.sql</span><br><span class="line">mysql -uroot -p -D azkaban2 &lt; update.execution_flows.3.0.sql</span><br></pre></td></tr></table></figure>
<p>其他相关步骤查看如上文章，安装过程过程大同小异。</p>
<h2 id="可能会遇到的异常"><a href="#可能会遇到的异常" class="headerlink" title="可能会遇到的异常"></a>可能会遇到的异常</h2><ul>
<li><p><strong>解压后的<code>azkaban-web-server-3.0.0</code>和<code>azkaban-exec-server-3.0.0</code>的bin目录下的<code>.sh</code> 均没有可执行权限</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd azkaban-web-server-3.0.0</span><br><span class="line">chmod -R 777 bin/*.sh</span><br><span class="line"></span><br><span class="line">// exec 同理</span><br></pre></td></tr></table></figure>
</li>
<li><p><strong>执行sh出现/bin/bash^M: bad interpreter: No such file or directory</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// 如上原因是因为使用了window构建，linux不识别此文件</span><br><span class="line"></span><br><span class="line">vi azkaban-web-start.sh</span><br><span class="line"></span><br><span class="line">:set ff=nuix</span><br><span class="line">:wq</span><br></pre></td></tr></table></figure></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/18/2016/Jython 异常及其解决方案/" itemprop="url">
                  Jython 异常及其解决方案
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-18T17:26:00+08:00" content="2016-05-18">
              2016-05-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Programming-Language/" itemprop="url" rel="index">
                    <span itemprop="name">Programming Language</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Programming-Language/Jython/" itemprop="url" rel="index">
                    <span itemprop="name">Jython</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/18/2016/Jython 异常及其解决方案/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/18/2016/Jython 异常及其解决方案/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Jython 确实很少玩，也记录一下异常信息和解决方案把,如果以后有涉及，持续更新。</p>
<h2 id="cp0"><a href="#cp0" class="headerlink" title="cp0"></a>cp0</h2><h3 id="异常信息"><a href="#异常信息" class="headerlink" title="异常信息"></a>异常信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console: Failed to install &apos;&apos;: java.nio.charset.UnsupportedCharsetException: cp0.</span><br></pre></td></tr></table></figure>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">eclipse.ini 设置 -Dpython.console.encoding=UTF-8</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line"></span><br><span class="line">Window -&gt; Preferences -&gt; Java -&gt; installed JRES -&gt; Edit 设置如下：</span><br><span class="line">Default VM arguments: -Dpython.console.encoding=UTF-8</span><br></pre></td></tr></table></figure>
<img src="/2016/05/18/2016/Jython%20异常及其解决方案/6c1429b8-0e58-4c24-b2c4-58e63a4b771e.png" alt="JVM 设置" title="JVM 设置">
<h2 id="No-module-named-site"><a href="#No-module-named-site" class="headerlink" title="No module named site"></a>No module named site</h2><h3 id="异常信息-1"><a href="#异常信息-1" class="headerlink" title="异常信息"></a>异常信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ImportError: Cannot import site module and its dependencies: No module named site</span><br><span class="line">Determine if the following attributes are correct:</span><br><span class="line">  * sys.path: [&apos;C:\\Users\\root\\.m2\\repository\\org\\python\\jython\\2.7.0\\Lib&apos;, &apos;__classpath__&apos;, &apos;__pyclasspath__/&apos;]</span><br><span class="line">    This attribute might be including the wrong directories, such as from CPython</span><br><span class="line">  * sys.prefix: C:\Users\root\.m2\repository\org\python\jython\2.7.0</span><br><span class="line">    This attribute is set by the system property python.home, although it can</span><br><span class="line">    be often automatically determined by the location of the Jython jar file</span><br><span class="line"></span><br><span class="line">You can use the -S option or python.import.site=false to not import the site module</span><br></pre></td></tr></table></figure>
<h3 id="解决方案-1"><a href="#解决方案-1" class="headerlink" title="解决方案"></a>解决方案</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">static &#123;</span><br><span class="line">	System.setProperty(&quot;python.import.site&quot;, &quot;false&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/16/图片相似度搜索/" itemprop="url">
                  图片相似度搜索计算
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-16T00:00:00+08:00" content="2016-05-16">
              2016-05-16
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ImageProcessing/" itemprop="url" rel="index">
                    <span itemprop="name">ImageProcessing</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/16/图片相似度搜索/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/16/图片相似度搜索/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>首先介绍Image相似度计算方法（PHash、AHash、DHash 等）。</li>
<li>Image相似度算法比较</li>
<li>案例：构建一个3千万图片（1T+）相似度搜索系统。（这里主要运用Elasticsearch 分布式计算分析能力）</li>
</ul>
<h2 id="PHash"><a href="#PHash" class="headerlink" title="PHash"></a>PHash</h2><h3 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h3><h3 id="算法实现"><a href="#算法实现" class="headerlink" title="算法实现"></a>算法实现</h3><p>更多的phash应用，使用<code>http://www.phash.org/</code> 提供的Phash算法。</p>
<p>如下Phash算法为Java实现。 说明:<a href="http://www.hackerfactor.com/blog/index.php?/archives/432-Looks-Like-It.html" target="_blank" rel="external">http://www.hackerfactor.com/blog/index.php?/archives/432-Looks-Like-It.html</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br></pre></td><td class="code"><pre><span class="line">package org.freecode.image.phash;</span><br><span class="line">import java.awt.Graphics2D;</span><br><span class="line">import java.awt.color.ColorSpace;</span><br><span class="line">import java.awt.image.BufferedImage;</span><br><span class="line">import java.awt.image.ColorConvertOp;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.FileInputStream;</span><br><span class="line">import java.io.FileNotFoundException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line"> </span><br><span class="line">import java.math.BigInteger;</span><br><span class="line">import javax.imageio.ImageIO;</span><br><span class="line">/*</span><br><span class="line"> * pHash-like image hash.</span><br><span class="line"> * Author: Elliot Shepherd (elliot@jarofworms.com</span><br><span class="line"> * Based On: http://www.hackerfactor.com/blog/index.php?/archives/432-Looks-Like-It.html</span><br><span class="line"> */</span><br><span class="line">public class ImagePHash &#123;</span><br><span class="line"> </span><br><span class="line">        private int size = 32;</span><br><span class="line">        private int smallerSize = 8;</span><br><span class="line">       </span><br><span class="line">        public ImagePHash() &#123;</span><br><span class="line">                initCoefficients();</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        public ImagePHash(int size, int smallerSize) &#123;</span><br><span class="line">                this.size = size;</span><br><span class="line">                this.smallerSize = smallerSize;</span><br><span class="line">               </span><br><span class="line">                initCoefficients();</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        public static int hammingDistance(String lhs, String rhs)&#123;          </span><br><span class="line">            return new BigInteger(lhs, 16).xor(new BigInteger(rhs, 16)).bitCount();</span><br><span class="line">         &#125;</span><br><span class="line">       </span><br><span class="line">        public int distance(String s1, String s2) &#123;</span><br><span class="line">                int counter = 0;</span><br><span class="line">                for (int k = 0; k &lt; s1.length();k++) &#123;</span><br><span class="line">                        if(s1.charAt(k) != s2.charAt(k)) &#123;</span><br><span class="line">                                counter++;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                return counter;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        // Returns a &apos;binary string&apos; (like. 001010111011100010) which is easy to do a hamming distance on.</span><br><span class="line">        public String getHash(InputStream is) throws Exception &#123;</span><br><span class="line">                BufferedImage img = ImageIO.read(is);</span><br><span class="line">               </span><br><span class="line">                /* 1. Reduce size.</span><br><span class="line">                 * Like Average Hash, pHash starts with a small image.</span><br><span class="line">                 * However, the image is larger than 8x8; 32x32 is a good size.</span><br><span class="line">                 * This is really done to simplify the DCT computation and not</span><br><span class="line">                 * because it is needed to reduce the high frequencies.</span><br><span class="line">                 */</span><br><span class="line">                img = resize(img, size, size);</span><br><span class="line">               </span><br><span class="line">                /* 2. Reduce color.</span><br><span class="line">                 * The image is reduced to a grayscale just to further simplify</span><br><span class="line">                 * the number of computations.</span><br><span class="line">                 */</span><br><span class="line">                img = grayscale(img);</span><br><span class="line">               </span><br><span class="line">                double[][] vals = new double[size][size];</span><br><span class="line">               </span><br><span class="line">                for (int x = 0; x &lt; img.getWidth(); x++) &#123;</span><br><span class="line">                        for (int y = 0; y &lt; img.getHeight(); y++) &#123;</span><br><span class="line">                                vals[x][y] = getBlue(img, x, y);</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">               </span><br><span class="line">                /* 3. Compute the DCT.</span><br><span class="line">                 * The DCT separates the image into a collection of frequencies</span><br><span class="line">                 * and scalars. While JPEG uses an 8x8 DCT, this algorithm uses</span><br><span class="line">                 * a 32x32 DCT.</span><br><span class="line">                 */</span><br><span class="line">                long start = System.currentTimeMillis();</span><br><span class="line">                double[][] dctVals = applyDCT(vals);</span><br><span class="line">                System.out.println(&quot;DCT: &quot; + (System.currentTimeMillis() - start));</span><br><span class="line">               </span><br><span class="line">                /* 4. Reduce the DCT.</span><br><span class="line">                 * This is the magic step. While the DCT is 32x32, just keep the</span><br><span class="line">                 * top-left 8x8. Those represent the lowest frequencies in the</span><br><span class="line">                 * picture.</span><br><span class="line">                 */</span><br><span class="line">                /* 5. Compute the average value.</span><br><span class="line">                 * Like the Average Hash, compute the mean DCT value (using only</span><br><span class="line">                 * the 8x8 DCT low-frequency values and excluding the first term</span><br><span class="line">                 * since the DC coefficient can be significantly different from</span><br><span class="line">                 * the other values and will throw off the average).</span><br><span class="line">                 */</span><br><span class="line">                double total = 0;</span><br><span class="line">               </span><br><span class="line">                for (int x = 0; x &lt; smallerSize; x++) &#123;</span><br><span class="line">                        for (int y = 0; y &lt; smallerSize; y++) &#123;</span><br><span class="line">                                total += dctVals[x][y];</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                total -= dctVals[0][0];</span><br><span class="line">               </span><br><span class="line">                double avg = total / (double) ((smallerSize * smallerSize) - 1);</span><br><span class="line">       </span><br><span class="line">                /* 6. Further reduce the DCT.</span><br><span class="line">                 * This is the magic step. Set the 64 hash bits to 0 or 1</span><br><span class="line">                 * depending on whether each of the 64 DCT values is above or</span><br><span class="line">                 * below the average value. The result doesn&apos;t tell us the</span><br><span class="line">                 * actual low frequencies; it just tells us the very-rough</span><br><span class="line">                 * relative scale of the frequencies to the mean. The result</span><br><span class="line">                 * will not vary as long as the overall structure of the image</span><br><span class="line">                 * remains the same; this can survive gamma and color histogram</span><br><span class="line">                 * adjustments without a problem.</span><br><span class="line">                 */</span><br><span class="line">                String hash = &quot;&quot;;</span><br><span class="line">               </span><br><span class="line">                for (int x = 0; x &lt; smallerSize; x++) &#123;</span><br><span class="line">                        for (int y = 0; y &lt; smallerSize; y++) &#123;</span><br><span class="line">                                if (x != 0 &amp;&amp; y != 0) &#123;</span><br><span class="line">                                        hash += (dctVals[x][y] &gt; avg?&quot;1&quot;:&quot;0&quot;);</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">               </span><br><span class="line">                return hash;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        private BufferedImage resize(BufferedImage image, int width,    int height) &#123;</span><br><span class="line">                BufferedImage resizedImage = new BufferedImage(width, height, BufferedImage.TYPE_INT_ARGB);</span><br><span class="line">                Graphics2D g = resizedImage.createGraphics();</span><br><span class="line">                g.drawImage(image, 0, 0, width, height, null);</span><br><span class="line">                g.dispose();</span><br><span class="line">                return resizedImage;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        private ColorConvertOp colorConvert = new ColorConvertOp(ColorSpace.getInstance(ColorSpace.CS_GRAY), null);</span><br><span class="line"> </span><br><span class="line">        private BufferedImage grayscale(BufferedImage img) &#123;</span><br><span class="line">        colorConvert.filter(img, img);</span><br><span class="line">        return img;</span><br><span class="line">    &#125;</span><br><span class="line">       </span><br><span class="line">        private static int getBlue(BufferedImage img, int x, int y) &#123;</span><br><span class="line">                return (img.getRGB(x, y)) &amp; 0xff;</span><br><span class="line">        &#125;</span><br><span class="line">       </span><br><span class="line">        // DCT function stolen from http://stackoverflow.com/questions/4240490/problems-with-dct-and-idct-algorithm-in-java</span><br><span class="line"> </span><br><span class="line">        private double[] c;</span><br><span class="line">        private void initCoefficients() &#123;</span><br><span class="line">                c = new double[size];</span><br><span class="line">               </span><br><span class="line">        for (int i=1;i&lt;size;i++) &#123;</span><br><span class="line">            c[i]=1;</span><br><span class="line">        &#125;</span><br><span class="line">        c[0]=1/Math.sqrt(2.0);</span><br><span class="line">    &#125;</span><br><span class="line">       </span><br><span class="line">        private double[][] applyDCT(double[][] f) &#123;</span><br><span class="line">                int N = size;</span><br><span class="line">               </span><br><span class="line">        double[][] F = new double[N][N];</span><br><span class="line">        for (int u=0;u&lt;N;u++) &#123;</span><br><span class="line">          for (int v=0;v&lt;N;v++) &#123;</span><br><span class="line">            double sum = 0.0;</span><br><span class="line">            for (int i=0;i&lt;N;i++) &#123;</span><br><span class="line">              for (int j=0;j&lt;N;j++) &#123;</span><br><span class="line">                sum+=Math.cos(((2*i+1)/(2.0*N))*u*Math.PI)*Math.cos(((2*j+1)/(2.0*N))*v*Math.PI)*(f[i][j]);</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            sum*=((c[u]*c[v])/4.0);</span><br><span class="line">            F[u][v] = sum;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return F;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">        </span><br><span class="line">        public static void main(String[] args) throws FileNotFoundException, Exception &#123;</span><br><span class="line">            ImagePHash p = new ImagePHash();</span><br><span class="line">             </span><br><span class="line">            String image1 = p.getHash(new FileInputStream(new File(&quot;F:/cc/DEF3A6A96A4012ED042AB88DC4DA24B4.png&quot;)));</span><br><span class="line">            String image2 = p.getHash(new FileInputStream(new File(&quot;F:/cc/F16FE1485F11302B5F196B04F7D9BA5B.png&quot;)));</span><br><span class="line">            System.out.println(image1+&quot;\t&quot;+image2);</span><br><span class="line">            </span><br><span class="line">            System.out.println(&quot;Score is &quot; + p.distance(image1, image2));</span><br><span class="line">            System.out.println(&quot;Score is &quot; + ImagePHash.hammingDistance(image1, image2));</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="暂略。"><a href="#暂略。" class="headerlink" title="暂略。"></a>暂略。</h2><p>最近没时间。</p>
<p>构建Image相似度搜索系统步骤如下：</p>
<ul>
<li>通过图像相似度算法，离线将图像（MD5、相似度Hash值、等信息）存储到Elasticsearch中。线下保证增量数据增加。</li>
<li>开启Elasticsearch <code>script.disable_dynamic: false</code> 。 编写Elasticsearch 嵌入式脚本，用于计算<code>海明距离</code>。</li>
<li>将<code>海明距离</code>结果交给<code>score</code>值。</li>
<li>写相关图像相似度搜索APP。 （通过上诉步骤后，可以指定搜索阈值，并输入一张图片，计算当前图片相似度Hash值到Elasticsearch进行搜索，吧啦吧啦）</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/05/04/2016/使用国内yum源/" itemprop="url">
                  使用国内yum源
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-05-04T16:07:00+08:00" content="2016-05-04">
              2016-05-04
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Operating-System/" itemprop="url" rel="index">
                    <span itemprop="name">Operating System</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Operating-System/Linux/" itemprop="url" rel="index">
                    <span itemprop="name">Linux</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/05/04/2016/使用国内yum源/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/05/04/2016/使用国内yum源/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>国内yum源列表 Centos6</strong></p>
<table>
<thead>
<tr>
<th>来源</th>
<th>地址</th>
</tr>
</thead>
<tbody>
<tr>
<td>中科大</td>
<td><a href="http://centos.ustc.edu.cn/CentOS-Base.repo" target="_blank" rel="external">http://centos.ustc.edu.cn/CentOS-Base.repo</a></td>
</tr>
<tr>
<td>搜狐</td>
<td><a href="http://mirrors.sohu.com/help/CentOS-Base-sohu.repo" target="_blank" rel="external">http://mirrors.sohu.com/help/CentOS-Base-sohu.repo</a></td>
</tr>
<tr>
<td>网易</td>
<td><a href="http://mirrors.163.com/.help/CentOS6-Base-163.repo" target="_blank" rel="external">http://mirrors.163.com/.help/CentOS6-Base-163.repo</a></td>
</tr>
<tr>
<td>阿里云</td>
<td><a href="http://mirrors.aliyun.com/repo/Centos-6.repo" target="_blank" rel="external">http://mirrors.aliyun.com/repo/Centos-6.repo</a></td>
</tr>
</tbody>
</table>
<h2 id="使用国内yum"><a href="#使用国内yum" class="headerlink" title="使用国内yum"></a>使用国内yum</h2><p>系统配置yum的目录为<code>/etc/yum.repos.d</code></p>
<ul>
<li><p>备份系统yum配置文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /etc/yum.repos.d</span><br><span class="line">mv CentOS-Base.repo CentOS-Base.repo.bk</span><br></pre></td></tr></table></figure>
</li>
<li><p>下载相关yum源文件（这里使用阿里云）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget -O /etc/yum.repos.d/CentOS-Base.repo http://mirrors.aliyun.com/repo/Centos-6.repo</span><br></pre></td></tr></table></figure>
</li>
<li><p>更新yum配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum clean all</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="使用yum-fastestmirror"><a href="#使用yum-fastestmirror" class="headerlink" title="使用yum-fastestmirror"></a>使用yum-fastestmirror</h2><p>每次用yum安装，yum-fastestmirror就会自动检查速度最快的镜像。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-fastestmirror</span><br><span class="line">yum clean all</span><br></pre></td></tr></table></figure>
<blockquote>
<p>通过<code>yum --disableplugin=fastestmirror update</code> 禁用此插件</p>
</blockquote>
<h2 id="被数落了"><a href="#被数落了" class="headerlink" title="被数落了~"></a>被数落了~</h2><p><strong>公司原来有开放的yum源，我还傻乎乎的使用别人家的。</strong><br><strong>Antiy: <a href="http://mirrors.avlyun.org/" target="_blank" rel="external">http://mirrors.avlyun.org/</a>  提供各种系统的yum镜像，欢迎使用。</strong></p>
<ul>
<li>修改为自家的东西<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl http://mirrors.avlyun.org/repo/centos6.repo &gt; /etc/yum.repos.d/CentOS-Base.repo</span><br><span class="line">yum makecache</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>我并没有使用yum-fastestmirror，自家的东东快的多。</p>
</blockquote>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/27/2016/大数据工作流 Azkaban 环境搭建/" itemprop="url">
                  大数据工作流 Azkaban 环境搭建
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-27T20:55:00+08:00" content="2016-04-27">
              2016-04-27
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Workflow/" itemprop="url" rel="index">
                    <span itemprop="name">Workflow</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Workflow/Bigdata-Workflow/" itemprop="url" rel="index">
                    <span itemprop="name">Bigdata Workflow</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/27/2016/大数据工作流 Azkaban 环境搭建/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/27/2016/大数据工作流 Azkaban 环境搭建/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>大数据运维的同学Python、Shell脚本泛滥，且依赖混乱，不易管理。 需要符合自身要求的任务调度系统，来减轻痛苦~~。</p>
<p>之前调研了Oozie、AzkaBan、Airflow、Luigi 评估了一下诉求，选择AzkaBan。</p>
<p>这篇文章将演示如何在一个全新的Linux(CentOS)环境安装Azkaban。</p>
<h2 id="Azkaban-介绍"><a href="#Azkaban-介绍" class="headerlink" title="Azkaban 介绍"></a>Azkaban 介绍</h2><p>LinkedIn/Azkaban 为解决Hadoop的任务依赖问题。</p>
<ul>
<li>它有三个重要组件：<ul>
<li>关系数据库（目前仅支持mysql）</li>
<li>web管理服务器－AzkabanWebServer</li>
<li>执行服务器－AzkabanExecutorServer</li>
</ul>
</li>
</ul>
<img src="/2016/04/27/2016/大数据工作流%20Azkaban%20环境搭建/d82665b7-7a34-4272-ac43-6beaf6546f68.png" alt="azkaban组件" title="azkaban组件">
<h3 id="Mysql"><a href="#Mysql" class="headerlink" title="Mysql"></a>Mysql</h3><p>Azkaban使用MySQL来存储它的状态信息，Azkaban Executor Server和Azkaban Web Server均使用到了MySQL数据库。</p>
<ul>
<li><p>AzkabanExecutorServer在如下几个方面使用到了数据库：<br>1、获取project的信息<br>2、执行工作流<br>3、存储工作流运行日志</p>
</li>
<li><p>AzkabanWebServer在如下几个方面使用到了数据库：<br>1、Project管理<br>2、跟踪工作流执行进度<br>3、访问历史工作流的运行信息<br>4、定时执行工作流任务</p>
</li>
</ul>
<h3 id="AzkabanWebServer"><a href="#AzkabanWebServer" class="headerlink" title="AzkabanWebServer"></a>AzkabanWebServer</h3><p>AzkabanWebserver是整个Azkaban工作流系统的主要管理者，它负责project管理、用户登录认证、定时执行工作流、跟踪工作流执 行进度等一系列任务。同时，它还提供Web服务操作的接口，利用该接口，用户可以使用curl或其他ajax的方式，来执行azkaban的相关操作。操 作包括：用户登录、创建project、上传workflow、执行workflow、查询workflow的执行进度、杀掉workflow等一系列操 作，且这些操作的返回结果均是json的格式。</p>
<h3 id="AzkabanExecutorServer"><a href="#AzkabanExecutorServer" class="headerlink" title="AzkabanExecutorServer"></a>AzkabanExecutorServer</h3><p>之所以将AzkabanWebServer和AzkabanExecutorServer分开，主要是因为在某个任务流失败后，可以更方便的将重新执行。而且也更有利于Azkaban系统的升级。</p>
<h2 id="Azkaban-开始"><a href="#Azkaban-开始" class="headerlink" title="Azkaban 开始"></a>Azkaban 开始</h2><ul>
<li>solo server mode：<br><strong>最简单的模式，数据库内置的H2数据库，且webServer和executorServer运行在同一个进程中，没有单独分开。该模式适用于小规模的使用。</strong></li>
<li>two server mode：<br><strong>该模式使用MySQL数据库，webServer和executorServer运行在不同进程中，webServer和executorServer互不影响，该模式适用于大规模应用。</strong></li>
<li>multiple executor mode：<br><strong>该模式下，执行服务器和管理服务器在不同主机上，且执行服务器可以有多</strong></li>
</ul>
<h2 id="Azkaban-安装"><a href="#Azkaban-安装" class="headerlink" title="Azkaban 安装"></a>Azkaban 安装</h2><p>Azkaban2 仅仅只用Mysql 作为数据存储</p>
<h3 id="安装JDK1-8"><a href="#安装JDK1-8" class="headerlink" title="安装JDK1.8"></a>安装JDK1.8</h3><p><a href="http://cmp-cc.github.io/2014/11/07/2014/Linux%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/">参考安装JDK1.8 安装</a></p>
<h3 id="安装Mysql"><a href="#安装Mysql" class="headerlink" title="安装Mysql"></a>安装Mysql</h3><p><a href="http://cmp-cc.github.io/2014/11/07/2014/Linux%20%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97/">参考安装Mysql5.7.11 </a></p>
<h4 id="创建数据库"><a href="#创建数据库" class="headerlink" title="创建数据库"></a>创建数据库</h4><h5 id="创建Azkaban数据库"><a href="#创建Azkaban数据库" class="headerlink" title="创建Azkaban数据库"></a><strong>创建Azkaban数据库</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE DATABASE azkaban;</span><br></pre></td></tr></table></figure>
<h5 id="创建数据库用户于Azkaban"><a href="#创建数据库用户于Azkaban" class="headerlink" title="创建数据库用户于Azkaban"></a><strong>创建数据库用户于Azkaban</strong></h5><p>如下：</p>
<ul>
<li>用户名:azkaban</li>
<li>地址：localhost</li>
<li>密码：azkaban<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CREATE USER &apos;azkaban&apos;@&apos;localhost&apos; IDENTIFIED BY &apos;azkaban&apos; PASSWORD EXPIRE;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="设置权限于Azkaban-用户"><a href="#设置权限于Azkaban-用户" class="headerlink" title="设置权限于Azkaban 用户"></a><strong>设置权限于Azkaban 用户</strong></h5><p><strong>这里执行如下，给予所有权限</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grant all privileges on azkaban.* to &apos;azkaban&apos;@&apos;localhost&apos; identified by &apos;azkaban&apos;;</span><br></pre></td></tr></table></figure></p>
<p><strong>也可以如下限定访问权限</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GRANT SELECT,INSERT,UPDATE,DELETE ON azkaban.* TO &apos;azkaban&apos;@&apos;localhost&apos; identified by &apos;azkaban&apos;;</span><br></pre></td></tr></table></figure></p>
<p><strong>配置数据包大小，修改属性<code>max_allowed_packet</code>值为<code>1024M</code>或者更高</strong></p>
<ul>
<li><p>编辑<code>/etc/my.cnf</code>文件，增加如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/my.cnf</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">...</span><br><span class="line">max_allowed_packet=2048M</span><br></pre></td></tr></table></figure>
</li>
<li><p>重启 mysql</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysql restart</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="创建Azkaban-表"><a href="#创建Azkaban-表" class="headerlink" title="创建Azkaban 表"></a>创建Azkaban 表</h5><ul>
<li>首先下载<a href="http://azkaban.github.io/downloads.html" target="_blank" rel="external"><code>azkaban-sql-script</code></a>压缩文件，这个档案包含在表创建脚本。</li>
<li>从下载页面选择合适版本进行下载。(这里选择最新版azkaban-sql-script-2.5.0.tar.gz)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget –no-check-certificate https://s3.amazonaws.com/azkaban2/azkaban2/2.5.0/azkaban-sql-script-2.5.0.tar.gz</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>create-all-sql 脚本包含所有单条语句,忽略所有<code>update</code>前缀的脚本</strong></p>
<ul>
<li><p>解压并导入azkaban DB</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf azkaban-sql-script-2.5.0.tar.gz</span><br><span class="line"></span><br><span class="line">mysql -u root -p azkaban &lt; /user/cmp-cc/azkaban-2.5.0/create-all-sql-2.5.0.sql </span><br><span class="line"></span><br><span class="line">// 提示你输入密码即可</span><br></pre></td></tr></table></figure>
</li>
<li><p>检查是否创建成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; show tables;</span><br><span class="line">+------------------------+</span><br><span class="line">| Tables_in_azkaban      |</span><br><span class="line">+------------------------+</span><br><span class="line">| active_executing_flows |</span><br><span class="line">| active_sla             |</span><br><span class="line">| execution_flows        |</span><br><span class="line">| execution_jobs         |</span><br><span class="line">| execution_logs         |</span><br><span class="line">| project_events         |</span><br><span class="line">| project_files          |</span><br><span class="line">| project_flows          |</span><br><span class="line">| project_permissions    |</span><br><span class="line">| project_properties     |</span><br><span class="line">| project_versions       |</span><br><span class="line">| projects               |</span><br><span class="line">| properties             |</span><br><span class="line">| schedules              |</span><br><span class="line">| triggers               |</span><br><span class="line">+------------------------+</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="安装-Azkaban-Web-Server"><a href="#安装-Azkaban-Web-Server" class="headerlink" title="安装 Azkaban Web Server"></a>安装 Azkaban Web Server</h3><p>Azkaban Web Server 处理项目管理、身份验证、调度和触发器的执行。</p>
<h4 id="安装-Web-Server"><a href="#安装-Web-Server" class="headerlink" title="安装 Web Server"></a>安装 Web Server</h4><ul>
<li>选择合适的版本，<a href="http://azkaban.github.io/downloads.html" target="_blank" rel="external">下载页面</a>。  </li>
<li>你也以可以<a href="https://github.com/azkaban/azkaban2" target="_blank" rel="external"><code>git clone 最新版</code></a>,查看文档，<a href="http://azkaban.github.io/azkaban/docs/latest/#building-from-source" target="_blank" rel="external">如何进行源码安装</a></li>
<li><p>这里为<code>azkaban-web-server-2.5.0.tar.gz</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget –no-check-certificate https://s3.amazonaws.com/azkaban2/azkaban2/2.5.0/azkaban-web-server-2.5.0.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li><p>解压到指定目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /usr/local/azkaban/</span><br><span class="line"></span><br><span class="line">tar zxvf azkaban-web-server-2.5.0.tar.gz -C /usr/local/azkaban/</span><br></pre></td></tr></table></figure>
</li>
<li><p>相关目录描述</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>Folder</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>bin</td>
<td>The scripts to start Azkaban jetty server</td>
</tr>
<tr>
<td>conf</td>
<td>The configurations for Azkaban solo server</td>
</tr>
<tr>
<td>lib</td>
<td>The jar dependencies for Azkaban</td>
</tr>
<tr>
<td>extlib</td>
<td>Additional jars that are added to extlib will be added to Azkaban’s classpath</td>
</tr>
<tr>
<td>plugins</td>
<td>the directory where plugins can be installed</td>
</tr>
<tr>
<td>web</td>
<td>The web (css, javascript, image) files for Azkaban web server.</td>
</tr>
</tbody>
</table>
<ul>
<li><code>conf</code>目录，有如下三个文件<ul>
<li>azkaban.properties - Used by Azkaban for runtime parameters</li>
<li>global.properties - Global static properties that are passed as shared properties to every workflow and job.</li>
<li>azkaban-users.xml - Used to add users and roles for authentication. This file is not used if the XmLUserManager is not set up to use it.</li>
</ul>
</li>
</ul>
<p>The <code>azkaban.properties</code> file will be the main configuration file that is necessary to setup Azkaban.</p>
<h4 id="获取SSL-KeyStore（可选）"><a href="#获取SSL-KeyStore（可选）" class="headerlink" title="获取SSL KeyStore（可选）"></a>获取SSL KeyStore（可选）</h4><p>Azkaban 使用<code>SSL socket</code> 链接器,设置SSL可以通过使用<code>https://</code> 访问页面，使其更加安全。<br><strong>SSL 并是必须的，我们可以通过<code>azkaban.properties</code>配置取消，请参考SSL配置</strong></p>
<h5 id="创建SSL-配置"><a href="#创建SSL-配置" class="headerlink" title="创建SSL 配置"></a>创建SSL 配置</h5><p><strong>这里keytool 是JDK提供，并将其密钥生成或复制于<code>/azkaban/web</code>目录</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/azkaban/azkaban-web-2.5.0/web/</span><br><span class="line"></span><br><span class="line">keytool -genkey -keystore keystore -alias keystore -keyalg RSA</span><br></pre></td></tr></table></figure></p>
<p>将有如下提示，密码长度 &gt;= 6 (这里为:password)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Enter keystore password:  </span><br><span class="line">Re-enter new password: </span><br><span class="line">What is your first and last name?</span><br><span class="line">  [Unknown]:  azkaban</span><br><span class="line">What is the name of your organizational unit?</span><br><span class="line">  [Unknown]:  Jetty</span><br><span class="line">What is the name of your organization?</span><br><span class="line">  [Unknown]:  cmp-cc</span><br><span class="line">What is the name of your City or Locality?</span><br><span class="line">  [Unknown]:  WuHan</span><br><span class="line">What is the name of your State or Province?</span><br><span class="line">  [Unknown]:  WuHan</span><br><span class="line">What is the two-letter country code for this unit?</span><br><span class="line">  [Unknown]:  86</span><br><span class="line">Is CN=azkaban, OU=Jetty, O=cmp-cc, L=WuHan, ST=WuHan, C=86 correct?</span><br><span class="line">  [no]:  yes</span><br><span class="line"></span><br><span class="line">Enter key password for &lt;jetty-azkaban&gt;</span><br><span class="line">        (RETURN if same as keystore password):             // 这里回车即可</span><br></pre></td></tr></table></figure></p>
<h4 id="配置azkaban-properties文件"><a href="#配置azkaban-properties文件" class="headerlink" title="配置azkaban.properties文件"></a>配置<code>azkaban.properties</code>文件</h4><p> 修改<code>./conf/azkaban.properties</code>文件,进行如下修改<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /usr/local/azkaban/azkaban-web-2.5.0/conf/azkaban.properties</span><br></pre></td></tr></table></figure></p>
<p><strong>我的完整配置信息，邮件通知自己配置即可</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">#Azkaban Personalization Settings</span><br><span class="line">azkaban.name=Test</span><br><span class="line">azkaban.label=My Local Azkaban</span><br><span class="line">azkaban.color=#FF3601</span><br><span class="line">azkaban.default.servlet.path=/index</span><br><span class="line">web.resource.dir=web/</span><br><span class="line">default.timezone.id=Asia/Shanghai</span><br><span class="line"></span><br><span class="line">#Azkaban UserManager class</span><br><span class="line">user.manager.class=azkaban.user.XmlUserManager</span><br><span class="line">user.manager.xml.file=conf/azkaban-users.xml</span><br><span class="line"></span><br><span class="line">#Loader for projects</span><br><span class="line">executor.global.properties=conf/global.properties</span><br><span class="line">azkaban.project.dir=projects</span><br><span class="line"></span><br><span class="line">database.type=mysql</span><br><span class="line">mysql.port=3306</span><br><span class="line">mysql.host=localhost</span><br><span class="line">mysql.database=azkaban</span><br><span class="line">mysql.user=azkaban</span><br><span class="line">mysql.password=azkaban</span><br><span class="line">mysql.numconnections=100</span><br><span class="line"></span><br><span class="line"># Velocity dev mode</span><br><span class="line">velocity.dev.mode=false</span><br><span class="line"></span><br><span class="line"># Azkaban Jetty server properties.</span><br><span class="line">jetty.maxThreads=25</span><br><span class="line">jetty.ssl.port=8443</span><br><span class="line">jetty.port=8081</span><br><span class="line">jetty.keystore=web/keystore</span><br><span class="line">jetty.password=password</span><br><span class="line">jetty.keypassword=password</span><br><span class="line">jetty.truststore=web/keystore</span><br><span class="line">jetty.trustpassword=password</span><br><span class="line"></span><br><span class="line"># Azkaban Executor settings</span><br><span class="line">executor.port=12321</span><br><span class="line"></span><br><span class="line"># mail settings</span><br><span class="line">mail.sender=</span><br><span class="line">mail.host=</span><br><span class="line">job.failure.email=</span><br><span class="line">job.success.email=</span><br><span class="line"></span><br><span class="line">lockdown.create.projects=false</span><br><span class="line"></span><br><span class="line">cache.directory=cache</span><br></pre></td></tr></table></figure>
<h5 id="SSL-密钥配置"><a href="#SSL-密钥配置" class="headerlink" title="SSL 密钥配置"></a>SSL 密钥配置</h5><p>修改<code>jetty.xxxx</code>信息为keystore 设置，类似如下：</p>
<ul>
<li><p>如果已经生成keystore SSL文件，如下配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># Azkaban Jetty server properties.</span><br><span class="line">jetty.maxThreads=25</span><br><span class="line">jetty.ssl.port=8443</span><br><span class="line">jetty.port=8081</span><br><span class="line">jetty.keystore=web/keystore</span><br><span class="line">jetty.password=password</span><br><span class="line">jetty.keypassword=password</span><br><span class="line">jetty.truststore=web/keystore</span><br><span class="line">jetty.trustpassword=password</span><br></pre></td></tr></table></figure>
</li>
<li><p>取消SSL 设置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">jetty.maxThreads=25</span><br><span class="line">jetty.port=8081</span><br><span class="line">jetty.use.ssl=false</span><br><span class="line"></span><br><span class="line">#jetty.ssl.port=8443</span><br><span class="line">#jetty.keystore=web/keystore</span><br><span class="line">#jetty.password=keystore</span><br><span class="line">#jetty.keypassword=keystore</span><br><span class="line">#jetty.truststore=web/keystore</span><br><span class="line">#jetty.trustpassword=keystore</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="DB-设置"><a href="#DB-设置" class="headerlink" title="DB 设置"></a>DB 设置</h5><ul>
<li>将MySQL数据库链接添加至<code>extlib</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/azkaban/azkaban-web-2.5.0/extlib</span><br><span class="line">wget http://central.maven.org/maven2/mysql/mysql-connector-java/5.1.38/mysql-connector-java-5.1.38.jar</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>确保<code>mysql jdbc连接器</code>已经添加到<code>extlib</code>目录,配置大致如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">database.type=mysql</span><br><span class="line">mysql.port=3306</span><br><span class="line">mysql.host=localhost</span><br><span class="line">mysql.database=azkaban</span><br><span class="line">mysql.user=azkaban</span><br><span class="line">mysql.password=azkaban</span><br><span class="line">mysql.numconnections=100</span><br></pre></td></tr></table></figure></p>
<h5 id="UserManager-设置"><a href="#UserManager-设置" class="headerlink" title="UserManager 设置"></a>UserManager 设置</h5><p>Azkaban 使用<code>UserManager</code>支持用户认证和用户角色<br>默认：Azkaban使用<code>XmlUserManager</code>从<code>azkaban-users.xml</code>获取用户名、密码、角色信息。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user.manager.class=azkaban.user.XmlUserManager</span><br><span class="line">user.manager.xml.file=conf/azkaban-users.xml</span><br></pre></td></tr></table></figure></p>
<h5 id="jetty运行设置"><a href="#jetty运行设置" class="headerlink" title="jetty运行设置"></a>jetty运行设置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">jetty.maxThreads=25</span><br><span class="line">jetty.ssl.port=8443</span><br></pre></td></tr></table></figure>
<h4 id="Azkaban-web-运行和关闭"><a href="#Azkaban-web-运行和关闭" class="headerlink" title="Azkaban-web 运行和关闭"></a>Azkaban-web 运行和关闭</h4><ul>
<li><p>start AzkabanWebServer.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/azkaban-web-start.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>shutdown AzkabanWebServer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/azkaban-web-shutdown.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>浏览器端口</p>
<ul>
<li>设置SSL=true  默认访问： <a href="https://192.168.xx.xxxx:8443" target="_blank" rel="external">https://192.168.xx.xxxx:8443</a></li>
<li>设置SSL=false 默认访问： <a href="http://192.168.xx.xxxx:8081" target="_blank" rel="external">http://192.168.xx.xxxx:8081</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>SSL 是可以关闭的，azkaban.properties 文件中添加<code>jetty.use.ssl=false</code> </p>
</blockquote>
<p><strong>运行Azkaban-web 并访问浏览器验证是否成功</strong></p>
<blockquote>
<p>记得关闭防火墙，或开放8443 和 8010 端口</p>
</blockquote>
<h3 id="安装-Azkaban-Executor-Server"><a href="#安装-Azkaban-Executor-Server" class="headerlink" title="安装 Azkaban Executor Server"></a>安装 Azkaban Executor Server</h3><p><strong>Azkaban Executor Server</strong> 处理工作流和作业的实际执行。</p>
<h4 id="安装Executor-Server"><a href="#安装Executor-Server" class="headerlink" title="安装Executor Server"></a>安装Executor Server</h4><ul>
<li><a href="http://azkaban.github.io/downloads.html" target="_blank" rel="external">下载页面选择版本</a> 与 Azkaban-Web 保持一致。</li>
<li>你也以可以<a href="https://github.com/azkaban/azkaban2" target="_blank" rel="external"><code>git clone 最新版</code></a>,查看文档，<a href="http://azkaban.github.io/azkaban/docs/latest/#building-from-source" target="_blank" rel="external">如何进行源码安装</a></li>
<li><p>这里是下载<code>azkaban-executor-server-2.5.0.tar.gz</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget –no-check-certificate  https://s3.amazonaws.com/azkaban2/azkaban2/2.5.0/azkaban-executor-server-2.5.0.tar.gz</span><br></pre></td></tr></table></figure>
</li>
<li><p>解压到指定目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf azkaban-executor-server-2.5.0.tar.gz -C /usr/local/azkaban/</span><br></pre></td></tr></table></figure>
</li>
<li><p>相关目录描述<br>Folder | Description<br>— | —<br>bin | The scripts to start Azkaban jetty server<br>conf  | The configurations for Azkaban solo server<br>lib | The jar dependencies for Azkaban<br>extlib   | Additional jars that are added to extlib will be added to Azkaban’s classpath<br>plugins | the directory where plugins can be installed</p>
</li>
</ul>
<h4 id="配置azkaban-properties文件-1"><a href="#配置azkaban-properties文件-1" class="headerlink" title="配置azkaban.properties文件"></a>配置<code>azkaban.properties</code>文件</h4><p><strong>修改<code>./conf/azkaban.properties</code>文件,进行如下修改</strong></p>
<p><strong>我的配置文件</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">default.timezone.id=Asia/Shanghai</span><br><span class="line"></span><br><span class="line"># Azkaban JobTypes Plugins</span><br><span class="line">azkaban.jobtype.plugin.dir=plugins/jobtypes</span><br><span class="line"></span><br><span class="line">#Loader for projects</span><br><span class="line">executor.global.properties=conf/global.properties</span><br><span class="line">azkaban.project.dir=projects</span><br><span class="line"></span><br><span class="line">database.type=mysql</span><br><span class="line">mysql.port=3306</span><br><span class="line">mysql.host=localhost</span><br><span class="line">mysql.database=azkaban</span><br><span class="line">mysql.user=azkaban</span><br><span class="line">mysql.password=azkaban</span><br><span class="line">mysql.numconnections=100</span><br><span class="line"></span><br><span class="line"># Azkaban Executor settings</span><br><span class="line">executor.maxThreads=50</span><br><span class="line">executor.port=12321</span><br><span class="line">executor.flow.threads=30</span><br></pre></td></tr></table></figure></p>
<h5 id="设置DB"><a href="#设置DB" class="headerlink" title="设置DB"></a>设置DB</h5><ul>
<li><p>将MySQL数据库链接添加至<code>extlib</code> 可重新下载，如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/azkaban/azkaban-executor-2.5.0/extlib/</span><br><span class="line">wget http://central.maven.org/maven2/mysql/mysql-connector-java/5.1.38/mysql-connector-java-5.1.38.jar</span><br></pre></td></tr></table></figure>
</li>
<li><p>DB设置(覆盖azkaban.properties)<br><strong>如下：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">database.type=mysql</span><br><span class="line">mysql.port=3306</span><br><span class="line">mysql.host=localhost</span><br><span class="line">mysql.database=azkaban</span><br><span class="line">mysql.user=azkaban</span><br><span class="line">mysql.password=azkaban</span><br><span class="line">mysql.numconnections=100</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h5 id="配置AzabanWebServer-和-AzkabanExecutorServer"><a href="#配置AzabanWebServer-和-AzkabanExecutorServer" class="headerlink" title="配置AzabanWebServer 和 AzkabanExecutorServer"></a>配置AzabanWebServer 和 AzkabanExecutorServer</h5><p><strong>Executor server 需要一个端口，Web server 需要知道这个端口，使用如下默认即可</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># Azkaban Executor settings</span><br><span class="line">executor.maxThreads=50</span><br><span class="line">executor.port=12321</span><br><span class="line">executor.flow.threads=30</span><br></pre></td></tr></table></figure></p>
<h4 id="运行和关闭"><a href="#运行和关闭" class="headerlink" title="运行和关闭"></a>运行和关闭</h4><ul>
<li><p>运行AzkabanExecutorServer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/azkaban-exec-start.sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>关闭 AzkabanExecutorServer</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin/azkaban-exec-shutdown.sh</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>这里所有Azkaban 环境已经安装完毕，你需要启动azkaban-web 和 azkaban-executor 进行工作流管理（作业调度）</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/26/2016/Python + OpenCV 环境配置/" itemprop="url">
                  Python + OpenCV 环境配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-26T19:12:00+08:00" content="2016-04-26">
              2016-04-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Programming-Language/" itemprop="url" rel="index">
                    <span itemprop="name">Programming Language</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Programming-Language/Python/" itemprop="url" rel="index">
                    <span itemprop="name">Python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/26/2016/Python + OpenCV 环境配置/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/26/2016/Python + OpenCV 环境配置/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>OpenCV的全称是：Open Source Computer Vision Library。OpenCV是一个基于（开源）发行的跨平台计算机视觉库，可以运行在Linux、Windows和Mac OS操作系统上。它轻量级而且高效——由一系列 C 函数和少量 C++ 类构成，同时提供了Python、Ruby、MATLAB等语言的接口，实现了图像处理和计算机视觉方面的很多通用算法。</p>
<p>CV2是OpenCV官方的一个扩展库，属于一个Python模块，处理图像函数主要还是和CV2打交道。</p>
<p>安装详情参考:<br><a href="http://opencv-python-tutroals.readthedocs.org/en/latest/py_tutorials/py_setup/py_setup_in_windows/py_setup_in_windows.html" target="_blank" rel="external">http://opencv-python-tutroals.readthedocs.org/en/latest/py_tutorials/py_setup/py_setup_in_windows/py_setup_in_windows.html</a></p>
<h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><h3 id="安装Python-2-7"><a href="#安装Python-2-7" class="headerlink" title="安装Python 2.7"></a>安装Python 2.7</h3><p>当前最新版OpenCV 支持Python2.7 （64bit or 32 bit）<br><strong>这里确定你已经安装了</strong></p>
<h3 id="安装OpenCV"><a href="#安装OpenCV" class="headerlink" title="安装OpenCV"></a>安装OpenCV</h3><p>下载地址：<a href="https://sourceforge.net/projects/opencvlibrary/files/" target="_blank" rel="external">https://sourceforge.net/projects/opencvlibrary/files/</a></p>
<ul>
<li>选择合适的系统版本，这里选择Window，版本为opencv-3.1.0.exe。</li>
<li>安装opencv-3.1.0.exe ，选择解压目录<code>D:\Program-Software\Programming-Language\Python\Image\opencv</code></li>
<li><p>配置环境变量，Path添加类似如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">D:\Program-Software\Programming-Language\Python\Image\opencv\build\x64\vc14\bin</span><br></pre></td></tr></table></figure>
</li>
<li><p>将opencv\build\python\2.7\x64添加到Python27\Lib\site-packages目录（选择不同位数的版本）</p>
</li>
</ul>
<h3 id="安装Numpy"><a href="#安装Numpy" class="headerlink" title="安装Numpy"></a>安装Numpy</h3><p><strong>opencv 依赖</strong></p>
<p>Pip安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install -U numpy</span><br></pre></td></tr></table></figure></p>
<p>下载安装Numpy与Window<br><a href="https://sourceforge.net/projects/numpy/files/NumPy/1.8.1/numpy-1.8.1-win32-superpack-python2.7.exe/download" target="_blank" rel="external">https://sourceforge.net/projects/numpy/files/NumPy/1.8.1/numpy-1.8.1-win32-superpack-python2.7.exe/download</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install numpy</span><br></pre></td></tr></table></figure></p>
<h2 id="安装SciPy"><a href="#安装SciPy" class="headerlink" title="安装SciPy"></a>安装SciPy</h2><p><strong>opencv 依赖</strong><br>下载SciPy<br><a href="https://sourceforge.net/projects/scipy/files/scipy/0.16.1/scipy-0.16.1-win32-superpack-python2.7.exe/download" target="_blank" rel="external">https://sourceforge.net/projects/scipy/files/scipy/0.16.1/scipy-0.16.1-win32-superpack-python2.7.exe/download</a></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&gt;&gt; import cv2</span><br><span class="line">&gt;&gt;&gt; image = cv2.imread(&quot;F:\image.png&quot;)</span><br><span class="line">&gt;&gt;&gt; cv2.imshow(&quot;Image&quot;,image)</span><br><span class="line">&gt;&gt;&gt; cv2.waitKey(0)</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
<p><strong>它将显示图片</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/14/2016/模拟ORM/" itemprop="url">
                  模拟ORM
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-14T18:34:00+08:00" content="2016-04-14">
              2016-04-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Programming-Language/" itemprop="url" rel="index">
                    <span itemprop="name">Programming Language</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Programming-Language/Java/" itemprop="url" rel="index">
                    <span itemprop="name">Java</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/14/2016/模拟ORM/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/14/2016/模拟ORM/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>有时候做一些展示用的项目，或者是测试项目，可能并不会去引入Hibernate 等这类ORM框架，这显的小题大做。但是没有ORM框架方便的特性，又感觉一只手绑在背后，好把！ 实现一些简单的ORM特性。</p>
<h2 id="SQL-Mapping-Java"><a href="#SQL-Mapping-Java" class="headerlink" title="SQL Mapping Java"></a>SQL Mapping Java</h2><h3 id="整体实体关系映射"><a href="#整体实体关系映射" class="headerlink" title="整体实体关系映射"></a>整体实体关系映射</h3><table>
<thead>
<tr>
<th>类型名称</th>
<th>显示长度</th>
<th>数据库类型</th>
<th>JAVA类型</th>
<th>JDBC类型索引(int)</th>
</tr>
</thead>
<tbody>
<tr>
<td>VARCHAR</td>
<td>L+N</td>
<td>VARCHAR</td>
<td>java.lang.String</td>
<td>12     </td>
</tr>
<tr>
<td>CHAR</td>
<td>N</td>
<td>CHAR</td>
<td>java.lang.String</td>
<td>1     </td>
</tr>
<tr>
<td>BLOB</td>
<td>L+N</td>
<td>BLOB</td>
<td>java.lang.byte[]</td>
<td>-4     </td>
</tr>
<tr>
<td>TEXT</td>
<td>65535</td>
<td>VARCHAR</td>
<td>java.lang.String</td>
<td>-1      </td>
</tr>
<tr>
<td>INTEGER</td>
<td>4</td>
<td>INTEGER UNSIGNED</td>
<td>java.lang.Long</td>
<td>4     </td>
</tr>
<tr>
<td>TINYINT</td>
<td>3</td>
<td>TINYINT UNSIGNED</td>
<td>java.lang.Integer</td>
<td>-6     </td>
</tr>
<tr>
<td>SMALLINT</td>
<td>5</td>
<td>SMALLINT UNSIGNED</td>
<td>java.lang.Integer</td>
<td>5     </td>
</tr>
<tr>
<td>MEDIUMINT</td>
<td>8</td>
<td>MEDIUMINT UNSIGNED</td>
<td>java.lang.Integer</td>
<td>4     </td>
</tr>
<tr>
<td>BIT</td>
<td>1</td>
<td>BIT</td>
<td>java.lang.Boolean</td>
<td>-7     </td>
</tr>
<tr>
<td>BIGINT</td>
<td>20</td>
<td>BIGINT UNSIGNED</td>
<td>java.math.BigInteger</td>
<td>-5     </td>
</tr>
<tr>
<td>FLOAT</td>
<td>4+8</td>
<td>FLOAT</td>
<td>java.lang.Float</td>
<td>7     </td>
</tr>
<tr>
<td>DOUBLE</td>
<td>22</td>
<td>DOUBLE</td>
<td>java.lang.Double</td>
<td>8     </td>
</tr>
<tr>
<td>DECIMAL</td>
<td>11</td>
<td>DECIMAL</td>
<td>java.math.BigDecimal</td>
<td>3     </td>
</tr>
<tr>
<td>BOOLEAN</td>
<td>1</td>
<td>TINYINT UNSIGNED</td>
<td>java.lang.Integer</td>
<td>-6      </td>
</tr>
<tr>
<td>ID</td>
<td>11</td>
<td>PK (INTEGER UNSIGNED)</td>
<td>java.lang.Long</td>
<td>4     </td>
</tr>
<tr>
<td>DATE</td>
<td>10</td>
<td>DATE</td>
<td>java.sql.Date</td>
<td>91     </td>
</tr>
<tr>
<td>TIME</td>
<td>8</td>
<td>TIME</td>
<td>java.sql.Time</td>
<td>92     </td>
</tr>
<tr>
<td>DATETIME</td>
<td>19</td>
<td>DATETIME</td>
<td>java.sql.Timestamp</td>
<td>93     </td>
</tr>
<tr>
<td>TIMESTAMP</td>
<td>19</td>
<td>TIMESTAMP</td>
<td>java.sql.Timestamp</td>
<td>93     </td>
</tr>
<tr>
<td>YEAR</td>
<td>4</td>
<td>YEAR</td>
<td>java.sql.Date</td>
<td>91</td>
</tr>
</tbody>
</table>
<h3 id="MySQL-实体类型映射"><a href="#MySQL-实体类型映射" class="headerlink" title="MySQL 实体类型映射"></a>MySQL 实体类型映射</h3><table>
<thead>
<tr>
<th>MySQL Type Name</th>
<th>Return value of GetColumnClassName</th>
<th>Returned as Java Class</th>
</tr>
</thead>
<tbody>
<tr>
<td>BIT(1) (new in MySQL-5.0)</td>
<td>BIT</td>
<td>java.lang.Boolean</td>
</tr>
<tr>
<td>BIT( &gt; 1) (new in MySQL-5.0)</td>
<td>BIT</td>
<td>byte[]</td>
</tr>
<tr>
<td>TINYINT</td>
<td>TINYINT</td>
<td>java.lang.Boolean if the configuration property tinyInt1isBit is set to true (the default) and the storage size is 1, or java.lang.Integer if not.</td>
</tr>
<tr>
<td>BOOL, BOOLEAN</td>
<td>TINYINT</td>
<td>See TINYINT, above as these are aliases for TINYINT(1), currently.</td>
</tr>
<tr>
<td>SMALLINT[(M)] [UNSIGNED]</td>
<td>SMALLINT [UNSIGNED]</td>
<td>java.lang.Integer (regardless if UNSIGNED or not)</td>
</tr>
<tr>
<td>MEDIUMINT[(M)] [UNSIGNED]</td>
<td>MEDIUMINT [UNSIGNED]</td>
<td>java.lang.Integer, if UNSIGNED java.lang.Long (C/J 3.1 and earlier), or java.lang.Integer for C/J 5.0 and later</td>
</tr>
<tr>
<td>INT,INTEGER[(M)] [UNSlGNED]</td>
<td>INTEGER [UNSIGNED]</td>
<td>java.lang.Integer, if UNSIGNED java.lang.Long</td>
</tr>
<tr>
<td>BIGINT[(M)] [UNSIGNED]</td>
<td>BIGINT [UNSIGNED]</td>
<td>java.lang.Long, if UNSIGNED java.math.BigInteger</td>
</tr>
<tr>
<td>FLOAT[(M,D)]</td>
<td>FLOAT</td>
<td>java.lang.Float</td>
</tr>
<tr>
<td>DOUBLE[(M,B)]</td>
<td>DOUBLE</td>
<td>java.lang.Double</td>
</tr>
<tr>
<td>DECIMAL[(M[,D])]</td>
<td>DECIMAL</td>
<td>java.math.BigDecimal</td>
</tr>
<tr>
<td>DATE</td>
<td>DATE</td>
<td>java.sql.Date</td>
</tr>
<tr>
<td>DATETIME</td>
<td>DATETIME</td>
<td>java.sql.Timestamp</td>
</tr>
<tr>
<td>TIMESTAMP[(M)]</td>
<td>TIMESTAMP</td>
<td>java.sql.Timestamp</td>
</tr>
<tr>
<td>TIME</td>
<td>TIME</td>
<td>java.sql.Time</td>
</tr>
<tr>
<td>YEAR[(2l4)]</td>
<td>YEAR</td>
<td>If yearIsDateType configuration property is set to false, then the returned object type is java.sql.Short. If set to true (the default), then the returned object is of type java.sql.Date with the date set to January 1st, at midnight.</td>
</tr>
<tr>
<td>CHAR(M)</td>
<td>CHAR</td>
<td>java.lang.String (unless the character set for the column is BINARY, then byte[] is returned.</td>
</tr>
<tr>
<td>VARCHAR(M)</td>
<td>[BINARY]</td>
<td>VARCHAR    java.lang.String (unless the character set for the column is BINARY, then byte[] is returned.</td>
</tr>
<tr>
<td>BINARY(M)</td>
<td>BINARY</td>
<td>byte[]</td>
</tr>
<tr>
<td>VARBINARY(M)</td>
<td>VARBINARY</td>
<td>byte[]</td>
</tr>
<tr>
<td>TINYBLOB</td>
<td>TINYBLOB</td>
<td>byte[]</td>
</tr>
<tr>
<td>TINYTEXT</td>
<td>VARCHAR</td>
<td>java.lang.String</td>
</tr>
<tr>
<td>BLOB</td>
<td>BLOB</td>
<td>byte[]</td>
</tr>
<tr>
<td>TEXT</td>
<td>VARCHAR</td>
<td>java.lang.String</td>
</tr>
<tr>
<td>MEDIUMBLOB</td>
<td>MEDIUMBLOB</td>
<td>byte[]</td>
</tr>
<tr>
<td>MEDIUMTEXT</td>
<td>VARCHAR</td>
<td>java.lang.String</td>
</tr>
<tr>
<td>LONGBLOB</td>
<td>LONGBLOB</td>
<td>byte[]</td>
</tr>
<tr>
<td>LONGTEXT</td>
<td>VARCHAR</td>
<td>java.lang.String</td>
</tr>
<tr>
<td>ENUM(‘value1’,’value2’,…)</td>
<td>CHAR</td>
<td>java.lang.String</td>
</tr>
<tr>
<td>SET(‘value1’,’value2’,…)</td>
<td>CHAR</td>
<td>java.lang.String</td>
</tr>
</tbody>
</table>
<p>参考： <a href="http://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-type-conversions.html" target="_blank" rel="external">http://dev.mysql.com/doc/connector-j/5.1/en/connector-j-reference-type-conversions.html</a></p>
<h2 id="模拟ORM"><a href="#模拟ORM" class="headerlink" title="模拟ORM"></a>模拟ORM</h2><h3 id="根据实体映射表"><a href="#根据实体映射表" class="headerlink" title="根据实体映射表"></a>根据实体映射表</h3><p><strong>如下只是一个基本实例，想要完成更多特性，还是要下点功夫的。</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">public class CreateTableORM &#123;</span><br><span class="line">    </span><br><span class="line">    private static Map&lt;String,String&gt; ormField = getJavaMapMysql();</span><br><span class="line">    </span><br><span class="line">    Class&lt;?&gt; clazz;</span><br><span class="line">    </span><br><span class="line">    Connection conn;</span><br><span class="line">    </span><br><span class="line">    // 表名</span><br><span class="line">    String tableName;</span><br><span class="line">    </span><br><span class="line">    public CreateTableORM(Class&lt;?&gt; clazz , Connection conn)&#123;</span><br><span class="line">        this.clazz = clazz;</span><br><span class="line">        this.conn = conn;</span><br><span class="line">        tableName = clazz.getName();</span><br><span class="line">        </span><br><span class="line">        createTable();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private void createTable()&#123;</span><br><span class="line">        </span><br><span class="line">         StringBuffer sb = new StringBuffer();</span><br><span class="line">        </span><br><span class="line">         Arrays.asList(clazz.getDeclaredFields()).forEach(field -&gt;&#123;</span><br><span class="line">             </span><br><span class="line">            String fieldType = ormField.get(field.getType().getName());</span><br><span class="line">            String fieldName = field.getName();</span><br><span class="line">            </span><br><span class="line">            sb.append(String.format(&quot;%s %s,&quot;, fieldName,fieldType));</span><br><span class="line">        &#125;);</span><br><span class="line">        </span><br><span class="line">        String sql = String.format(&quot;Create Table If Not Exists %s (%s)&quot;,this.tableName, sb.deleteCharAt(sb.length()-1).toString());</span><br><span class="line">        </span><br><span class="line">        excuteSQL(sql);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    private void excuteSQL(String sql) &#123;</span><br><span class="line">        PreparedStatement statement;</span><br><span class="line">        </span><br><span class="line">        try &#123;</span><br><span class="line">            statement = conn.prepareStatement(sql);</span><br><span class="line">            statement.execute();</span><br><span class="line">        &#125; catch (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public static Map&lt;String,String&gt; getJavaMapMysql()&#123;</span><br><span class="line">        </span><br><span class="line">        /**定义并不标准**/</span><br><span class="line">        Map&lt;String,String&gt; map = new HashMap&lt;String,String&gt;();</span><br><span class="line">        map.put(&quot;java.lang.String&quot;, &quot;VARCHAR(255)&quot;);</span><br><span class="line">        map.put(&quot;java.lang.Character&quot;, &quot;VARCHAR(255)&quot;);</span><br><span class="line">        map.put(&quot;char&quot;, &quot;VARCHAR(255)&quot;);</span><br><span class="line">        map.put(&quot;java.lang.Double&quot;, &quot; DOUBLE(5,2)&quot;);</span><br><span class="line">        map.put(&quot;double&quot;, &quot; DOUBLE(5,2)&quot;);</span><br><span class="line">        map.put(&quot;java.lang.Float&quot;, &quot;FLOAT(5,2)&quot;);</span><br><span class="line">        map.put(&quot;float&quot;, &quot;FLOAT(5,2)&quot;);</span><br><span class="line">        map.put(&quot;java.lang.Integer&quot;, &quot;INT(11)&quot;);</span><br><span class="line">        map.put(&quot;int&quot;, &quot;INT(11)&quot;);</span><br><span class="line">        map.put(&quot;java.lang.Long&quot;, &quot;INTEGER(16)&quot;);</span><br><span class="line">        map.put(&quot;long&quot;, &quot;INTEGER(16)&quot;);</span><br><span class="line">        map.put(&quot;java.util.Date&quot;, &quot;DATE&quot;);</span><br><span class="line">        map.put(&quot;java.lang.Boolean&quot;, &quot;BIT(1)&quot;);</span><br><span class="line">        map.put(&quot;boolean&quot;, &quot;BIT(1)&quot;);</span><br><span class="line">        return map;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    //测试</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        Connection conn = MysqlJDBCPoolUtil.getConnection();</span><br><span class="line">        new CreateTableORM(Admin.class, conn);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="暂无需求。"><a href="#暂无需求。" class="headerlink" title="暂无需求。"></a>暂无需求。</h3><p><strong>日后，有需要再完善</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/04/12/2016/H2 DataBase 数据库/" itemprop="url">
                  H2 DataBase 数据库
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-04-12T17:49:00+08:00" content="2016-04-12">
              2016-04-12
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/DataBase/" itemprop="url" rel="index">
                    <span itemprop="name">DataBase</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/DataBase/H2/" itemprop="url" rel="index">
                    <span itemprop="name">H2</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/04/12/2016/H2 DataBase 数据库/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/04/12/2016/H2 DataBase 数据库/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>H2 DataBase属于Java 嵌入式数据库（内存数据库），除此之外还有HyperSQL Database、 Apache Derby。</p>
<p>H2 貌似用的人更多一些，这篇文章只是介绍 H2 Web开发实例。</p>
<p>H2 生产环境几乎没有人用，他不适用高并发和大数据，并发越大插入和读取性能越低。</p>
<p>H2 应用场景：</p>
<ul>
<li>小型内部系统</li>
<li>数据缓存</li>
<li>监控系统</li>
<li>测试环境（如：开启MySql模式）</li>
</ul>
<p><strong>以上都是我YY的，没有实战，可信度30%</strong></p>
<h2 id="H2-DataBase-数据库"><a href="#H2-DataBase-数据库" class="headerlink" title="H2 DataBase 数据库"></a>H2 DataBase 数据库</h2><h3 id="Maven-引入H2依赖"><a href="#Maven-引入H2依赖" class="headerlink" title="Maven 引入H2依赖"></a>Maven 引入H2依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.h2database&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;h2&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.4.191&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<h3 id="H2-实例"><a href="#H2-实例" class="headerlink" title="H2 实例"></a>H2 实例</h3><p><strong>部分实例参考官网</strong></p>
<h4 id="JDBC-连接"><a href="#JDBC-连接" class="headerlink" title="JDBC 连接"></a>JDBC 连接</h4><ul>
<li><p>获取JDBC 连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">private static String driver = &quot;org.h2.Driver&quot;;</span><br><span class="line">private static String url = &quot;jdbc:h2:./h2db&quot;;</span><br><span class="line">private static String username = &quot;root&quot;;</span><br><span class="line">private static String password = &quot;123456&quot;;</span><br><span class="line"></span><br><span class="line">public static Connection getConnection() &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        Class.forName(driver);</span><br><span class="line">        // 可以不用设置户名和密码</span><br><span class="line">        Connection connection = DriverManager.getConnection(url, username, password);</span><br><span class="line">        return connection;</span><br><span class="line">    &#125; catch (SQLException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; catch (ClassNotFoundException e) &#123;</span><br><span class="line">        // TODO Auto-generated catch block</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>获取JDBC连接池</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">private static final String url = &quot;jdbc:h2:./h2db&quot;;</span><br><span class="line">private static final String username = &quot;root&quot;;</span><br><span class="line">private static final String password = &quot;123456&quot;;</span><br><span class="line"></span><br><span class="line">private static JdbcConnectionPool pool = JdbcConnectionPool.create(url,username,password);</span><br><span class="line"></span><br><span class="line">static &#123;</span><br><span class="line">    pool.setLoginTimeout(1000); // 连接超时时间</span><br><span class="line">    pool.setMaxConnections(50); // 最大连接数</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @return 获取H2 JDBC连接池</span><br><span class="line"> */</span><br><span class="line">public static JdbcConnectionPool getJDBCConnectionPool()&#123;  </span><br><span class="line">    return pool;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line">public static Connection getConnection()&#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        return pool.getConnection();</span><br><span class="line">    &#125; catch (SQLException e) &#123;</span><br><span class="line">        // TODO Auto-generated catch block</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;finally&#123;</span><br><span class="line">        // 释放空闲连接</span><br><span class="line">        pool.dispose(); </span><br><span class="line">    &#125;</span><br><span class="line">    return null;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>jdbc:h2:./h2db 中h2db表示数据库名称,它会在当前路径中创建h2db.mv.db文件，用于记录数据库数据信息。</strong><br><strong>有了Connection（JDBC链接）我相信你已经无敌了。</strong></p>
<h3 id="H2-工具"><a href="#H2-工具" class="headerlink" title="H2 工具"></a>H2 工具</h3><p><strong>H2 与众不同的一点，它提供了一些工具操作</strong></p>
<h4 id="读写CVS"><a href="#读写CVS" class="headerlink" title="读写CVS"></a>读写CVS</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Write a CSV file.</span><br><span class="line"> */</span><br><span class="line">static void write() throws SQLException &#123;</span><br><span class="line">    SimpleResultSet rs = new SimpleResultSet();</span><br><span class="line">    rs.addColumn(&quot;NAME&quot;, Types.VARCHAR, 255, 0);</span><br><span class="line">    rs.addColumn(&quot;EMAIL&quot;, Types.VARCHAR, 255, 0);</span><br><span class="line">    rs.addColumn(&quot;PHONE&quot;, Types.VARCHAR, 255, 0);</span><br><span class="line">    rs.addRow(&quot;Bob Meier&quot;, &quot;bob.meier@abcde.abc&quot;, &quot;+41123456789&quot;);</span><br><span class="line">    rs.addRow(&quot;John Jones&quot;, &quot;john.jones@abcde.abc&quot;, &quot;+41976543210&quot;);</span><br><span class="line">    new Csv().write(&quot;data/test.csv&quot;, rs, null);</span><br><span class="line">&#125;</span><br><span class="line">/**</span><br><span class="line"> * Read a CSV file.</span><br><span class="line"> */</span><br><span class="line">static void read() throws SQLException &#123;</span><br><span class="line">    ResultSet rs = new Csv().read(&quot;data/test.csv&quot;, null, null);</span><br><span class="line">    ResultSetMetaData meta = rs.getMetaData();</span><br><span class="line">    while (rs.next()) &#123;</span><br><span class="line">        for (int i = 0; i &lt; meta.getColumnCount(); i++) &#123;</span><br><span class="line">            System.out.println(meta.getColumnLabel(i + 1) + &quot;: &quot; + rs.getString(i + 1));</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">    rs.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="服务和脚本"><a href="#服务和脚本" class="headerlink" title="服务和脚本"></a>服务和脚本</h4><p><strong>暂略吧，没什么应用场景。</strong></p>
<h3 id="H2-全文检索"><a href="#H2-全文检索" class="headerlink" title="H2 全文检索"></a>H2 全文检索</h3><p>H2 的全文检索主要使用FullText和FullTextLucene类，使用相对简单，主要使用Search() 和 SearchData()方法。</p>
<p><strong>使用H2 主要还是使用SQL操作，其他的特性也很少用。</strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2015/10/14/2015/CDH开启HA 访问HDFS/" itemprop="url">
                  CDH开启HA 访问HDFS
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2015-10-14T17:53:00+08:00" content="2015-10-14">
              2015-10-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Distributed-Development/" itemprop="url" rel="index">
                    <span itemprop="name">Distributed Development</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Distributed-Development/Hadoop/" itemprop="url" rel="index">
                    <span itemprop="name">Hadoop</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2015/10/14/2015/CDH开启HA 访问HDFS/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2015/10/14/2015/CDH开启HA 访问HDFS/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="常规的访问HDFS"><a href="#常规的访问HDFS" class="headerlink" title="常规的访问HDFS"></a>常规的访问HDFS</h3><p><strong>你可以通过如下指定<code>hdfs</code>地址访问hdfs，进行数据读写</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String inputDirFile = &quot;hdfs://namenode.hadoop:8020/user/hive/warehouse/mds_crawler_inf&quot;; </span><br><span class="line"> fs = FileSystem.newInstance(URI.create(directoryAddress.toString()),conf);</span><br></pre></td></tr></table></figure></p>
<p><strong>如果打开HA（高可用）后，这么方式是不可行的，Hadoop集群不知道你要访问的Master节点地址是哪一个（因为有两个HDFS访问地址）</strong><br>你可以将Hadoop配置文件<code>core-site.xml</code>和<code>hdfs-site.xml</code>放到根目录下（resources）<code>Configuration</code>会自动读取文件识别配置文件中定义的Master节点。假设为<code>master01.hadoop:8020</code>和<code>master02.hadoop:8020</code>而<code>dfs.nameservices</code>为<code>nameservice1</code>。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;configuration&gt;</span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.nameservices&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;nameservice1&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt; </span><br><span class="line">  &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.rpc-address.nameservice1.namenode26&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master01.hadoop:8020&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;  </span><br><span class="line">   &lt;property&gt;</span><br><span class="line">    &lt;name&gt;dfs.namenode.rpc-address.nameservice1.namenode39&lt;/name&gt;</span><br><span class="line">    &lt;value&gt;master02.hadoop:8020&lt;/value&gt;</span><br><span class="line">  &lt;/property&gt;</span><br><span class="line"></span><br><span class="line">.....</span><br></pre></td></tr></table></figure></p>
<p>当然也可以手动读取：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">static Configuration conf = new Configuration();  </span><br><span class="line">conf.addResource(ClassLoader.getSystemResourceAsStream(&quot;hdfs-site.xml&quot;));</span><br><span class="line">conf.addResource(ClassLoader.getSystemResourceAsStream(&quot;core-site.xml&quot;));  </span><br><span class="line">conf.addResource(ClassLoader.getSystemResourceAsStream(&quot;yarn-site.xml&quot;));</span><br></pre></td></tr></table></figure></p>
<p>你可以在项目中使用相对路径。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String inputDirFile = &quot;/user/hive/warehouse/ods_intelligence_victim/dt=20160131&quot;</span><br></pre></td></tr></table></figure></p>
<p>此时，你需要打成Jar运行，你会发现包如下错误。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">java.io.IOException: No FileSystem for scheme: hdfs</span><br><span class="line">        at org.apache.hadoop.fs.FileSystem.getFileSystemClass(FileSystem.java:2584)</span><br><span class="line">        at org.apache.hadoop.fs.FileSystem.createFileSystem(FileSystem.java:2591)</span><br><span class="line">        at org.apache.hadoop.fs.FileSystem.access$200(FileSystem.java:91)</span><br><span class="line">        at org.apache.hadoop.fs.FileSystem$Cache.getInternal(FileSystem.java:2630)</span><br><span class="line">        at org.apache.hadoop.fs.FileSystem$Cache.getUnique(FileSystem.java:2618)</span><br><span class="line">        at org.apache.hadoop.fs.FileSystem.newInstance(FileSystem.java:417)</span><br></pre></td></tr></table></figure></p>
<p>解决方案：<br><strong>明确指定使用哪一个Master</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">conf.addResource(ClassLoader.getSystemResourceAsStream(&quot;hdfs-site.xml&quot;));</span><br><span class="line">conf.addResource(ClassLoader.getSystemResourceAsStream(&quot;core-site.xml&quot;));</span><br><span class="line">conf.addResource(ClassLoader.getSystemResourceAsStream(&quot;yarn-site.xml&quot;));</span><br><span class="line"></span><br><span class="line">conf.set(&quot;fs.defaultFS&quot;,&quot; hdfs://nameservice1:8020/&quot;);</span><br><span class="line">conf.set(&quot;hadoop.job.ugi&quot;, &quot;cloudera&quot;);</span><br><span class="line">conf.set(&quot;fs.hdfs.impl&quot;, org.apache.hadoop.hdfs.DistributedFileSystem.class.getName());</span><br></pre></td></tr></table></figure></p>
<p><strong>并且使用绝对路径</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String inputDirFile = &quot;hdfs://nameservice1:8020/user/hive/warehouse/ods_intelligence_victim/dt=20160131&quot;</span><br></pre></td></tr></table></figure></p>
<p>参考：<br><a href="http://stackoverflow.com/questions/27805820/cant-access-hdfs-via-java-api-cloudera-cdh4-4-0" target="_blank" rel="external">http://stackoverflow.com/questions/27805820/cant-access-hdfs-via-java-api-cloudera-cdh4-4-0</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="cmp-cc" />
          <p class="site-author-name" itemprop="name">cmp-cc</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">54</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">38</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/cmp-cc" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        
        <div class="links-of-blogroll motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cmp-cc</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"cmp-cc"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();


  </script>

  
    
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  

 <script type="text/javascript">
  window.onload = function(){setTimeout(function(){/*无登陆账户*/if(!document.getElementsByClassName("ds-account-control")[0]){var cmp_cc_blog_user=localStorage.getItem("cmp-cc_blog_user");var author_name_value = cmp_cc_blog_user?'value="'+cmp_cc_blog_user+'"':'';var i = '<div class="ds-control-group" style="float:right;padding:6px;"><input type="text" '+author_name_value+'id="author_name_proxy" id="ds-dialog-name"  class="custom_input" style="color:#777;width=80%;font-size:13px;border:1px solid #ccc;height:25px;box-shadow: inset 0 1px 1px;padding: 2px 0px 0px 8px;" placeholder="昵称 or 登陆" required></div>';/*展开一个回复，再关闭。 多说没有参数配置啊~ 让人觉得不优雅*/var $last_ds_post_reply = $(".ds-post-reply:last");$last_ds_post_reply.click().click();$(".ds-post-options.ds-gradient-bg").append(i);$(".ds-post-button").click(function(){$(this).submit();$("#ds-wrapper").hide();var author_name = $("#author_name_proxy").val();$("#ds-wrapper #ds-dialog-name").val(author_name);$("#ds-wrapper form").submit();/*www.cmp-cc.github.com*/localStorage.setItem("cmp-cc_blog_user",author_name);$(".custom_input").val(author_name);});}},300);} 
 </script>





  
  
  

  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script>


</body>
</html>
