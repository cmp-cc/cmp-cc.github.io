<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css"/>




  <link href="//fonts.googleapis.com/css?family=Lato:300,400,700,400italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">



<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=0.5.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />





  <link rel="alternate" href="/atom.xml" title="I am cmp-cc" type="application/atom+xml" />




  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=0.5.0" />






<meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="I am cmp-cc">
<meta property="og:url" content="http://cmp-cc.github.io/page/3/index.html">
<meta property="og:site_name" content="I am cmp-cc">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="I am cmp-cc">
<meta name="twitter:description">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> I am cmp-cc </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?0fb6f1a75a76726c10a144a8257465e3";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">I am cmp-cc</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">一直在打杂，从未被超越。</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-home fa-fw"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-archive fa-fw"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-tags fa-fw"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-th fa-fw"></i> <br />
            
            分类
          </a>
        </li>
      

      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/24/2014/验证码kaptcha的应用/" itemprop="url">
                  验证码kaptcha在Web项目中应用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-10-24T17:50:00+08:00" content="2014-10-24">
              2014-10-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Java-Web/" itemprop="url" rel="index">
                    <span itemprop="name">Java Web</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/10/24/2014/验证码kaptcha的应用/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/10/24/2014/验证码kaptcha的应用/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>任何项目 项目中，验证码功能是必不可少的，可能你之前都是<code>awt image</code> 生成的，现在你可以试一试kaptcha了，kaptcha 是个生成验证码的Library。<br>这篇文件介绍kaptcha在Web项目中的应用，并给出三个可运行的实例。</p>
<p>三个实例以不同的形式实现。（都是用户登陆）</p>
<ul>
<li>实例 1<br><strong>Spring实例，控制器继承<code>KaptchaExtend</code>，使用默认的图形。比较简单</strong></li>
<li>实例 2<br><strong>Spring实例，自定义图形实例，实例化<code>DefaultKaptcha</code>对象自定义图形。</strong></li>
<li>实例 3<br><strong>Servlet实例,web.xml 中配置<code>com.google.code.kaptcha.servlet.KaptchaServlet</code>对象的映射关系，通过<code>init-param</code>元素进行图形配置</strong></li>
</ul>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><ul>
<li><p>引入依赖<br>三个实例中都可以不使用Spring，只是Spring 演示比较方便。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;3.1.0&lt;/version&gt;</span><br><span class="line">        &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;4.0.4.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;com.github.axet&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;kaptcha&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;0.0.8&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>web.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app version=&quot;3.1&quot; </span><br><span class="line">        xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot; </span><br><span class="line">        xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">        xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee </span><br><span class="line">            http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;&gt; </span><br><span class="line">            </span><br><span class="line">    &lt;display-name&gt;Kaptcha Example&lt;/display-name&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;spring&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;org.springframework.web.servlet.DispatcherServlet&lt;/servlet-class&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">            &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;spring&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;filter&gt;</span><br><span class="line">        &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;</span><br><span class="line">        &lt;filter-class&gt;org.springframework.web.filter.CharacterEncodingFilter&lt;/filter-class&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;encoding&lt;/param-name&gt;</span><br><span class="line">            &lt;param-value&gt;utf-8&lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">    &lt;/filter&gt;</span><br><span class="line">    &lt;filter-mapping&gt;</span><br><span class="line">        &lt;filter-name&gt;encodingFilter&lt;/filter-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/filter-mapping&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>applicationContext.xml</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</span><br><span class="line">        http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;context:annotation-config /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;context:component-scan base-package=&quot;org.freecode&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;mvc:annotation-driven /&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="视图（View）"><a href="#视图（View）" class="headerlink" title="视图（View）"></a>视图（View）</h2><p><strong>一共包含三个页面，登陆页面(login.jsp)、登陆成功(login-success.jsp)。</strong></p>
<ul>
<li><p>login.jsp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=&quot;java&quot; contentType=&quot;text/html; charset=utf-8&quot;</span><br><span class="line">    pageEncoding=&quot;utf-8&quot;%&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;</span><br><span class="line">&lt;title&gt;Insert title here&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=&quot;login&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;label&gt;User: &lt;input type=&quot;text&quot; name=&quot;user&quot; &gt; &lt;/label&gt; &lt;br /&gt;</span><br><span class="line">    &lt;label&gt;Password: &lt;input type=&quot;password&quot; name=&quot;password&quot; &gt;&lt;/label&gt;&lt;br /&gt;</span><br><span class="line">    &lt;label&gt;</span><br><span class="line">        验证码  &lt;input name=&quot;captcha&quot; type=&quot;text&quot; id=&quot;kaptcha&quot;&gt;</span><br><span class="line">   &lt;/label&gt;&lt;br /&gt;</span><br><span class="line">   &lt;img src=&quot;captcha.jpg&quot; id=&quot;captcha_img&quot;/&gt; &lt;a href=&quot;#&quot; onclick=&quot;changeCode()&quot;&gt;看不清?换一张&lt;/a&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;注册&quot;&gt;</span><br><span class="line">    </span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;script type=&quot;text/javascript&quot;&gt;</span><br><span class="line">    function changeCode()&#123;</span><br><span class="line">        document.getElementById(&quot;captcha_img&quot;).src=&quot;captcha.jpg&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>login-success.jsp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Success</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="实例-1"><a href="#实例-1" class="headerlink" title="实例 1"></a>实例 1</h2><p><strong>这是使用Kaptcha 最简单的实例（不自定义图片形态）</strong></p>
<ul>
<li>Controller<br><strong>控制器继承<code>com.google.code.kaptcha.servlet.KaptchaExtend</code>类。KaptchaExtend可以生成简单的图片形态。</strong></li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">package org.freecode.controller;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line">import com.google.code.kaptcha.servlet.KaptchaExtend;</span><br><span class="line">@Controller</span><br><span class="line">public class LoginController extends KaptchaExtend &#123;</span><br><span class="line">    /**</span><br><span class="line">     * 1、生成图片.</span><br><span class="line">     * 2、Session 保存文件Key</span><br><span class="line">     * 3、Response 响应图片给客户端</span><br><span class="line">     */</span><br><span class="line">    @RequestMapping(value = &quot;/captcha.jpg&quot;, method = RequestMethod.GET)</span><br><span class="line">    public void captcha(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException &#123;</span><br><span class="line">        super.captcha(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @RequestMapping(value = &quot;/login&quot;, method = RequestMethod.POST)</span><br><span class="line">    public String registerPost( String user,</span><br><span class="line">        String password,String captcha, HttpServletRequest request) &#123;</span><br><span class="line">        </span><br><span class="line">        System.out.println(String.format(&quot;用户名为：%s\n密码为：%s\n验证码:%s&quot;, user,password,captcha));</span><br><span class="line">        </span><br><span class="line">        /**</span><br><span class="line">         * 1、获取Session 中 Text值</span><br><span class="line">         * 2、验证客户端captcha是否一致</span><br><span class="line">         */</span><br><span class="line">        if (!captcha.equals(getGeneratedKey(request)))</span><br><span class="line">            throw new RuntimeException(&quot;bad captcha&quot;);</span><br><span class="line">        //转发到login-success.jsp页面</span><br><span class="line">        return &quot;login-success.jsp&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>captcha</code>方法生成一张图片,并将相关信息写入Session(包含正确文字信息).<code>getGeneratedKey</code>方法通过Session获取文字信息进行校验。</p>
</blockquote>
<ul>
<li>演示</li>
</ul>
<img src="/2014/10/24/2014/验证码kaptcha的应用/1bca8479-c940-4021-81a3-54f8c9e60bcb.png" alt="实例1 登陆演示" title="实例1 登陆演示"> 
<h2 id="Kaptcha-可以选的配置项"><a href="#Kaptcha-可以选的配置项" class="headerlink" title="Kaptcha 可以选的配置项"></a>Kaptcha 可以选的配置项</h2><p>你可以实例化<code>DefaultKaptcha</code>对象，配置这里参数。 </p>
<ul>
<li>实例2演示，通过Spring注解的方式进行依赖注入。</li>
<li>实例3演示，在web.xml 配置Servlet <code>com.google.code.kaptcha.servlet.KaptchaServlet</code>映射关系，并配置自定义图形。<br>配置名称 | 描述 | 默认值<br>— | — | —<br>kaptcha.GimpyEngine | 渲染引擎（自定义样式）| 默认WaterRipple<br>kaptcha.textproducer.font.names |    验证码文本字体样式  |默认为:new Font(“Arial”, 1, fontSize), new Font(“Courier”, 1, fontSize)<br>kaptcha.textproducer.font.size |  验证码文本字符大小  |默认为:40<br>kaptcha.textproducer.font.color |  验证码文本字符颜色 | 默认为:Color.BLACK<br>kaptcha.image.width  |  验证码图片宽度  |默认为:200<br>kaptcha.image.height  | 验证码图片高度 | 默认为:50<br>kaptcha.border  | 是否有边框  | 默认为:yes  可以选(yes，no )<br>kaptcha.border.color |   边框颜色 |  默认为:Color.BLACK  |<br>kaptcha.border.thickness |  边框粗细度|  默认为: 1<br>kaptcha.textproducer.impl  |  验证码文本生成器|  默认为: DefaultTextCreator<br>kaptcha.textproducer.char.string|    验证码文本字符内容范围  |默认为: abcde2345678gfynmnpwx<br>kaptcha.textproducer.char.length |   验证码文本字符长度  |默认为:5<br>kaptcha.textproducer.char.space |  验证码文本字符间距  |默认为:2<br>kaptcha.noise.impl  |   验证码噪点生成对象  |默认为:DefaultNoise<br>kaptcha.noise.color |   验证码噪点颜色   |默认为:Color.BLACK<br>kaptcha.background.impl|    验证码背景生成器   |默认为:DefaultBackground<br>kaptcha.background.clear.from  |  验证码背景颜色渐进|  默认为:Color.LIGHT_GRAY<br>kaptcha.background.clear.to |   验证码背景颜色渐进  | 默认为:Color.WHITE<br>kaptcha.producer.impl  |  验证码生成器 | 默认为: DefaultKaptcha<br>kaptcha.obscurificator.impl |   验证码样式引擎 | 默认为:WaterRipple<br>kaptcha.word.impl   | 验证码文本字符渲染  | 默认为:DefaultWordRenderer  </li>
</ul>
<h2 id="实例-2"><a href="#实例-2" class="headerlink" title="实例 2"></a>实例 2</h2><p><strong>你会发现实例2和实例如此的相似</strong></p>
<ul>
<li>applicationContext.xml 创建<code>captcha</code> Bean (添加如下即可)<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">    &lt;!-- 登陆时验证码的配置 --&gt;</span><br><span class="line">    &lt;bean id=&quot;captchaProducer&quot; class=&quot;com.google.code.kaptcha.impl.DefaultKaptcha&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;config&quot;&gt;</span><br><span class="line">            &lt;bean class=&quot;com.google.code.kaptcha.util.Config&quot;&gt;</span><br><span class="line">                &lt;!--通过构造函数注入属性值 --&gt;</span><br><span class="line">                &lt;constructor-arg type=&quot;java.util.Properties&quot;&gt;</span><br><span class="line">                    &lt;props&gt;</span><br><span class="line">                        &lt;!-- 验证码宽度、高度 --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.image.width&quot;&gt;150&lt;/prop&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.image.height&quot;&gt;60&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- 验证码内容范围和个数 --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.char.string&quot;&gt;abcdegfynmnpwx123456789&lt;/prop&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.char.length&quot;&gt;5&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- 是否有边框 --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.border&quot;&gt;no&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- 验证码字体颜色和大小 --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.font.color&quot;&gt;red&lt;/prop&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.font.size&quot;&gt;35&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- 验证码所属字体样式 --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.font.names&quot;&gt;Arial, Courier&lt;/prop&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.background.clear.from&quot;&gt;white&lt;/prop&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.background.clear.to&quot;&gt;white&lt;/prop&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.obscurificator.impl&quot;&gt;com.google.code.kaptcha.impl.ShadowGimpy&lt;/prop&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.noise.impl&quot;&gt;com.google.code.kaptcha.impl.NoNoise&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- 噪点颜色(干扰线) --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.noise.color&quot;&gt;black&lt;/prop&gt;</span><br><span class="line">                        &lt;!-- 验证码文本字符间距 --&gt;</span><br><span class="line">                        &lt;prop key=&quot;kaptcha.textproducer.char.space&quot;&gt;3&lt;/prop&gt;</span><br><span class="line">                    &lt;/props&gt;</span><br><span class="line">                &lt;/constructor-arg&gt;</span><br><span class="line">            &lt;/bean&gt;</span><br><span class="line">        &lt;/property&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>自己去配置，如上很多废话。</p>
</blockquote>
<ul>
<li><p>验证码工具类(KaptchaUtils.java)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">package org.freecode.util;</span><br><span class="line">import java.awt.image.BufferedImage;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import javax.imageio.ImageIO;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.ServletOutputStream;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import javax.servlet.http.HttpSession;</span><br><span class="line">import com.google.code.kaptcha.impl.DefaultKaptcha;</span><br><span class="line">/**</span><br><span class="line"> * </span><br><span class="line"> * @author cmp-cc</span><br><span class="line"> * @mail baiwoyidao@163.com</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public class KaptchaUtils &#123;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 1、生成Image</span><br><span class="line">     * 2、Response 到客户端</span><br><span class="line">     */</span><br><span class="line">    public static void captcha(DefaultKaptcha kaptchaProducer,HttpServletRequest req, HttpServletResponse resp)</span><br><span class="line">            throws ServletException, IOException &#123;</span><br><span class="line">        resp.setHeader(&quot;Cache-Control&quot;, &quot;no-store, no-cache&quot;);</span><br><span class="line">        resp.setContentType(&quot;image/jpeg&quot;);</span><br><span class="line">        String capText = kaptchaProducer.createText();</span><br><span class="line">        req.getSession().setAttribute(</span><br><span class="line">                com.google.code.kaptcha.Constants.KAPTCHA_SESSION_KEY, capText);</span><br><span class="line">        BufferedImage bi = kaptchaProducer.createImage(capText);</span><br><span class="line">        ServletOutputStream out = resp.getOutputStream();</span><br><span class="line">        ImageIO.write(bi, &quot;jpg&quot;, out);</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 1、获取Session 文本值</span><br><span class="line">     * @param req</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static String getGeneratedKey(HttpServletRequest req) &#123;</span><br><span class="line">        HttpSession session = req.getSession();</span><br><span class="line">        return (String) session</span><br><span class="line">                .getAttribute(com.google.code.kaptcha.Constants.KAPTCHA_SESSION_KEY);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>控制器(LoginController2.java)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">package org.freecode.controller;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import org.freecode.util.KaptchaUtils;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line">import com.google.code.kaptcha.impl.DefaultKaptcha;</span><br><span class="line">@Controller</span><br><span class="line">public class LoginController2 &#123;</span><br><span class="line">    /**</span><br><span class="line">     * Kaptcha 验证码</span><br><span class="line">     */</span><br><span class="line">    @Autowired</span><br><span class="line">    private DefaultKaptcha kaptchaProducer;</span><br><span class="line">    </span><br><span class="line">    /**</span><br><span class="line">     * 生成验证码</span><br><span class="line">     * </span><br><span class="line">     * @param request</span><br><span class="line">     * @param response</span><br><span class="line">     * @throws Exception</span><br><span class="line">     */</span><br><span class="line">    @RequestMapping(value = &quot;captcha2.jpg&quot;, method = RequestMethod.GET)</span><br><span class="line">    public void captcha(HttpServletRequest req, HttpServletResponse resp)</span><br><span class="line">            throws Exception &#123;</span><br><span class="line">        KaptchaUtils.captcha(kaptchaProducer, req, resp);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    @RequestMapping(value = &quot;/login2&quot;, method = RequestMethod.POST)</span><br><span class="line">    public String registerPost(String user, String password, String captcha,</span><br><span class="line">            HttpServletRequest request) &#123;</span><br><span class="line">        System.out.println(String.format(&quot;用户名为：%s\n密码为：%s\n验证码:%s&quot;, user,</span><br><span class="line">                password, captcha));</span><br><span class="line">        /**</span><br><span class="line">         * 1、获取Session 中 Text值 </span><br><span class="line">         * 2、验证客户端captcha是否一致</span><br><span class="line">         */</span><br><span class="line">        if (!captcha.equals(KaptchaUtils.getGeneratedKey(request)))</span><br><span class="line">            throw new RuntimeException(&quot;bad captcha&quot;);</span><br><span class="line">        // 转发到login-success.jsp页面</span><br><span class="line">        return &quot;login-success.jsp&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改客户端（login.jsp）</p>
<ul>
<li><code>&lt;img src=&quot;captcha.jpg&quot; id=&quot;captcha_img&quot;/&gt;</code> 改为<code>&lt;img src=&quot;captcha2.jpg&quot; id=&quot;captcha_img&quot;/&gt;</code></li>
<li><code>&lt;form action=&quot;login&quot; method=&quot;post&quot;&gt;</code> 改为<code>&lt;form action=&quot;login2&quot; method=&quot;post&quot;&gt;</code></li>
<li><code>document.getElementById(&quot;captcha_img&quot;).src=&quot;captcha.jpg&quot;;</code>改为<code>document.getElementById(&quot;captcha_img&quot;).src=&quot;captcha2.jpg&quot;;</code></li>
</ul>
</li>
<li>演示</li>
</ul>
<img src="/2014/10/24/2014/验证码kaptcha的应用/cfbeba3c-a3f0-4d7d-b5c9-bf22c0ceccef.jpg" alt="实例2 登陆演示" title="实例2 登陆演示"> 
<img src="/2014/10/24/2014/验证码kaptcha的应用/49ca8163-ccc5-48ef-8f4d-7981d7e0b963.png" alt="登陆成功" title="登陆成功">
<blockquote>
<p>看样子效果不好，间距在小一点，多一些干扰线就Ok了</p>
</blockquote>
<h2 id="实例-3"><a href="#实例-3" class="headerlink" title="实例 3"></a>实例 3</h2><p>实例3 就略过吧！   貌似随便搜一下是可以搜到的。（实例 3 的步骤我已经介绍的很清楚了。）</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/10/10/2014/Java Web异常/" itemprop="url">
                  Java Web异常
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-10-10T20:05:17+08:00" content="2014-10-10">
              2014-10-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Java-Web/" itemprop="url" rel="index">
                    <span itemprop="name">Java Web</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/10/10/2014/Java Web异常/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/10/10/2014/Java Web异常/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>记录一下Java Web 遇到的一些异常情况.</p>
<h2 id="org-apache-catalina-LifecycleException"><a href="#org-apache-catalina-LifecycleException" class="headerlink" title="org.apache.catalina.LifecycleException"></a>org.apache.catalina.LifecycleException</h2><h3 id="异常信息"><a href="#异常信息" class="headerlink" title="异常信息"></a>异常信息</h3><p><strong>使用Spring MVC 启动的时候发生</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">严重: ContainerBase.addChild: start: </span><br><span class="line">org.apache.catalina.LifecycleException: Failed to start component [StandardEngine[Catalina].StandardHost[localhost].StandardContext[/upload2]]</span><br><span class="line">	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:154)</span><br><span class="line">	at org.apache.catalina.core.ContainerBase.addChildInternal(ContainerBase.java:724)</span><br><span class="line">	at org.apache.catalina.core.ContainerBase.addChild(ContainerBase.java:700)</span><br><span class="line">	at org.apache.catalina.core.StandardHost.addChild(StandardHost.java:714)</span><br><span class="line">	at org.apache.catalina.startup.HostConfig.deployDescriptor(HostConfig.java:581)</span><br><span class="line">	at org.apache.catalina.startup.HostConfig$DeployDescriptor.run(HostConfig.java:1686)</span><br><span class="line">	at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)</span><br><span class="line">	at java.util.concurrent.FutureTask.run(FutureTask.java:266)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)</span><br><span class="line">	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)</span><br><span class="line">	at java.lang.Thread.run(Thread.java:744)</span><br><span class="line">Caused by: java.lang.NoClassDefFoundError: org/springframework/web/context/request/async/CallableProcessingInterceptor</span><br><span class="line">	at java.lang.Class.getDeclaredFields0(Native Method)</span><br><span class="line">	at java.lang.Class.privateGetDeclaredFields(Class.java:2570)</span><br><span class="line">	at java.lang.Class.getDeclaredFields(Class.java:1903)</span><br><span class="line">	at org.apache.catalina.util.Introspection.getDeclaredFields(Introspection.java:106)</span><br><span class="line">	at org.apache.catalina.startup.WebAnnotationSet.loadFieldsAnnotation(WebAnnotationSet.java:258)</span><br><span class="line">	at org.apache.catalina.startup.WebAnnotationSet.loadApplicationServletAnnotations(WebAnnotationSet.java:137)</span><br><span class="line">	at org.apache.catalina.startup.WebAnnotationSet.loadApplicationAnnotations(WebAnnotationSet.java:65)</span><br><span class="line">	at org.apache.catalina.startup.ContextConfig.applicationAnnotationsConfig(ContextConfig.java:331)</span><br><span class="line">	at org.apache.catalina.startup.ContextConfig.configureStart(ContextConfig.java:770)</span><br><span class="line">	at org.apache.catalina.startup.ContextConfig.lifecycleEvent(ContextConfig.java:302)</span><br><span class="line">	at org.apache.catalina.util.LifecycleSupport.fireLifecycleEvent(LifecycleSupport.java:117)</span><br><span class="line">	at org.apache.catalina.util.LifecycleBase.fireLifecycleEvent(LifecycleBase.java:90)</span><br><span class="line">	at org.apache.catalina.core.StandardContext.startInternal(StandardContext.java:5083)</span><br><span class="line">	at org.apache.catalina.util.LifecycleBase.start(LifecycleBase.java:150)</span><br><span class="line">	... 10 more</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: org.springframework.web.context.request.async.CallableProcessingInterceptor</span><br><span class="line">	at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1324)</span><br><span class="line">	at org.apache.catalina.loader.WebappClassLoader.loadClass(WebappClassLoader.java:1177)</span><br><span class="line">	... 24 more</span><br></pre></td></tr></table></figure></p>
<h3 id="解决方案："><a href="#解决方案：" class="headerlink" title="解决方案："></a>解决方案：</h3><ul>
<li>引入<a href="http://mvnrepository.com/artifact/com.paypal.sdk/paypal-core" target="_blank" rel="external">PayPal Core</a> 到<code>WEB-INF\lib</code> 或Maven依赖。</li>
<li>参考：<br><code>http://stackoverflow.com/questions/18404916/failed-to-start-component-standardenginecatalina-standardhostlocalhost-stan</code></li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/08/11/2014/Spring Bean 扩展点/" itemprop="url">
                  Spring Bean 扩展点
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-08-11T23:53:00+08:00" content="2014-08-11">
              2014-08-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaWeb/Spring/" itemprop="url" rel="index">
                    <span itemprop="name">Spring</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/08/11/2014/Spring Bean 扩展点/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/08/11/2014/Spring Bean 扩展点/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>BeanFactoryPostProcessor</li>
<li>PropertyPlaceholderConfigurer </li>
</ul>
<h2 id="PropertyPlaceholderConfigurer"><a href="#PropertyPlaceholderConfigurer" class="headerlink" title="PropertyPlaceholderConfigurer"></a>PropertyPlaceholderConfigurer</h2><p>它用于配置环境变量、系统属性、等变量。<br>PropertyPlaceholderConfigurer 是BeanFactoryPostProcessor（Bean工厂后置处理器）的一个实现<br>通过Spring Bean 配置，将properties文件装配到一个对象中。<br><strong>在设置数据源的时候（C3P0、DBCP），<code>BasicDataSource</code>对象继承了<code>PropertyPlaceholderConfigurer</code> 完成<code>properties</code>注入</strong></p>
<h3 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h3><ul>
<li>properties 文件（jdbc.properties）</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">jdbc.driverClass=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://127.0.0.1:3306/cmpcc?useUnicode=true&amp;characterEncoding=UTF-8&amp;zeroDateTimeBehavior=convertToNull</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=123456</span><br></pre></td></tr></table></figure>
<ul>
<li><code>PropertyPlaceholderConfigurer</code>配置Bean<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;propertyConfigurer&quot;</span><br><span class="line">    class=&quot;org.springframework.beans.factory.config.PropertyPlaceholderConfigurer&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;locations&quot;&gt;</span><br><span class="line">        &lt;list&gt;</span><br><span class="line">            &lt;value&gt;classpath:jdbc.properties&lt;/value&gt;</span><br><span class="line">        &lt;/list&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;fileEncoding&quot;&gt;</span><br><span class="line">        &lt;value&gt;UTF-8&lt;/value&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;ignoreResourceNotFound&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;searchSystemEnvironment&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;systemPropertiesModeName&quot; value=&quot;SYSTEM_PROPERTIES_MODE_OVERRIDE&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="在开发中的应用。"><a href="#在开发中的应用。" class="headerlink" title="在开发中的应用。"></a>在开发中的应用。</h3><p>用于配置站点信息、系统属性、环境变量等</p>
<ul>
<li></li>
<li><p>系统属性工具类<br><strong>用于保存配置属性，继承PropertyPlaceholderConfigurer</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">public class PropertyUtils extends PropertyPlaceholderConfigurer &#123;</span><br><span class="line"></span><br><span class="line">	public static final Logger logger = Logger.getLogger(PropertyUtils.class);</span><br><span class="line"></span><br><span class="line">	private static Map&lt;String, String&gt; propertyMap;</span><br><span class="line"></span><br><span class="line">	@Override</span><br><span class="line">	protected void processProperties(</span><br><span class="line">			ConfigurableListableBeanFactory beanFactoryToProcess,</span><br><span class="line">			Properties props) throws BeansException &#123;</span><br><span class="line">		super.processProperties(beanFactoryToProcess, props);</span><br><span class="line">		propertyMap = new HashMap&lt;String, String&gt;();</span><br><span class="line">		</span><br><span class="line">		for(Entry&lt;Object, Object&gt; entry : props.entrySet())&#123;</span><br><span class="line">			propertyMap.put(entry.getKey().toString(), entry.getValue().toString());</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public static String getValue(String name) &#123;</span><br><span class="line">		String value = propertyMap.get(name);</span><br><span class="line">		if (StringUtils.isBlank(value)) &#123;</span><br><span class="line">			return &quot;&quot;;</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			return value;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>beans.xml 配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;propertyConfigurer&quot; class=&quot;org.freecode.util.PropertyUtils&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;locations&quot;&gt;</span><br><span class="line">        &lt;list&gt;</span><br><span class="line">            &lt;value&gt;classpath:systemconfig.properties&lt;/value&gt;</span><br><span class="line">        &lt;/list&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>systemconfig.properties</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#超级管理员</span><br><span class="line">system.admin=admin</span><br><span class="line">#存储方式（server | local）</span><br><span class="line">system.storage=server</span><br><span class="line">#数据库配置</span><br><span class="line">jdbc.driverClass=com.mysql.jdbc.Driver</span><br><span class="line">jdbc.url=jdbc:mysql://127.0.0.1:3306/systemname?useUnicode=true&amp;characterEncoding=UTF-8&amp;zeroDateTimeBehavior=convertToNull</span><br><span class="line">jdbc.username=root</span><br><span class="line">jdbc.password=123456</span><br><span class="line">jdbc.initialPoolSize=2</span><br><span class="line">jdbc.minPoolSize=2</span><br><span class="line">jdbc.maxPoolSize=5</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="BeanFactoryPostProcessor"><a href="#BeanFactoryPostProcessor" class="headerlink" title="BeanFactoryPostProcessor"></a>BeanFactoryPostProcessor</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/07/15/FreeMarker Web集成/" itemprop="url">
                  FreeMarker Web集成
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-07-15T22:53:00+08:00" content="2014-07-15">
              2014-07-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaWeb/FreeMarker/" itemprop="url" rel="index">
                    <span itemprop="name">FreeMarker</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/07/15/FreeMarker Web集成/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/07/15/FreeMarker Web集成/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>已更新</strong></p>
<p>FreeMarker 操作流程（其实开发中肯定不是这样的~~~！！）</p>
<ul>
<li>init : 在Servlet <code>init()</code>方法中创建<code>Configuration</code> 对象</li>
<li>service: 在服务层填充Model，实例化模板</li>
<li>controller: 指定输出到servlet PrintWriter中或者生成静态页面</li>
</ul>
<blockquote>
<p>FreeMarker 提供如上行为(直接将ftl文件转换为文本信息，类似JSP)，我们只需要配置FreeMarker Servlet 进行渲染即可。<br>同样你可以实现自己的Servlet 操作FreeMarker的行为</p>
</blockquote>
<h2 id="Servlet-集成"><a href="#Servlet-集成" class="headerlink" title="Servlet 集成"></a>Servlet 集成</h2><p>使用FreeMarker的Servlet创建一个简单的项目实例。</p>
<ul>
<li><p>引入依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.1.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.freemarker&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;freemarker&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.3.23&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>目录基本结构</p>
</li>
</ul>
<img src="/2014/07/15/FreeMarker%20Web集成/dce51fbe-0642-47b6-b35a-b5024d288632.png" alt="目录结构" title="目录结构">
<ul>
<li><p>配置 <code>web.xml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span><br><span class="line">    version=&quot;3.0&quot;&gt;</span><br><span class="line">    &lt;welcome-file-list&gt;</span><br><span class="line">        &lt;welcome-file&gt;index.html&lt;/welcome-file&gt;</span><br><span class="line">    &lt;/welcome-file-list&gt;</span><br><span class="line">    &lt;!-- FREEMARKER SERVLET CONFIGURATION --&gt;</span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;freemarker&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;</span><br><span class="line">            freemarker.ext.servlet.FreemarkerServlet</span><br><span class="line">        &lt;/servlet-class&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;TemplatePath&lt;/param-name&gt;</span><br><span class="line">            &lt;param-value&gt;/WEB-INF/freemarker&lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;NoCache&lt;/param-name&gt;</span><br><span class="line">            &lt;param-value&gt;true&lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;ContentType&lt;/param-name&gt;</span><br><span class="line">            &lt;param-value&gt;text/html; charset=UTF-8&lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;freemarker&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;*.ftl&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;HelloFreemarkerServlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;org.freecode.ftl.HelloFreemarkerServlet</span><br><span class="line">        &lt;/servlet-class&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;HelloFreemarkerServlet&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/HelloFreemarkerServlet&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>目录基本结构</p>
</li>
</ul>
<img src="/2014/07/15/FreeMarker%20Web集成/c1b083f7-d483-4112-a1a3-14c638c358be.png" alt="目录结构" title="目录结构">
<ul>
<li><p>创建一个控制器 <code>HelloFreemarkerServlet</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">package org.freecode.ftl;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import javax.servlet.ServletException;</span><br><span class="line">import javax.servlet.http.HttpServlet;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">public class HelloFreemarkerServlet extends HttpServlet &#123;</span><br><span class="line">  private static final long serialVersionUID = 1L;</span><br><span class="line">  </span><br><span class="line">  @Override</span><br><span class="line">  protected void service(HttpServletRequest request,  HttpServletResponse response)</span><br><span class="line">  throws ServletException, IOException &#123;</span><br><span class="line">    // Populated model in request attributes</span><br><span class="line">    request.setAttribute(&quot;message&quot;, request.getParameter(&quot;message&quot;));</span><br><span class="line">    // Dispatch to Freemarker Servlet</span><br><span class="line">    request.getRequestDispatcher(&quot;hello.ftl&quot;).forward(request, response);    </span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>FreeMarker 页面 <code>WEB-INF/freemarker/hello.ftl</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Freemarker MVC Example&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form action=&quot;HelloFreemarkerServlet&quot; method=&quot;post&quot;&gt;</span><br><span class="line">            Message: &lt;input type=&quot;text&quot; name=&quot;message&quot;&gt;&lt;br/&gt;</span><br><span class="line">            &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        &lt;#if message??&gt;$&#123;message?html&#125;&lt;/#if&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建一个欢迎页面<code>index.html</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Freemarker MVC Integration Test Page&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;a href=&quot;HelloFreemarkerServlet&quot;&gt;Servlet Example&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>访问页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/ftl_servlet</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Spring-MVC-集成"><a href="#Spring-MVC-集成" class="headerlink" title="Spring MVC 集成"></a>Spring MVC 集成</h2><ul>
<li><p>引入依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.1.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.freemarker&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;freemarker&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.3.23&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.2.6.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-context-support&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.2.6.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置 <code>web.xml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app xmlns=&quot;http://java.sun.com/xml/ns/javaee&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_3_0.xsd&quot;</span><br><span class="line">    version=&quot;3.0&quot;&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">           &lt;servlet-name&gt;springMvc&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;</span><br><span class="line">           org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">        &lt;/servlet-class&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">            &lt;param-value&gt;classpath:applicationContext.xml&lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;springMvc&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置applicationContext.xml文件<br><strong>如下配置FreeMarker的最小配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">	xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</span><br><span class="line">	xsi:schemaLocation=&quot;http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.2.xsd</span><br><span class="line">		http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.2.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">	&lt;context:component-scan base-package=&quot;org.freecode.ftl&quot; /&gt;</span><br><span class="line">	&lt;mvc:annotation-driven /&gt;</span><br><span class="line">	</span><br><span class="line">        &lt;!-- FreeMarker的配置 --&gt;</span><br><span class="line">	&lt;bean id=&quot;freemarkerConfig&quot; class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;&gt;</span><br><span class="line">		&lt;property name=&quot;templateLoaderPath&quot; value=&quot;/WEB-INF/freemarker/&quot; /&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">        &lt;!-- 处理静态资源 --&gt;</span><br><span class="line">	&lt;mvc:resources mapping=&quot;/*.html&quot; location=&quot;/&quot; /&gt;</span><br><span class="line"></span><br><span class="line">         &lt;!-- 配置 FreeMarker视图解析器 --&gt;</span><br><span class="line">	&lt;bean id=&quot;viewResolver&quot;  class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver&quot;&gt;</span><br><span class="line">		&lt;property name=&quot;cache&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">		&lt;property name=&quot;prefix&quot; value=&quot;&quot; /&gt;</span><br><span class="line">		&lt;property name=&quot;suffix&quot; value=&quot;.ftl&quot; /&gt;</span><br><span class="line">	&lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建 HelloController</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">package org.freecode.ftl;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.ModelAttribute;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line">@Controller</span><br><span class="line">public class HelloController &#123;</span><br><span class="line">  @RequestMapping(&quot;/hello&quot;)</span><br><span class="line">  public String hello(@ModelAttribute(&quot;message&quot;) String message) &#123;</span><br><span class="line">    return &quot;hello-spring&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  /**</span><br><span class="line">   * 欢迎页面</span><br><span class="line">   */</span><br><span class="line">  @RequestMapping(value =&quot;/&quot;, method =RequestMethod.GET)</span><br><span class="line">  public String index()&#123;</span><br><span class="line">      return &quot;redirect:/index.html&quot;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>FreeMarker 页面 <code>WEB-INF/freemarker/hello-spring.ftl</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line">        &lt;title&gt;Freemarker MVC Example&lt;/title&gt;</span><br><span class="line">    &lt;/head&gt;</span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;form action=&quot;hello&quot; method=&quot;post&quot;&gt;</span><br><span class="line">            Message: &lt;input type=&quot;text&quot; name=&quot;message&quot;&gt;&lt;br/&gt;</span><br><span class="line">            &lt;button type=&quot;submit&quot;&gt;Submit&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">        &lt;br/&gt;</span><br><span class="line">        &lt;#if message??&gt;$&#123;message?html&#125;&lt;/#if&gt;</span><br><span class="line">    &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>欢迎页面 index.html </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Freemarker MVC Integration Test Page&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"> </span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;a href=&quot;hello&quot;&gt;Spring MVC Example&lt;/a&gt;&lt;br/&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="FreeMarker-详细配置"><a href="#FreeMarker-详细配置" class="headerlink" title="FreeMarker 详细配置"></a>FreeMarker 详细配置</h3><p><strong>如下是一个详细Spring MVC 集成FreeMarker的详细配置，</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- FreeMarker的配置 --&gt;</span><br><span class="line">&lt;bean id=&quot;freeMarkerConfigurer&quot;  class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerConfigurer&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;templateLoaderPaths&quot; value=&quot;/WEB-INF/freemarker/&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;defaultEncoding&quot; value=&quot;UTF-8&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;freemarkerSettings&quot;&gt;</span><br><span class="line">        &lt;props&gt;</span><br><span class="line">            &lt;prop key=&quot;incompatible_improvements&quot;&gt;2.3.23&lt;/prop&gt;</span><br><span class="line">            &lt;prop key=&quot;template_exception_handler&quot;&gt;rethrow&lt;/prop&gt;</span><br><span class="line">            &lt;prop key=&quot;default_encoding&quot;&gt;UTF-8&lt;/prop&gt;  </span><br><span class="line">            &lt;prop key=&quot;template_update_delay&quot;&gt;10&lt;/prop&gt;</span><br><span class="line">            &lt;prop key=&quot;url_escaping_charset&quot;&gt;UTF-8&lt;/prop&gt;</span><br><span class="line">            &lt;prop key=&quot;locale&quot;&gt;zh_CN&lt;/prop&gt;</span><br><span class="line">            &lt;prop key=&quot;boolean_format&quot;&gt;true,false&lt;/prop&gt;</span><br><span class="line">            &lt;prop key=&quot;time_format&quot;&gt;HH:mm:ss&lt;/prop&gt;</span><br><span class="line">            &lt;prop key=&quot;datetime_format&quot;&gt;yyyy-MM-dd HH:mm:ss&lt;/prop&gt;</span><br><span class="line">            &lt;prop key=&quot;date_format&quot;&gt;yyyy-MM-dd&lt;/prop&gt;</span><br><span class="line">            &lt;prop key=&quot;number_format&quot;&gt;#.##&lt;/prop&gt;</span><br><span class="line">            &lt;prop key=&quot;whitespace_stripping&quot;&gt;true&lt;/prop&gt;</span><br><span class="line">        &lt;/props&gt;</span><br><span class="line">    &lt;/property&gt;</span><br><span class="line">&lt;/bean&gt;</span><br><span class="line">&lt;!-- 配置 FreeMarker视图解析器 --&gt;</span><br><span class="line">&lt;bean id=&quot;viewResolver&quot;  class=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerViewResolver&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;viewClass&quot;</span><br><span class="line">        value=&quot;org.springframework.web.servlet.view.freemarker.FreeMarkerView&quot;&gt;&lt;/property&gt;</span><br><span class="line">    &lt;property name=&quot;cache&quot; value=&quot;false&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;prefix&quot; value=&quot;&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;suffix&quot; value=&quot;.ftl&quot; /&gt;&lt;!--可为空 --&gt;</span><br><span class="line">    &lt;property name=&quot;contentType&quot; value=&quot;text/html;charset=utf-8&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;exposeRequestAttributes&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;exposeSessionAttributes&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;property name=&quot;exposeSpringMacroHelpers&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/07/15/Spring MVC 文件上传/" itemprop="url">
                  Spring MVC 文件上传
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-07-15T13:53:00+08:00" content="2014-07-15">
              2014-07-15
            </time>
          </span>

          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/07/15/Spring MVC 文件上传/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/07/15/Spring MVC 文件上传/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之间学过Servlet 文件上传 ，然后Struts2 的文件上传，现在Spring MVC文件上，这就是所谓的技术更新？<br>之间看过一篇文档说Spring提供的文件上传快一些？</p>
<p>Spring MVC 有两种方法解决文件上传问题</p>
<ul>
<li>使用<code>Apache Commons FileUpload</code> 组件</li>
<li>采用Servlet3.0 或更高版本。<blockquote>
<p>Serlvet3.0 内置文件上传功能，不需要引入<code>Commons FileUpload</code>组件,貌似很少人用内置的,还是错觉 - -!</p>
</blockquote>
</li>
</ul>
<h2 id="客户端设置"><a href="#客户端设置" class="headerlink" title="客户端设置"></a>客户端设置</h2><p>想要文件上传，必须将HTML中<code>form</code>元素的<code>enctype</code>属性设置为<code>multipart/form-data</code>,参考如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=&quot;action&quot; enctype=&quot;multipart/form-data&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;input type=&quot;file&quot; name=&quot;fieldName&quot;/&gt;</span><br><span class="line">    &lt;input type=&quot;submit&quot; value=&quot;Upload&quot;/&gt;</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>form</code>表单必须包含至少一个类型为<code>file</code>的<code>input</code>元素</p>
</blockquote>
<h2 id="MultipartFile-接口"><a href="#MultipartFile-接口" class="headerlink" title="MultipartFile 接口"></a>MultipartFile 接口</h2><p>Spring MVC 处理文件非常容易，上传文件的所有信息被包裹在<code>MultipartFile</code>中。（这点，我认为比Struts2 优雅）<br>我们需要在域模型（Model） 中引入<code>MultipartFile</code>属性</p>
<p><code>MultipartFile</code> 接口，参考方法详细列表<br>方法 | 描述<br>— | —<br>getBytes| 返回文件的字节数组<br>getContentType | 返回文件的内容类型<br>getInputStream | 返回文件内容的InputStream<br>getName    | 返回form表单中name的名称<br>getOriginalFilename |返回原始文件的名称。<br>getSize|    返回一个long类型的文件字节大小<br>isEmpty    |上传文件是否为空<br>tranferTo|    将上传文件保存为一个<code>java.io.File</code></p>
<ul>
<li><code>tranferTo</code> 方法演示，保存上传文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">File file = new File(...);</span><br><span class="line">multipartFile.transferTo(file);</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Commons-FileUpload-文件上传"><a href="#Commons-FileUpload-文件上传" class="headerlink" title="Commons FileUpload 文件上传"></a>Commons FileUpload 文件上传</h2><ul>
<li>引入 Commons FileUpload 组件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;3.1.0&lt;/version&gt;</span><br><span class="line">	&lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;4.0.0.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">              &lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;jstl&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;1.2&lt;/version&gt;</span><br><span class="line">	&lt;scope&gt;runtime&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">              &lt;!-- commons fileupload --&gt;</span><br><span class="line">  &lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;commons-fileupload&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;commons-fileupload&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;1.3.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p><code>commons-fileupload</code> 默认引入<code>commons-io</code> </p>
</blockquote>
<ul>
<li><p>Spring MVC 配置<code>multipartResolver</code> Bean</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;multipartResolver&quot;   class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;maxUploadSize&quot; value=&quot;2000000&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>域模型（请求 Model）<br><code>Product Model</code>包含一个<code>List&lt;MultipartFile&gt;</code>文件列表。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">package domain;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line">import java.util.List;</span><br><span class="line">import javax.validation.constraints.NotNull;</span><br><span class="line">import javax.validation.constraints.Size;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line"></span><br><span class="line">public class Product implements Serializable &#123;</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    private String description;</span><br><span class="line">    private BigDeciimal price;</span><br><span class="line">    private List&lt;MultipartFile&gt; images;</span><br><span class="line"></span><br><span class="line">    // ... getter/setter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>控制器（Controller）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">package controller;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.util.ArrayList;</span><br><span class="line">import java.util.List;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import org.apache.commons.logging.Log;</span><br><span class="line">import org.apache.commons.logging.LogFactory;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.validation.BindingResult;</span><br><span class="line">import org.springframework.web.bind.annotation.ModelAttribute;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.multipart.MultipartFile;</span><br><span class="line">import domain.Product;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class ProductController &#123;</span><br><span class="line"></span><br><span class="line">    private static final Log logger = </span><br><span class="line">        LogFactory.getLog(ProductController.class);</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value = &quot;/input-product&quot;)</span><br><span class="line">    public String inputProduct(Model model) &#123;</span><br><span class="line">        model.addAttribute(&quot;product&quot;, new Product());</span><br><span class="line">        return &quot;ProductForm&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value = &quot;/save-product&quot;)</span><br><span class="line">    public String saveProduct(HttpServletRequest servletRequest,</span><br><span class="line">            @ModelAttribute Product product, </span><br><span class="line">            BindingResult bindingResult, Model model) &#123;</span><br><span class="line"></span><br><span class="line">        List&lt;MultipartFile&gt; files = product.getImages();</span><br><span class="line">        List&lt;String&gt; fileNames = new ArrayList&lt;String&gt;();</span><br><span class="line">        if (null != files &amp;&amp; files.size() &gt; 0) &#123;</span><br><span class="line">            for (MultipartFile multipartFile : files) &#123;</span><br><span class="line"></span><br><span class="line">                String fileName = multipartFile.getOriginalFilename();</span><br><span class="line">                fileNames.add(fileName);</span><br><span class="line"></span><br><span class="line">                File imageFile = new File(servletRequest.getServletContext()</span><br><span class="line">                        .getRealPath(&quot;/image&quot;), fileName);</span><br><span class="line">                try &#123;</span><br><span class="line">                    multipartFile.transferTo(imageFile);</span><br><span class="line">                &#125; catch (IOException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return &quot;ProductDetails&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>Spring MVC 配置文件配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot; </span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;</span><br><span class="line">        http://www.springframework.org/schema/beans</span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/mvc</span><br><span class="line">        http://www.springframework.org/schema/mvc/spring-mvc.xsd     </span><br><span class="line">        http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-</span><br><span class="line">context.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;context:component-scan base-package=&quot;controller&quot; /&gt;</span><br><span class="line">    &lt;mvc:annotation-driven /&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/css/**&quot; location=&quot;/css/&quot; /&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/*.html&quot; location=&quot;/&quot; /&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/image/**&quot; location=&quot;/image/&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=&quot;viewResolver&quot;</span><br><span class="line">            class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot; /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">    &lt;bean id=&quot;multipartResolver&quot; </span><br><span class="line">    		class=&quot;org.springframework.web.multipart.commons.CommonsMultipartResolver&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;maxUploadSize&quot; value=&quot;5000000000&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>在<code>CommonsMultipartResolver</code>Bean注入<code>maxUploadSize</code>属性，限定最大上传文件，如果没有这个值，将没有最大限制（无穷大）<br>设置文件没有大小限制，并不意味可以上传任意大小的文件，如果一个文件非常大，上传会花费很长时间，甚至到服务器超时。<br>处理非常大的文件，可以考虑<code>HTML5 File API</code>,使用切片文件，分别上传。</p>
</blockquote>
<ul>
<li><p>JSP 页面<br> <strong>文件上传页面和信息显示页面</strong></p>
<ul>
<li><p>ProductForm.jsp 页面</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ taglib prefix=&quot;form&quot; uri=&quot;http://www.springframework.org/tags/form&quot;%&gt;</span><br><span class="line">&lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Add Product Form&lt;/title&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;@import url(&quot;&lt;c:url value=&quot;/css/main.css&quot;/&gt;&quot;);&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;global&quot;&gt;</span><br><span class="line">&lt;form:form commandName=&quot;product&quot; action=&quot;save-product&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">    &lt;fieldset&gt;</span><br><span class="line">        &lt;legend&gt;Add a product&lt;/legend&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label for=&quot;name&quot;&gt;Product Name: &lt;/label&gt;</span><br><span class="line">            &lt;form:input id=&quot;name&quot; path=&quot;name&quot; cssErrorClass=&quot;error&quot;/&gt;</span><br><span class="line">            &lt;form:errors path=&quot;name&quot; cssClass=&quot;error&quot;/&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label for=&quot;description&quot;&gt;Description: &lt;/label&gt;</span><br><span class="line">            &lt;form:input id=&quot;description&quot; path=&quot;description&quot;/&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label for=&quot;price&quot;&gt;Price: &lt;/label&gt;</span><br><span class="line">            &lt;form:input id=&quot;price&quot; path=&quot;price&quot; cssErrorClass=&quot;error&quot;/&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label for=&quot;image&quot;&gt;Product Image: &lt;/label&gt;</span><br><span class="line">            &lt;input type=&quot;file&quot; name=&quot;images[0]&quot;/&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p id=&quot;buttons&quot;&gt;</span><br><span class="line">            &lt;input id=&quot;reset&quot; type=&quot;reset&quot; tabindex=&quot;4&quot;&gt;</span><br><span class="line">            &lt;input id=&quot;submit&quot; type=&quot;submit&quot; tabindex=&quot;5&quot; value=&quot;Add Product&quot;&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &lt;/fieldset&gt;</span><br><span class="line">&lt;/form:form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>该页面将跳转至<code>ProductDetails.jsp</code>页面</p>
</blockquote>
</li>
<li>ProductDetails.jsp 页面<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> &lt;%@ taglib uri=&quot;http://java.sun.com/jsp/jstl/core&quot; prefix=&quot;c&quot; %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Save Product&lt;/title&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;@import url(&quot;&lt;c:url value=&quot;/css/main.css&quot;/&gt;&quot;);&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;global&quot;&gt;</span><br><span class="line">    &lt;h4&gt;The product has been saved.&lt;/h4&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;h5&gt;Details:&lt;/h5&gt;</span><br><span class="line">        Product Name: $&#123;product.name&#125;&lt;br/&gt;</span><br><span class="line">        Description: $&#123;product.description&#125;&lt;br/&gt;</span><br><span class="line">        Price: $$&#123;product.price&#125;</span><br><span class="line">        &lt;p&gt;Following files are uploaded successfully.&lt;/p&gt;</span><br><span class="line">        &lt;ol&gt;</span><br><span class="line">        &lt;c:forEach items=&quot;$&#123;product.images&#125;&quot; var=&quot;image&quot;&gt;</span><br><span class="line">            &lt;li&gt;$&#123;image.originalFilename&#125;</span><br><span class="line">            &lt;img width=&quot;100&quot; src=&quot;&lt;c:url value=&quot;/image/&quot;/&gt;</span><br><span class="line">            $&#123;image.originalFilename&#125;&quot;/&gt;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">        &lt;/c:forEach&gt;</span><br><span class="line">        &lt;/ol&gt;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>测试文件上传</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/your-project-name/input-product</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Servlet-3-文件上传"><a href="#Servlet-3-文件上传" class="headerlink" title="Servlet 3 文件上传"></a>Servlet 3 文件上传</h2><p><strong>在上一个实例的基础上，修改</strong></p>
<ul>
<li>不需要在引入<code>Commons File</code> 组件</li>
<li>需要使用<code>javax.servlet.http.Part</code> 接口，必须使用<code>@MultipartConfig</code>注解声明文件上传。</li>
</ul>
<p><code>@MultipartConfig</code>  注解属性列表详情。（所有属性均可选）</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>max-file-size</td>
<td>上传文件最大大小。超过指定值的文件将被拒绝(抛出IllegalStateException异常)。默认值为-1，表示无穷大。</td>
</tr>
<tr>
<td>max-request-size</td>
<td>最大文件请求大小,超过指定值时,抛出IllegalStateException异常。默认值为-1,表示无穷大。</td>
</tr>
<tr>
<td>location</td>
<td>指定上传文件存放目录。当指定location后，我们调用Part.Writer(String fileName)方法时，可以不指定文件路径。如果指定路径，将覆盖location路径。</td>
</tr>
<tr>
<td>file-size-threshold</td>
<td>当文件大小超过指定阈值大小时，将写入磁盘。默认值为0，任意大小的文件作为临时文件写入磁盘。</td>
</tr>
</tbody>
</table>
<ul>
<li>web.xml 配置 MultipartConfig</li>
</ul>
<p><strong>DispatcherServlet</strong>处理所有的Action请求，你不需要在Spring MVC Controller (Serlvet)上添加<code>@MultipartConfig</code>注释，配置如下即可。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app version=&quot;3.1&quot; </span><br><span class="line">		xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot; </span><br><span class="line">    	xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">    	xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee </span><br><span class="line">			http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;&gt; </span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;</span><br><span class="line">            org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">        &lt;/servlet-class&gt;</span><br><span class="line">	    &lt;init-param&gt;</span><br><span class="line">			&lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">			&lt;param-value&gt;/WEB-INF/config/springmvc-config.xml&lt;/param-value&gt;</span><br><span class="line">		&lt;/init-param&gt;</span><br><span class="line">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;</span><br><span class="line">		&lt;multipart-config&gt;</span><br><span class="line">		    &lt;max-file-size&gt;20848820&lt;/max-file-size&gt;</span><br><span class="line">		    &lt;max-request-size&gt;418018841&lt;/max-request-size&gt;</span><br><span class="line">		    &lt;file-size-threshold&gt;1048576&lt;/file-size-threshold&gt;</span><br><span class="line">		&lt;/multipart-config&gt;            </span><br><span class="line">	&lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>可以不进行<code>multipart-config</code>配置，它将使用默认值。</p>
<ul>
<li>Spring MVC 配置文件中配置<code>multipart</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;multipartResolver&quot; </span><br><span class="line">        class=&quot;org.springframework.web.multipart.support.StandardServletMultipartResolver&quot;&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;	</span><br><span class="line">    xsi:schemaLocation=&quot;</span><br><span class="line">        http://www.springframework.org/schema/beans</span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/mvc</span><br><span class="line">        http://www.springframework.org/schema/mvc/spring-mvc.xsd     </span><br><span class="line">        http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-</span><br><span class="line">context.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;context:component-scan base-package=&quot;controller&quot; /&gt;</span><br><span class="line">    &lt;mvc:annotation-driven /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;mvc:resources mapping=&quot;/css/**&quot; location=&quot;/css/&quot; /&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/*.html&quot; location=&quot;/&quot; /&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/image/**&quot; location=&quot;/image/&quot; /&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/file/**&quot; location=&quot;/file/&quot; /&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean id=&quot;viewResolver&quot;</span><br><span class="line">        class=&quot;org.springframework.web.servlet.view.</span><br><span class="line">InternalResourceViewResolver&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot; /&gt;</span><br><span class="line">        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot; /&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">	</span><br><span class="line">    &lt;bean id=&quot;multipartResolver&quot;</span><br><span class="line">        class=&quot;org.springframework.web.multipart.support.</span><br><span class="line">StandardServletMultipartResolver&quot;&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p><code>multipart</code> 有多种实现方式，请参考官方文档。</p>
<ul>
<li>测试<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/your-project-name/input-product</span><br></pre></td></tr></table></figure>
</li>
</ul>
</blockquote>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ul>
<li>使用Spring MVC 进行文件上传，无论是<code>Commons File</code>组件还是Servlet内置。<code>MultipartFile</code>接口都将包裹文件信息。</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/07/14/Spring MVC 基于注解的控制器/" itemprop="url">
                  Spring MVC 基于注解的控制器
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-07-14T16:53:00+08:00" content="2014-07-14">
              2014-07-14
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaWeb/Spring-MVC/" itemprop="url" rel="index">
                    <span itemprop="name">Spring MVC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/07/14/Spring MVC 基于注解的控制器/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/07/14/Spring MVC 基于注解的控制器/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Spring MVC 提供了两种配置Controller（控制器）的方式</p>
<ul>
<li>基于XML的方式。（Spring 2.5 引入）</li>
<li>基于Annotation的方式。</li>
</ul>
<h2 id="Spring-MVC-Annotation-类型"><a href="#Spring-MVC-Annotation-类型" class="headerlink" title="Spring MVC Annotation 类型"></a>Spring MVC Annotation 类型</h2><p>使用基于注解的Controller有几个（两个）优点：</p>
<ul>
<li>1、一个控制器类可以处理多个actions,(相比之下，实现Controller接口的控制器只能处理一个action)，也就是说,相关的actions可以写在同一个控制器类，从而减少应用程序类的数量。</li>
<li>2、基于注解的控制器请求映射文件不需要存储到配置文件中，使用<code>RequestMapping</code>注解类型标注请求处理（request-handling）方法。</li>
</ul>
<p>Spring MVC 有两个比较重要的注解类型，Controller 和 RequestMapping 注解类型，和一些不太热门的注解类型。</p>
<h3 id="Controller-注解类型"><a href="#Controller-注解类型" class="headerlink" title="Controller 注解类型"></a>Controller 注解类型</h3><p><code>org.springframework.stereotype.Controller</code>注解类型标注一个Java类，告诉Spring 该类是一个控制器。注解@Controller 实例如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">package com.example.controller;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class CustomerController &#123;</span><br><span class="line">    </span><br><span class="line">    // request-handling methods here</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>Spring 使用扫描机制，查找应用程序中所有基于注解的控制器，为了保证Spring能够找到控制器，需要做两件事：</p>
<ul>
<li><p>1、在Spring MVC配置文件中声明<code>spring-context</code> Schema</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;beans </span><br><span class="line">    ...</span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">    ... </span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>2、其次在配置文件中使用<code>&lt;component-scan/&gt;</code>元素</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;context:component-scan base-package=&quot;basePackage&quot;/&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>整合配置文件显示如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;</span><br><span class="line">        http://www.springframework.org/schema/beans</span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;context:component-scan base-package=&quot;com.example.controller&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="RequestMapping-注解类型"><a href="#RequestMapping-注解类型" class="headerlink" title="RequestMapping 注解类型"></a>RequestMapping 注解类型</h3><p>在控制器类中写请求处理方法，对于每一个将要处理的Action，你要告诉Spring，使用哪些方法处理哪些Action，可以使用<code>org.springframework.web.bind.annotation.RequestMapping</code>注解类型映射URI到Action 方法。</p>
<p>RequestMapping 注解类型，顾名思义，用于映射一个请求到一个方法（请求处理方法）。 可以使用@RequestMapping注解到一个方法或一个类。</p>
<p>如下控制器类中实现RequestMapping类型注解方法的实例。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">package com.example.controller;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class CustomerController &#123;</span><br><span class="line">    </span><br><span class="line">    @RequestMapping(value = &quot;/input-customer&quot;)</span><br><span class="line">    public String inputCustomer() &#123;</span><br><span class="line"></span><br><span class="line">        // do something here</span><br><span class="line"></span><br><span class="line">        return &quot;CustomerForm&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>RequestMapping 注解中使用value属性指定URI映射到一个方法。如上使用<code>http://domain/context/input-customer</code>访问这个Action。</p>
</blockquote>
<p>value 是@RequestMapping 默认的属性，如果使用<strong>唯一属性</strong>，可以省略value属性名称，如下等价。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/input-customer&quot;)</span><br><span class="line">@RequestMapping(&quot;/input-customer&quot;)</span><br></pre></td></tr></table></figure></p>
<p>@RequestMapping 除value以外还有其他属性值，如下processOrder方法只能调用HTTP POST 和 PUT方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value=&quot;/process-order&quot;,</span><br><span class="line">          method=&#123;RequestMethod.POST, RequestMethod.PUT&#125;)</span><br><span class="line">  public String processOrder() &#123;</span><br><span class="line">  </span><br><span class="line">      // do something here</span><br><span class="line"></span><br><span class="line">      return &quot;OrderForm&quot;;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>如果method属性不存在，请求处理方法将处理所有HTTP方法。<br>同样你可以指定HTTP唯一的请求方法。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value=&quot;/process-order&quot;, method=RequestMethod.POST)</span><br></pre></td></tr></table></figure></p>
<p>@RequestMapping 类型可以标注一个控制器类,这种情况，方法级别的请求映射将被视为响度与类级别的请求，参考如下：deleteCustomer方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">...</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/customer&quot;)</span><br><span class="line">public class CustomerController &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value=&quot;/delete&quot;,</span><br><span class="line">            method=&#123;RequestMethod.POST, RequestMethod.PUT&#125;)</span><br><span class="line">    public String deleteCustomer() &#123;</span><br><span class="line"></span><br><span class="line">        // do something here</span><br><span class="line"></span><br><span class="line">        return ...;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>由于控制器类映射使用<code>/customer</code> 和 deleteCustomer方法使用<code>/delete</code>,该Action方法使用<code>http://domain/context/customer/delete</code>访问。</p>
</blockquote>
<h3 id="写请求处理方法"><a href="#写请求处理方法" class="headerlink" title="写请求处理方法"></a>写请求处理方法</h3><p>一个请求处理方法（action）可以有多个参数类型，以及各种返回类型。如下实例，你可能需要在方法中访问HttpSession对象，需要添加HttpSession到形参中，Spring将传递正确的对象类型：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;/uri&quot;)</span><br><span class="line">public String myMethod(HttpSession session) &#123;</span><br><span class="line">    ...</span><br><span class="line">    session.addAttribute(key, value);</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>或者，你需要访问 <code>Locale</code>和<code>HttpServletRequest</code>对象,你需要在方法中包含这两个参数:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(&quot;/uri&quot;)</span><br><span class="line">public String myOtherMethod(HttpServletRequest request, </span><br><span class="line">        Locale locale) &#123;</span><br><span class="line">    ...</span><br><span class="line">    // access Locale and HttpServletRequest here</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr>
<p>如下是可以出现在请求处理方法参数的参数类型列表：</p>
<ul>
<li><code>javax.servlet.ServletRequest</code> or <code>javax.servlet.http.HttpServletRequest</code></li>
<li><code>javax.servlet.ServletResponse</code> or <code>javax.servlet.http.HttpServletResponse</code></li>
<li><code>javax.servlet.http.HttpSession</code></li>
<li><code>org.springframework.web.context.request.WebRequest</code> or <code>org.springframework.web.context.request.NativeWebRequest</code></li>
<li><code>java.util.Locale</code></li>
<li><code>java.io.InputStream</code> or <code>java.io.Reader</code></li>
<li><code>java.io.OutputStream</code> or <code>java.io.Writer</code></li>
<li><code>java.security.Principal</code></li>
<li><code>HttpEntity&lt;?&gt; parameters</code></li>
<li><code>java.util.Map</code> / <code>org.springframework.ui.Model</code> / <code>org.springframework.ui.ModelMap</code></li>
<li><code>org.springframework.web.servlet.mvc.support.RedirectAttributes</code></li>
<li><code>org.springframework.validation.Errors</code> / <code>org.springframework.validation.BindingResult</code></li>
<li><code>Command</code> or <code>form objects</code></li>
<li><code>org.springframework.web.bind.support.SessionStatus</code></li>
<li><code>org.springframework.web.util.UriComponentsBuilder</code></li>
<li>Types annotated with <code>@PathVariable</code>, <code>@MatrixVariable</code>, <code>@RequestParam</code>, <code>@RequestHeader</code>, <code>@RequestBody</code>, or <code>@RequestPart</code>.</li>
</ul>
<hr>
<p><code>org.springframework.ui.Model</code>类型是一个特别重要的类型，它包含一个<code>Map</code>，每次请求处理方法被调用，Spring MVC 创建一个<code>Model</code>对象，并填充这个<code>Map</code>和潜在对象。</p>
<p>请求处理方法可以返回这些对象之一：</p>
<ul>
<li>一个<code>ModelAndView</code>对象</li>
<li>一个<code>Model</code>对象</li>
<li>一个<code>Map</code>,包含model属性</li>
<li>一个<code>View</code>对象</li>
<li>一个<code>String(字符串)</code>，表示视图逻辑名称。</li>
<li><code>void</code></li>
<li>一个<code>HttpEntity</code>或<code>ResponseEntity</code>对象，提供访问Servlet 响应(Servlet response)的HTTP 请求头(http header)和请求内容(http contents)</li>
<li>一个<code>Callable</code></li>
<li>一个<code>DeferredResult</code></li>
<li>其他任何返回类型. 在这种情况下, 返回值将被视为model属性到一个view</li>
</ul>
<h3 id="使用基于注解的控制器"><a href="#使用基于注解的控制器" class="headerlink" title="使用基于注解的控制器"></a>使用基于注解的控制器</h3><ul>
<li><p>Maven 引入Spring MVC 依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.1.0&lt;/version&gt;</span><br><span class="line">            &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;4.0.4.RELEASE&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>部署描述文件（web.xml）配置Spring MVC 调度 Servlet 入口 和 Spring MVC配置文件路径。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app version=&quot;3.1&quot; </span><br><span class="line">    xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot; </span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">    xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee </span><br><span class="line">        http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;</span><br><span class="line">            org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">        &lt;/servlet-class&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">         &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">            &lt;param-value&gt;</span><br><span class="line">                /WEB-INF/config/springmvc-config.xml</span><br><span class="line">            &lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;    </span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">        &lt;!--URL模式为/表示所有请求，包含静态资源请求 --&gt;</span><br><span class="line">        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置Spring MVC 配置文件（springmvc-config.xml）。</p>
<blockquote>
<p>为了让静态资源得到处理,需要在Spring MVC 配置文件中添加多个<code>&lt;resources/&gt;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;</span><br><span class="line">        http://www.springframework.org/schema/beans</span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/mvc</span><br><span class="line">        http://www.springframework.org/schema/mvc/spring-mvc.xsd     </span><br><span class="line">        http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;</span><br><span class="line">    &lt;!-- 告诉Spring MVC Controller 包的路径 --&gt;</span><br><span class="line">    &lt;context:component-scan base-package=&quot;controller&quot;/&gt;</span><br><span class="line">    &lt;!-- 启动注解，允许SpringMVC 调度静态资源 --&gt;</span><br><span class="line">    &lt;mvc:annotation-driven/&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- 处理静态资源，告诉Spring MVC 哪些静态资源需要servlet 调度 --&gt;</span><br><span class="line">    &lt;!-- 声明/CSS目录下的所有文件是可见的 --&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/css/**&quot; location=&quot;/css/&quot;/&gt;</span><br><span class="line">    &lt;!-- 在应用程序中的所有目录允许显示.html文件 --&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/*.html&quot; location=&quot;/&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">     &lt;!-- 访问路径前缀后缀处理 --&gt;</span><br><span class="line">    &lt;bean id=&quot;viewResolver&quot;  class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<blockquote>
<p>如果没有<code>&lt;annotation-driven/&gt;</code>，<code>&lt;mvc:resources/&gt;</code>元素防止调用任何控制器。如果不使用<code>resources</code>元素将不需要<code>&lt;annotation-driven/&gt;</code>元素</p>
</blockquote>
<ul>
<li>控制器类<br>基于注解的控制器类可以包含多个请求处理方法，例如：ProductController 类包含<code>inputProduct</code>和<code>saveProduct</code>。<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">package controller;</span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line">import org.apache.commons.logging.Log;</span><br><span class="line">import org.apache.commons.logging.LogFactory;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import domain.Product;</span><br><span class="line">import form.ProductForm;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class ProductController &#123;</span><br><span class="line"></span><br><span class="line">    private static final Log logger = LogFactory.getLog(ProductController.class);</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value=&quot;/input-product&quot;)</span><br><span class="line">    public String inputProduct() &#123;</span><br><span class="line">        logger.info(&quot;inputProduct called&quot;);</span><br><span class="line">        return &quot;ProductForm&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value=&quot;/save-product&quot;)</span><br><span class="line">    public String saveProduct(ProductForm productForm, Model model) &#123;</span><br><span class="line">        logger.info(&quot;saveProduct called&quot;);</span><br><span class="line">        // no need to create and instantiate a ProductForm</span><br><span class="line">        // create Product</span><br><span class="line">        Product product = new Product();</span><br><span class="line">        product.setName(productForm.getName());</span><br><span class="line">        product.setDescription(productForm.getDescription());</span><br><span class="line">        try &#123;</span><br><span class="line">            product.setPrice(new BigDecimal(productForm.getPrice()));</span><br><span class="line">        &#125; catch (NumberFormatException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // add product</span><br><span class="line"></span><br><span class="line">        model.addAttribute(&quot;product&quot;, product);</span><br><span class="line">        return &quot;ProductDetails&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>注意 <code>saveProduct</code> 的参数是<code>org.springframework.ui.Model</code>.用于添加视图属性模型，这里添加一个Product Model。可以通过<code>HttpServletRequest</code>访问该实例。</p>
</blockquote>
<ul>
<li>视图<br>这里有两个JSP视图页面，ProductForm.jsp和ProductDetails.jsp页面<br><strong>ProductForm.jsp</strong><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Add Product Form&lt;/title&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;@import url(css/main.css);&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;global&quot;&gt;</span><br><span class="line">&lt;form action=&quot;save-product&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;fieldset&gt;</span><br><span class="line">        &lt;legend&gt;Add a product&lt;/legend&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label for=&quot;name&quot;&gt;Product Name: &lt;/label&gt;</span><br><span class="line">            &lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; </span><br><span class="line">                tabindex=&quot;1&quot;&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label for=&quot;description&quot;&gt;Description: &lt;/label&gt;</span><br><span class="line">            &lt;input type=&quot;text&quot; id=&quot;description&quot; </span><br><span class="line">                name=&quot;description&quot; tabindex=&quot;2&quot;&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p&gt;</span><br><span class="line">            &lt;label for=&quot;price&quot;&gt;Price: &lt;/label&gt;</span><br><span class="line">            &lt;input type=&quot;text&quot; id=&quot;price&quot; name=&quot;price&quot; </span><br><span class="line">                tabindex=&quot;3&quot;&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">        &lt;p id=&quot;buttons&quot;&gt;</span><br><span class="line">            &lt;input id=&quot;reset&quot; type=&quot;reset&quot; tabindex=&quot;4&quot;&gt;</span><br><span class="line">            &lt;input id=&quot;submit&quot; type=&quot;submit&quot; tabindex=&quot;5&quot; </span><br><span class="line">                value=&quot;Add Product&quot;&gt;</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &lt;/fieldset&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><strong>ProductDetails.jsp</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE HTML&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Save Product&lt;/title&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;@import url(css/main.css);&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;global&quot;&gt;</span><br><span class="line">    &lt;h4&gt;The product has been saved.&lt;/h4&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;h5&gt;Details:&lt;/h5&gt;</span><br><span class="line">        Product Name: $&#123;product.name&#125;&lt;br/&gt;</span><br><span class="line">        Description: $&#123;product.description&#125;&lt;br/&gt;</span><br><span class="line">        Price: $$&#123;product.price&#125;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>这里你已经可以通过<code>http://localhost:8080/your-project-name/input-product</code> 访问这个Spring MVC 实例。</p>
</blockquote>
<h3 id="依赖注入-Autowired-和-Service"><a href="#依赖注入-Autowired-和-Service" class="headerlink" title="依赖注入@Autowired 和 @Service"></a>依赖注入@Autowired 和 @Service</h3><p>使用Spring的依赖注入，获取注入Spring MVC的控制器依赖最简单的方法是使用<code>@Autowired</code>注解，<code>@Autowired</code>注解到一个字段或方法。<br>该<code>@Autowired</code>注解类型属于<code>org.springframework.beans.factory.annotation</code>包</p>
<p>为了使依赖被发现，该类必须使用@Service注解，它属于<code>org.springframework.stereotype</code>包，<code>@Service</code>注解类型表示该类是一个服务，此外，需要在配置文件添加<code>&lt;component-scan/&gt;</code>扫描依赖基础包<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;context:component-scan base-package=&quot;dependencyPackage&quot;/&gt;</span><br></pre></td></tr></table></figure></p>
<p>Spring MVC 依赖注入实例，参考如下：被修改的 ProductController2 类<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">package controller;</span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line">import org.apache.commons.logging.Log;</span><br><span class="line">import org.apache.commons.logging.LogFactory;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.web.bind.annotation.PathVariable;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMethod;</span><br><span class="line">import org.springframework.web.servlet.mvc.support.RedirectAttributes;</span><br><span class="line">import domain.Product;</span><br><span class="line">import form.ProductForm;</span><br><span class="line">import service.ProductService;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class ProductController &#123;</span><br><span class="line"></span><br><span class="line">    private static final Log logger = LogFactory</span><br><span class="line">            .getLog(ProductController.class);</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private ProductService productService;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value = &quot;/input-product&quot;)</span><br><span class="line">    public String inputProduct() &#123;</span><br><span class="line">        logger.info(&quot;inputProduct called&quot;);</span><br><span class="line">        return &quot;ProductForm&quot;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value = &quot;/save-product&quot;, method = RequestMethod.POST)</span><br><span class="line">    public String saveProduct(ProductForm productForm, </span><br><span class="line">            RedirectAttributes redirectAttributes) &#123;</span><br><span class="line">        logger.info(&quot;saveProduct called&quot;);</span><br><span class="line">        // no need to create and instantiate a ProductForm</span><br><span class="line">        // create Product</span><br><span class="line">        Product product = new Product();</span><br><span class="line">        product.setName(productForm.getName());</span><br><span class="line">        product.setDescription(productForm.getDescription());</span><br><span class="line">        try &#123;</span><br><span class="line">            product.setPrice(new BigDecimal(productForm.getPrice()));</span><br><span class="line">        &#125; catch (NumberFormatException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // add product</span><br><span class="line">        Product savedProduct = productService.add(product);</span><br><span class="line">        </span><br><span class="line">        redirectAttributes.addFlashAttribute(&quot;message&quot;, </span><br><span class="line">                &quot;The product was successfully added.&quot;);</span><br><span class="line">        return &quot;redirect:/product_view/&quot; + savedProduct.getId();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(value = &quot;/view-product/&#123;id&#125;&quot;)</span><br><span class="line">    public String viewProduct(@PathVariable Long id, Model model) &#123;</span><br><span class="line">        Product product = productService.get(id);</span><br><span class="line">        model.addAttribute(&quot;product&quot;, product);</span><br><span class="line">        return &quot;ProductView&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>如上ProductController实例 productService字段增加@Autowired注解进行依赖注入</p>
</blockquote>
<p>ProductService接口和ProductServiceImpl实现类，如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package service</span><br><span class="line">import domain.Product;</span><br><span class="line">public interface ProductService &#123;</span><br><span class="line">    Product add(Product product);</span><br><span class="line">    Product get(long id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">package service;</span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.concurrent.atomic.AtomicLong;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line">import domain.Product;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class ProductServiceImpl implements ProductService &#123;</span><br><span class="line"></span><br><span class="line">    private Map&lt;Long, Product&gt; products = </span><br><span class="line">            new HashMap&lt;Long, Product&gt;();</span><br><span class="line">    private AtomicLong generator = new AtomicLong();</span><br><span class="line"></span><br><span class="line">    public ProductServiceImpl() &#123;</span><br><span class="line">        Product product = new Product();</span><br><span class="line">        product.setName(&quot;JX1 Power Drill&quot;);</span><br><span class="line">        product.setDescription(</span><br><span class="line">                &quot;Powerful hand drill, made to perfection&quot;);</span><br><span class="line">        product.setPrice(new BigDecimal(129.99));</span><br><span class="line"></span><br><span class="line">        add(product);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Product add(Product product) &#123;</span><br><span class="line">        long newId = generator.incrementAndGet();</span><br><span class="line">        product.setId(newId);</span><br><span class="line">        products.put(newId, product);</span><br><span class="line">        return product;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Product get(long id) &#123;</span><br><span class="line">        return products.get(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SpringMVC 基于注解的配置文件，参考如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">    xmlns:p=&quot;http://www.springframework.org/schema/p&quot;</span><br><span class="line">    xmlns:mvc=&quot;http://www.springframework.org/schema/mvc&quot;</span><br><span class="line">    xmlns:context=&quot;http://www.springframework.org/schema/context&quot;</span><br><span class="line">    xsi:schemaLocation=&quot;</span><br><span class="line">        http://www.springframework.org/schema/beans</span><br><span class="line">        http://www.springframework.org/schema/beans/spring-beans.xsd</span><br><span class="line">        http://www.springframework.org/schema/mvc</span><br><span class="line">        http://www.springframework.org/schema/mvc/spring-mvc.xsd     </span><br><span class="line">        http://www.springframework.org/schema/context</span><br><span class="line">        http://www.springframework.org/schema/context/spring-context.xsd&quot;&gt;</span><br><span class="line">    &lt;context:component-scan base-package=&quot;controller&quot;/&gt;</span><br><span class="line">    &lt;context:component-scan base-package=&quot;service&quot;/&gt;    </span><br><span class="line">    &lt;mvc:annotation-driven/&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/css/**&quot; location=&quot;/css/&quot;/&gt;</span><br><span class="line">    &lt;mvc:resources mapping=&quot;/*.html&quot; location=&quot;/&quot;/&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;bean id=&quot;viewResolver&quot; class=&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="重定向和闪存属性"><a href="#重定向和闪存属性" class="headerlink" title="重定向和闪存属性"></a>重定向和闪存属性</h3><p>如果你是一个经验丰富的Servlet/JSP 程序员，你肯定知道<code>请求转发(request forward)</code>和<code>请求重定向(request redirect)</code>的区别:</p>
<ul>
<li>相比而言，<code>forward</code> 比 <code>redirect</code>更快，因为<code>重定向</code>需要往返服务器，而<code>转发</code>不需要。</li>
<li>然后，有些情况重定向是首选。（eg: 你需要重定向到一个外部站点,你不能使用转发，yes！）</li>
</ul>
<p>通常默认情况使用<code>转发</code>，<code>转发</code>到一个视图或者转发到一个控制。有时候需要重定向（避免重复提交表单）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">return &quot;redirect:/view-product/&quot; + savedProduct.getId();</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>如上使用<code>重定向</code>替代<code>转发</code>操作。</p>
</blockquote>
<p>众所周知，<code>转发</code>可以很容易的将属性添加到模型对象，属性值将用于视图展示,由于,<code>重定向</code>是往返于服务器，<code>重定向</code>将丢失所有模型。<br>Spring3.1及其更高版本提供一种重定向时保留值，称为闪flash attributes（闪存属性）</p>
<ul>
<li>如下ProductController类中saveProduct方法展示<code>flash attributes</code><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;save-product&quot;, method = RequestMethod.POST)</span><br><span class="line">public String saveProduct(ProductForm productForm, </span><br><span class="line">        RedirectAttributes redirectAttributes) &#123;</span><br><span class="line">    logger.info(&quot;saveProduct called&quot;);</span><br><span class="line">    // no need to create and instantiate a ProductForm</span><br><span class="line">    // create Product</span><br><span class="line">    Product product = new Product();</span><br><span class="line">    product.setName(productForm.getName());</span><br><span class="line">    product.setDescription(productForm.getDescription());</span><br><span class="line">    try &#123;</span><br><span class="line">        product.setPrice(new BigDecimal(productForm.getPrice()));</span><br><span class="line">    &#125; catch (NumberFormatException e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // add product</span><br><span class="line">    Product savedProduct = productService.add(product);</span><br><span class="line">    </span><br><span class="line">    redirectAttributes.addFlashAttribute(&quot;message&quot;, </span><br><span class="line">            &quot;The product was successfully added.&quot;);</span><br><span class="line"></span><br><span class="line">    return &quot;redirect:/view-product/&quot; + savedProduct.getId();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="请求参数与路径变量"><a href="#请求参数与路径变量" class="headerlink" title="请求参数与路径变量"></a>请求参数与路径变量</h3><p>请求参数和路径变量作为URL的一部分，它将发送到服务器进行访问。key=value形式的请求参数由<code>&amp;</code>符号分割，如下：productId的URL请求参数为3<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/annotated2/view-product?productId=3</span><br></pre></td></tr></table></figure></p>
<p>在servlet编程，你获取请求参数的值通过HttpServletRequest的getParameter方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">String productId = httpServletRequest.getParameter(&quot;productId&quot;);</span><br></pre></td></tr></table></figure></p>
<p>Spring MVC 有更加简单的方法检索请求参数，使用<code>org.springframework.web.bind.annotation.RequestParam</code>注解类型来注解到请求参数，例如：如下的方法将捕获请求参数productId<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public void sendProduct(@RequestParam int productId)</span><br></pre></td></tr></table></figure></p>
<p>路径变量类似与请求参数，他没有key值，eg:<code>/view-product/productId</code></p>
<ul>
<li>如下使用路径变量<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/view-product/&#123;id&#125;&quot;)</span><br><span class="line">public String viewProduct(@PathVariable Long id, Model model) &#123;</span><br><span class="line">    Product product = productService.get(id);</span><br><span class="line">    model.addAttribute(&quot;product&quot;, product);</span><br><span class="line">    return &quot;ProductView&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>要使用路径变量，需要使用<code>@RequestMapping</code>注解的value属性设置一个变量。如下RequestMapping注解定义变量为id<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/view-product/&#123;id&#125;&quot;)</span><br></pre></td></tr></table></figure></p>
<p>然后，在方法中添加同名变量于<code>@PathVariable</code>注解,当调用方法，<code>id</code>值作为URL请求的一部分。</p>
<hr>
<p>你可以在你的请求映射方法上使用多路径变量，例如：如下两个不同的路径变量，<code>userId</code>和<code>orderId</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(value = &quot;/view-product/&#123;userId&#125;/&#123;orderId&#125;&quot;)</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>访问<code>viewProduct 方法</code>的<code>路径变量</code>, 使用<code>http://localhost:8080/you-project-name/view-product/1</code> </p>
</blockquote>
<p>使用路径变量有事有一个小问题：在某些情况下，可能会产生混淆浏览器，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://example.com/context/abc</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>浏览器会认为<code>abc</code> 是一个action.(yes！，他确实是一个action),<code>http://example.com/context</code>为上下文路径。<br>如果访问一个静态文件,它应当是这样的:<code>http://example.com/context/logo.png</code>。 但是<code>http://example.com/context/abc/1</code> 跳转到一个JSP。JSP 包含<code>&lt;img src=&quot;logo.png&quot;/&gt;</code>,访问这个图片，你会发现它访问的是<code>http://example.com/abc/logo.png</code>. 它找错了上下文路径？</p>
</blockquote>
<p>我们可以使用JSTL标签，解决这个问题(解析正确URL)：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;c:url value=&quot;/img/logo.png&quot;/&gt;</span><br></pre></td></tr></table></figure></p>
<p>为了避免CSS 文件 或 JS 文件出现未找到情况，同样受用(貌似无所谓)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;style type=&quot;text/css&quot;&gt;@import url(&quot;&lt;c:url value=&quot;/css/main.css&quot;/&gt;&quot;);&lt;/style&gt;</span><br></pre></td></tr></table></figure></p>
<h2 id="ModelAttribute"><a href="#ModelAttribute" class="headerlink" title="@ModelAttribute"></a>@ModelAttribute</h2><p>我们知道，Spring MVC 每处理一个请求处理方法（action） 都会创建一个Model 对象，你可以在<code>请求处理方法</code>添加Model参数。<br><code>@ModelAttribute</code>注解可以装饰Model的实例化对象。<br><code>@ModelAttribute</code>可以注解在参数或方法中,它将会检索或创建一个Model对象。如下:<code>submitOrder方法</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@RequestMapping(method = RequestMethod.POST)</span><br><span class="line">public String submitOrder(@ModelAttribute(&quot;newOrder&quot;) Order order,</span><br><span class="line">    Model model) &#123; </span><br><span class="line">   ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><code>Order</code>  创建实例化并添加至Model 对象，Model对应属性值为<code>newOrder</code>。如果没有定义key的名称，那么类型的名称将会添加到Model中。<br>例如，如下<code>action</code>，每次被访问,都会创建实例化<code>Order</code>对象，设置属性key为<code>order</code>并添加到<code>Model</code>中，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public String submitOrder(@ModelAttribute Order order, Model model)</span><br></pre></td></tr></table></figure></p>
<hr>
<p>第二个用法:<code>@ModelAttribute</code>标注一个非请求处理方法，在同一个控制器内带<code>@ModelAttribute</code>的方法每次进行请求处理方法调用都会触发该方法。<br>带<code>@ModelAttribute</code>的方法会在请求处理方法之前被调用，它将返回一个对象或<code>void类型</code>。如果返回一个对象，该对象会被自动添加到请求处理方法的Model中。<br>如下返回对象实例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@ModelAttribute</span><br><span class="line">public Product addProduct(@RequestParam String productId) &#123;</span><br><span class="line">    return productService.get(productId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>如果注解方法返回<code>void</code>，则还必须添加一个Model参数，并添加自己的实例，如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@ModelAttribute</span><br><span class="line">public void populateModel(@RequestParam String id, Model model) er);</span><br><span class="line">    model.addAttribute(new Account(id));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/07/07/FreeMarker入门/" itemprop="url">
                  FreeMarker入门
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-07-07T16:53:00+08:00" content="2014-07-07">
              2014-07-07
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaWeb/FreeMarker/" itemprop="url" rel="index">
                    <span itemprop="name">FreeMarker</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/07/07/FreeMarker入门/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/07/07/FreeMarker入门/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>FrameMarker 模板语言: FreeMarker Template Language ( FTL )。</p>
<ul>
<li><p>FreeMarker 入门实例</p>
<ul>
<li>Hello World 实例,了解Freemarkers 执行步骤</li>
<li>Types 实例，了解FreeMarker 内置类型转换</li>
</ul>
</li>
<li><p>引入依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.freemarker&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;freemarker&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.3.23&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="Hello-World-实例"><a href="#Hello-World-实例" class="headerlink" title="Hello World 实例"></a>Hello World 实例</h2><ul>
<li>在<code>resources目录</code>创建<code>hello.ftl</code>文件<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello,$&#123;name&#125;!</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p><code>.ftl</code>文件作为Freemarker 模板语言文件后缀,<code>${name}</code>会替换Model中的属性值</p>
</blockquote>
<ul>
<li><p>编写Java程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">package org.freecode.ftl;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.OutputStreamWriter;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import freemarker.template.Configuration;</span><br><span class="line">import freemarker.template.DefaultObjectWrapper;</span><br><span class="line">import freemarker.template.Template;</span><br><span class="line">import freemarker.template.TemplateException;</span><br><span class="line">    </span><br><span class="line">public class HelloFreemarker &#123;</span><br><span class="line">    public static void main(String[] args) </span><br><span class="line">    throws IOException, TemplateException &#123;</span><br><span class="line">        // 创建Freemarker 配置对象(模板工厂对象),并指定当前版本号。</span><br><span class="line">        Configuration cfg = new Configuration(Configuration.DEFAULT_INCOMPATIBLE_IMPROVEMENTS);</span><br><span class="line">        </span><br><span class="line">        //选择一种Model对象包装(Object Wrapper)类型.模板获取Model中的值. 默认如下,可忽略</span><br><span class="line">        cfg.setObjectWrapper(new DefaultObjectWrapper(Configuration.DEFAULT_INCOMPATIBLE_IMPROVEMENTS));</span><br><span class="line">        </span><br><span class="line">        // 模板目录父类目录地址</span><br><span class="line">        cfg.setDirectoryForTemplateLoading(new File(&quot;src/main/resources/&quot;));</span><br><span class="line">        </span><br><span class="line">        //Model 对象</span><br><span class="line">        Map&lt;String, Object&gt; model = new HashMap&lt;String, Object&gt;();</span><br><span class="line">        model.put(&quot;name&quot;, &quot;world&quot;);</span><br><span class="line">        </span><br><span class="line">        //获取一个模板对象。 需要告诉配置实例对象加载个哪个模板</span><br><span class="line">        Template template = cfg.getTemplate(&quot;hello.tfl&quot;);</span><br><span class="line">        </span><br><span class="line">        /*</span><br><span class="line">         * 处理模板,需要两个参数：</span><br><span class="line">         * 1、使用哪个Model?</span><br><span class="line">         * 2、输出到什么地方?</span><br><span class="line">         */</span><br><span class="line">        template.process(model, new OutputStreamWriter(System.out));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>运行程序，显示如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello World</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改<code>model.put(&quot;name&quot;, &quot;world&quot;);</code> 为<code>model.put(&quot;name&quot;, 123456789);</code> 查看输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Hello,123,456,789!</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>输出的格式取决默认的语言环境，如果在德国将看到输出为：<code>Hello,123.456.789!</code><br>Freemarker默认使用<code>java.text.DecimalFormat</code>对象数字类型进行格式化输出</p>
</blockquote>
<h2 id="types-实例"><a href="#types-实例" class="headerlink" title="types 实例"></a>types 实例</h2><p>为了精确控制对象将模型转换成文本（转换类型值到文本），我们可以使用FreeMarker提供的内置插件控制格式转换，如下：<code>types.ftl</code><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String: $&#123;string?html&#125;</span><br><span class="line">Number: $&#123;number?c&#125;</span><br><span class="line">Boolean: $&#123;boolean?string(&quot;+++++&quot;, &quot;-----&quot;)&#125;</span><br><span class="line">Date: $&#123;.now?time&#125;</span><br><span class="line">Complex: $&#123;object&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>.now</code>是一个特殊的变量，用于处理日期和时间，<code>?</code>后跟内置插件名称</p>
</blockquote>
<ul>
<li><p>创建一个Java程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">package org.freecode.ftl;</span><br><span class="line">import java.io.File;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.OutputStreamWriter;</span><br><span class="line">import java.math.BigDecimal;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Locale;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import freemarker.template.Configuration;</span><br><span class="line">import freemarker.template.Template;</span><br><span class="line">import freemarker.template.TemplateException;</span><br><span class="line">public class FreemarkerTypes &#123;</span><br><span class="line">  public static void main(String[] args) </span><br><span class="line">  throws IOException, TemplateException &#123;</span><br><span class="line">    Configuration cfg = new Configuration(Configuration.DEFAULT_INCOMPATIBLE_IMPROVEMENTS);</span><br><span class="line">    cfg.setDirectoryForTemplateLoading(new File(&quot;src/main/resources&quot;));</span><br><span class="line">    Map&lt;String, Object&gt; model = new HashMap&lt;String, Object&gt;();</span><br><span class="line">    model.put(&quot;string&quot;, &quot;easy &amp; fast &quot;);</span><br><span class="line">    model.put(&quot;number&quot;, new BigDecimal(&quot;1234.5678&quot;));</span><br><span class="line">    model.put(&quot;boolean&quot;, true);</span><br><span class="line">    model.put(&quot;object&quot;, Locale.US);</span><br><span class="line">    Template template = cfg.getTemplate(&quot;types.ftl&quot;);</span><br><span class="line">    template.process(model, new OutputStreamWriter(System.out));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>格式化实例输出如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">String: easy &amp;amp; fast </span><br><span class="line">Number: 1234.5678</span><br><span class="line">Boolean: +++++</span><br><span class="line">Date: 10:13:59</span><br><span class="line">Complex: en_US</span><br></pre></td></tr></table></figure>
</li>
<li><p>内置插件如何影响输出的呢？</p>
<ul>
<li>字符串：输出一个字符串，使用内置插件名称<code>html</code>,它将字符串编码为HTML，将<code>&amp;</code>转换为<code>&amp;amp;</code>HTML实体，它确保文本正确显示，并防止跨站脚本攻击(XSS)</li>
<li>数字：数字对象使用内置<code>c</code>,它告诉FreeMarker将数字类型使用文本解析。</li>
<li>布尔：这里类似一个三目表达式。FreeMarker不会去格式化布尔值，从概念上讲，<code>true</code>和<code>false</code>并没有通用的文本表示，如果我们不带任何参数(<code>${boolean}</code>),它将抛出一个异常。</li>
<li>日期：FreeMarker没有内置处理<code>java.util.Date</code>,因为它不知道如何显示日期和时间，或者两则，通过<code>time</code>告诉FreeMarker我们要显示时间。</li>
<li>复杂对象: 没有使用内置插件。 对于复杂对象，它默认使用<code>toString</code>返回一个字符串类型，所以可以使用内置字符串插件来处理。</li>
</ul>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/06/10/Spring MVC 入门/" itemprop="url">
                  Spring MVC 入门
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-06-10T16:53:00+08:00" content="2014-06-10">
              2014-06-10
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaWeb/" itemprop="url" rel="index">
                    <span itemprop="name">JavaWeb</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JavaWeb/Spring-MVC/" itemprop="url" rel="index">
                    <span itemprop="name">Spring MVC</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/06/10/Spring MVC 入门/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/06/10/Spring MVC 入门/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Struts2 用的人越来越少了呀~~~  Spring MVC的设计更加超前，使用也更加便利。</p>
<h2 id="Spring-MVC-简介"><a href="#Spring-MVC-简介" class="headerlink" title="Spring MVC 简介"></a>Spring MVC 简介</h2><ul>
<li>Spring MVC 是Spring Framework 中用于快速开发Web应用程序的一个模块。</li>
<li>采用MVC设计模式（模型-视图-控制器）。</li>
</ul>
<h2 id="Spring-优势"><a href="#Spring-优势" class="headerlink" title="Spring 优势"></a>Spring 优势</h2><ul>
<li>Spring MVC 采用调用Servlet中一个控制方法，控制转发到一个视图。（你不必编写多个Servlet。）</li>
<li>Spring MVC 实例化控制器类，并自动填充用户输入bean。（不需要配置XML映射、不需要使用request.paremxxx 获取请求信息）</li>
<li>Spring MVC 重新编辑XML配置文件，不需要重新编译或重启应用程序。</li>
<li>Spring MVC 自动绑定正确类型的用户输入信息。eg：Spring MVC可以自动解析字符串并设置float类型或double 类型。</li>
<li>Spring MVC 可以验证用户输入，如果输入失败可以重定向表单。可以使用声明和编码的方式。Spring MVC内置任务验证。</li>
<li>Spring MVC 支持国际化和本地化。（你可以显示用户区域多国家语言）</li>
<li>Spring MVC 支持多视图技术。可以是JSP、FreeMarker、Velocity、JSON数据。</li>
<li>Spring MVC 作为Spring 的一部分也算是一种优势把。</li>
</ul>
<blockquote>
<p>以上几乎所有优势Struts2 都具备。 只是Spring MVC 实现方式更加简单，Struts2 同样优秀而已。</p>
</blockquote>
<h2 id="Spring-MVC-入门"><a href="#Spring-MVC-入门" class="headerlink" title="Spring MVC 入门"></a>Spring MVC 入门</h2><h3 id="Spring-MVC-入口-（DispatcherServlet）"><a href="#Spring-MVC-入口-（DispatcherServlet）" class="headerlink" title="Spring MVC 入口 （DispatcherServlet）"></a>Spring MVC 入口 （DispatcherServlet）</h3><h4 id="配置入口"><a href="#配置入口" class="headerlink" title="配置入口"></a>配置入口</h4><p><strong>配置<code>web.xml</code>文件，增加Spring MVC 调度Servlet入口，全称为：<code>org.springframework.web.servlte.DispatcherServlet</code>.如下配置：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class</span><br><span class="line">        org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">    &lt;/servlet-class&gt;</span><br><span class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;    </span><br><span class="line">&lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">&lt;servlet-mapping&gt;</span><br><span class="line">    &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">    &lt;!-- map all requests to the DispatcherServlet --&gt;</span><br><span class="line">    &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">&lt;/servlet-mapping&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>load-on-startup</code>元素是可选的，如果存在，在启动应用程序时，它会在加载Servlet并调用init()方法。如果不存，当第一次请求Servlet时被加载。</p>
</blockquote>
<h4 id="默认配置文件方式"><a href="#默认配置文件方式" class="headerlink" title="默认配置文件方式"></a>默认配置文件方式</h4><p><strong>当其调度 Servlet 将使用Spring MVC的许多默认组件，此外，在初始化时，它会寻找应用程序WEB_INF目录中的配置文件，XML文件的名称必须符合如下模式:</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">servletName-servlet.xml</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>如果定义一个部署描述的Servlet，且名为为SringMVC,那么需要用SpringMVC-servlet.xml文件在应用程序WEB-INF目录下</p>
<h4 id="自定义配置文件方式"><a href="#自定义配置文件方式" class="headerlink" title="自定义配置文件方式"></a>自定义配置文件方式</h4><p>同样，你可以告诉调度器servlet 在哪里找到Spring MVC配置文件。 您可以通过servlet声明，通过init-param元素做到这一点。如下修改默认名称和位置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;</span><br><span class="line">        org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">    &lt;/servlet-class&gt;</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">        &lt;param-value&gt;/WEB-INF/config/simple-config.xml&lt;/param-value&gt;</span><br><span class="line">    &lt;/init-param&gt;</span><br><span class="line">    &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;    </span><br><span class="line">&lt;/servlet&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<hr>
<h3 id="控制器接口"><a href="#控制器接口" class="headerlink" title="控制器接口"></a>控制器接口</h3><h3 id="Spring-MVC-应用"><a href="#Spring-MVC-应用" class="headerlink" title="Spring MVC 应用"></a>Spring MVC 应用</h3><p><strong>如下演示如何构建一个Spring MVC 项目的详细步骤</strong></p>
<h4 id="下载依赖"><a href="#下载依赖" class="headerlink" title="下载依赖"></a>下载依赖</h4><ul>
<li>将如下依赖引入<code>WEB-INF\lib</code>目录下<ul>
<li>spring-core</li>
<li>spring-beans</li>
<li>spring-context</li>
<li>spring-expression</li>
<li>spring-web</li>
<li>spring-webmvc</li>
<li>commons-looging</li>
</ul>
</li>
<li>使用Maven构建项目<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;javax.servlet&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;javax.servlet-api&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;3.1.0&lt;/version&gt;</span><br><span class="line">	&lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-webmvc&lt;/artifactId&gt;</span><br><span class="line">	&lt;version&gt;4.0.4.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p><code>spring-webmvc</code> 会将相关依赖引入。</p>
</blockquote>
<h4 id="配置web-xml和Spring-MVC配置文件"><a href="#配置web-xml和Spring-MVC配置文件" class="headerlink" title="配置web.xml和Spring MVC配置文件"></a>配置web.xml和Spring MVC配置文件</h4><h5 id="配置-web-xml"><a href="#配置-web-xml" class="headerlink" title="配置 web.xml"></a>配置 web.xml</h5><p><strong>同上一样，部署描述文件(web.xml) 配置如下</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app version=&quot;3.1&quot; </span><br><span class="line">    xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot; </span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">    xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee </span><br><span class="line">http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class</span><br><span class="line">            org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">        &lt;/servlet-class&gt;</span><br><span class="line">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;    </span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">        &lt;!-- map all requests to the DispatcherServlet --&gt;</span><br><span class="line">        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line"></span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>这里，你告诉Servlet/JSP容器(应用程序)使用Spring MVC 调度servlet映射所有URL。（通过<code>url-pattern</code>元素设置为<code>\</code>）<br>而且，配置Spring MVC配置文件必须遵守约定（命名约定 + 将配置文件放置<code>/WEB-INF</code>目录中）。</p>
</blockquote>
<h5 id="配置Spring-MVC配置文件"><a href="#配置Spring-MVC配置文件" class="headerlink" title="配置Spring MVC配置文件"></a>配置Spring MVC配置文件</h5><p><strong>配置springmvc-servlet.xml 文件，如下</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</span><br><span class="line">  http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</span><br><span class="line">       </span><br><span class="line">    &lt;bean name=&quot;/input-product&quot;</span><br><span class="line">        class=&quot;controller.InputProductController&quot;/&gt;</span><br><span class="line">    &lt;bean name=&quot;/save-product&quot; </span><br><span class="line">        class=&quot;controller.SaveProductController&quot;/&gt;</span><br><span class="line"></span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>在这里声明了两个控制器类，InputProductController 和 SaveProductController,映射路径为<code>/input-product</code> 和 <code>/save-product</code>。</p>
</blockquote>
<h4 id="控制器"><a href="#控制器" class="headerlink" title="控制器"></a>控制器</h4><p>InputProductController 和 SaveProductController 为两个<strong>旧式</strong>的控制器,通过实现<code>Controller</code>接口,返回视图模型,如下：</p>
<blockquote>
<p>之所以称为<code>旧式控制器</code>，是因为:这是spring2.5最初实现spring mvc 的方式。<br>现在大多数使用的控制器方式是基于注解的（Annotation-Based Controllers）。</p>
</blockquote>
<h5 id="InputProductController-类"><a href="#InputProductController-类" class="headerlink" title="InputProductController 类"></a>InputProductController 类</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package controller;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import org.apache.commons.logging.Log;</span><br><span class="line">import org.apache.commons.logging.LogFactory;</span><br><span class="line">import org.springframework.web.servlet.ModelAndView;</span><br><span class="line">import org.springframework.web.servlet.mvc.Controller;</span><br><span class="line"></span><br><span class="line">public class InputProductController implements Controller &#123;</span><br><span class="line"></span><br><span class="line">    private static final Log logger = LogFactory.getLog(InputProductController.class);</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public ModelAndView handleRequest(HttpServletRequest request,</span><br><span class="line">            HttpServletResponse response) throws Exception &#123;</span><br><span class="line">        logger.info(&quot;InputProductController called&quot;);</span><br><span class="line">        return new ModelAndView(&quot;/WEB-INF/jsp/ProductForm.jsp&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>InputProductController类中的handleRequest 方法返回一个ModelAndView对象，ModelAndView对象包含一个视图，不包含模型。这个实例，请求转发到<code>/WEB-INF/jsp/ProductForm.jsp</code>页面。</p>
</blockquote>
<h5 id="SaveProductController-类"><a href="#SaveProductController-类" class="headerlink" title="SaveProductController 类"></a>SaveProductController 类</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">package controller;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import org.apache.commons.logging.Log;</span><br><span class="line">import org.apache.commons.logging.LogFactory;</span><br><span class="line">import org.springframework.web.servlet.ModelAndView;</span><br><span class="line">import org.springframework.web.servlet.mvc.Controller;</span><br><span class="line">import domain.Product;</span><br><span class="line">import form.ProductForm;</span><br><span class="line"></span><br><span class="line">public class SaveProductController implements Controller &#123;</span><br><span class="line"></span><br><span class="line">    private static final Log logger = LogFactory</span><br><span class="line">            .getLog(SaveProductController.class);</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public ModelAndView handleRequest(HttpServletRequest request,</span><br><span class="line">            HttpServletResponse response) throws Exception &#123;</span><br><span class="line">        logger.info(&quot;SaveProductController called&quot;);</span><br><span class="line">        ProductForm productForm = new ProductForm();</span><br><span class="line">        // populate action properties</span><br><span class="line">        productForm.setName(request.getParameter(&quot;name&quot;));</span><br><span class="line">        productForm.setDescription(request.getParameter(</span><br><span class="line">                &quot;description&quot;));</span><br><span class="line">        productForm.setPrice(request.getParameter(&quot;price&quot;));</span><br><span class="line"></span><br><span class="line">        // create model</span><br><span class="line">        Product product = new Product();</span><br><span class="line">        product.setName(productForm.getName());</span><br><span class="line">        product.setDescription(productForm.getDescription());</span><br><span class="line">        try &#123;</span><br><span class="line">            product.setPrice(</span><br><span class="line">                    Float.parseFloat(productForm.getPrice()));</span><br><span class="line">        &#125; catch (NumberFormatException e) &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        // insert code to save Product</span><br><span class="line"></span><br><span class="line">        return new ModelAndView(&quot;/WEB-INF/jsp/ProductDetails.jsp&quot;, </span><br><span class="line">                &quot;product&quot;, product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>SaveProductController类中handleRequest方法 创建一个ProductForm对象设置请求参数（request parameters）。<br>创建一个Product对象设置属性值。<br>【Spring MVC有更加方便的处理请求参数和处理Bean对象的方法，这里我们使用最原始的。】<br> 返回ModelAndView对象包含视图路径、模型名称、模型。返回视图结果。</p>
</blockquote>
<h4 id="视图-View"><a href="#视图-View" class="headerlink" title="视图 (View)"></a>视图 (View)</h4><blockquote>
<p>通常会将JSP 页面存储在<code>/WEB-INF/</code>下面,防止外部直接访问。<br>这里包含两个JSP页面，ProductForm.jsp和ProductDetails.jsp</p>
</blockquote>
<h5 id="ProductForm-jsp-页面"><a href="#ProductForm-jsp-页面" class="headerlink" title="ProductForm.jsp 页面"></a>ProductForm.jsp 页面</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Add Product Form&lt;/title&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;@import url(css/main.css);&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;div id=&quot;global&quot;&gt;</span><br><span class="line">&lt;form action=&quot;save-product&quot; method=&quot;post&quot;&gt;</span><br><span class="line">    &lt;fieldset&gt;</span><br><span class="line">        &lt;legend&gt;Add a product&lt;/legend&gt;</span><br><span class="line">        &lt;label for=&quot;name&quot;&gt;Product Name: &lt;/label&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; id=&quot;name&quot; name=&quot;name&quot; value=&quot;&quot; </span><br><span class="line">            tabindex=&quot;1&quot;&gt;</span><br><span class="line">        &lt;label for=&quot;description&quot;&gt;Description: &lt;/label&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; id=&quot;description&quot; name=&quot;description&quot; </span><br><span class="line">            tabindex=&quot;2&quot;&gt;</span><br><span class="line">        &lt;label for=&quot;price&quot;&gt;Price: &lt;/label&gt;</span><br><span class="line">        &lt;input type=&quot;text&quot; id=&quot;price&quot; name=&quot;price&quot; tabindex=&quot;3&quot;&gt;</span><br><span class="line">        &lt;div id=&quot;buttons&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;dummy&quot;&gt; &lt;/label&gt;</span><br><span class="line">            &lt;input id=&quot;reset&quot; type=&quot;reset&quot; tabindex=&quot;4&quot;&gt;</span><br><span class="line">            &lt;input id=&quot;submit&quot; type=&quot;submit&quot; tabindex=&quot;5&quot; </span><br><span class="line">                value=&quot;Add Product&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/fieldset&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h5 id="ProductDetails-jsp-页面"><a href="#ProductDetails-jsp-页面" class="headerlink" title="ProductDetails.jsp 页面"></a>ProductDetails.jsp 页面</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;title&gt;Save Product&lt;/title&gt;</span><br><span class="line">&lt;style type=&quot;text/css&quot;&gt;@import url(css/main.css);&lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;div id=&quot;global&quot;&gt;</span><br><span class="line">    &lt;h4&gt;The product has been saved.&lt;/h4&gt;</span><br><span class="line">    &lt;p&gt;</span><br><span class="line">        &lt;h5&gt;Details:&lt;/h5&gt;</span><br><span class="line">        Product Name: $&#123;product.name&#125;&lt;br/&gt;</span><br><span class="line">        Description: $&#123;product.description&#125;&lt;br/&gt;</span><br><span class="line">        Price: $$&#123;product.price&#125;</span><br><span class="line">    &lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>ProductDetails.jsp 页面显示，通过EL表达式访问Product域模型对象。</p>
</blockquote>
<h5 id="测试应用"><a href="#测试应用" class="headerlink" title="测试应用"></a>测试应用</h5><p>在浏览器访问如下URL<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/your-project-name/input-product</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>xxxx</p>
</blockquote>
<h5 id="视图解析器-View-Resolver"><a href="#视图解析器-View-Resolver" class="headerlink" title="视图解析器(View Resolver)"></a>视图解析器(View Resolver)</h5><p>在Spring MVC中视图解析器（View Resolver）负责视图解析映射。我们可以在配置文件中声明<code>viewResolver bean</code>，参考如下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=&quot;viewResolver&quot; class=&quot;org.springframework.web.servlet.</span><br><span class="line">view.InternalResourceViewResolver&quot;&gt;</span><br><span class="line">    &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;</span><br><span class="line">    &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</span><br><span class="line">&lt;/bean&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p><code>View Resolver</code> 解决前缀和后缀问题<br>如上<code>View Resolver Bean</code>配置两个属性，<code>prefix (前缀)</code> 和 <code>suffix （后缀）</code>， 这样将缩短视图路径，而不需要再写全路径<code>/WEB-INF/jsp/myPage.jsp</code>，只需要写<code>myPage</code>。</p>
</blockquote>
<h4 id="修改项目"><a href="#修改项目" class="headerlink" title="修改项目"></a>修改项目</h4><p><strong>将Spring MVC 配置文件重命名为<code>springmvc-config.xml</code>,并移至<code>/WEB-INF/config</code>目录，我们需要告诉部署描述（web.xml）文件。如下：</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;web-app version=&quot;3.1&quot; </span><br><span class="line">    xmlns=&quot;http://xmlns.jcp.org/xml/ns/javaee&quot; </span><br><span class="line">    xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; </span><br><span class="line">    xsi:schemaLocation=&quot;http://xmlns.jcp.org/xml/ns/javaee</span><br><span class="line">http://xmlns.jcp.org/xml/ns/javaee/web-app_3_1.xsd&quot;&gt;   </span><br><span class="line"></span><br><span class="line">    &lt;servlet&gt;</span><br><span class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">        &lt;servlet-class&gt;</span><br><span class="line">            org.springframework.web.servlet.DispatcherServlet</span><br><span class="line">        &lt;/servlet-class&gt;</span><br><span class="line">        &lt;init-param&gt;</span><br><span class="line">            &lt;param-name&gt;contextConfigLocation&lt;/param-name&gt;</span><br><span class="line">            &lt;param-value&gt;</span><br><span class="line">                /WEB-INF/config/springmvc-config.xml</span><br><span class="line">            &lt;/param-value&gt;</span><br><span class="line">        &lt;/init-param&gt;</span><br><span class="line">        &lt;load-on-startup&gt;1&lt;/load-on-startup&gt;    </span><br><span class="line">    &lt;/servlet&gt;</span><br><span class="line"></span><br><span class="line">    &lt;servlet-mapping&gt;</span><br><span class="line">        &lt;servlet-name&gt;springmvc&lt;/servlet-name&gt;</span><br><span class="line">        &lt;url-pattern&gt;/&lt;/url-pattern&gt;</span><br><span class="line">    &lt;/servlet-mapping&gt;</span><br><span class="line">&lt;/web-app&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>修改Spring MVC 配置文件，增加<code>View Resolver Bean</code></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;beans xmlns=&quot;http://www.springframework.org/schema/beans&quot;</span><br><span class="line">  xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><br><span class="line">  xsi:schemaLocation=&quot;http://www.springframework.org/schema/beans</span><br><span class="line">  http://www.springframework.org/schema/beans/spring-beans.xsd&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;bean name=&quot;/input-product&quot; </span><br><span class="line">            class=&quot;controller.InputProductController&quot;/&gt;</span><br><span class="line">    &lt;bean name=&quot;/save-product&quot;  </span><br><span class="line">            class=&quot;controller.SaveProductController&quot;/&gt;</span><br><span class="line">    &lt;bean id=&quot;viewResolver&quot; </span><br><span class="line">            class=&quot;org.springframework.web.servlet.view.</span><br><span class="line">InternalResourceViewResolver&quot;&gt;</span><br><span class="line">        &lt;property name=&quot;prefix&quot; value=&quot;/WEB-INF/jsp/&quot;/&gt;</span><br><span class="line">        &lt;property name=&quot;suffix&quot; value=&quot;.jsp&quot;/&gt;</span><br><span class="line">    &lt;/bean&gt;</span><br><span class="line">&lt;/beans&gt;</span><br></pre></td></tr></table></figure></p>
<p><strong>通过如下访问应用程序</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8080/your-project-name/input-product</span><br></pre></td></tr></table></figure></p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ul>
<li>介绍Spring MVC</li>
<li>如何构建一个简单的Spring MVC Web 项目</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/05/11/2014/MyBatis Boostrap/" itemprop="url">
                  MyBatis Generator
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-05-11T22:53:00+08:00" content="2014-05-11">
              2014-05-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Java-Web/" itemprop="url" rel="index">
                    <span itemprop="name">Java Web</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Java-Web/MyBatis/" itemprop="url" rel="index">
                    <span itemprop="name">MyBatis</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/05/11/2014/MyBatis Boostrap/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/05/11/2014/MyBatis Boostrap/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>MyBatis 也提供了一些工具如 MyBatis Generator(<a href="http://www.mybatis.org/generator/)，可以被用来从已经存在的数据库" target="_blank" rel="external">http://www.mybatis.org/generator/)，可以被用来从已经存在的数据库</a> schema 中，产生持久化代码如数据库实体（database entities）,映射器 Mapper 接口，MapperXML 配置文件。</p>
<h2 id="MyBatis-Generator-介绍"><a href="#MyBatis-Generator-介绍" class="headerlink" title="MyBatis Generator 介绍"></a>MyBatis Generator 介绍</h2><ul>
<li>MyBatis Generator (MBG) 是一个Mybatis的代码生成器</li>
<li>它可以将数据库表生成基础对象。(不再需要手工创建对象和配置文件)</li>
<li>MBG 能够创建简单的CDUR(增删改查)。（仍然需要手写SQL和对象，用于级联查询和存储过程）</li>
</ul>
<hr>
<p>MyBatis 生成如下：</p>
<ul>
<li>匹配表结构的Java POJO 对象， 可能包括<ul>
<li>一个和表主键匹配的类（如果存在主键）</li>
<li>一个包含了非主键字段的类（BLOB字段除外）</li>
<li>一个包含BLOB字段的类（如果表包含了BLOB字段）</li>
<li>一个允许动态查询、更新和删除的类<br>这些类之间会有适当的继承关系。 可以配置生成器来生成不同类型的 POJO 的层次结构。 例如，您可能会选择针对每个表生成一个单独的实体对象。</li>
</ul>
</li>
<li>MBG在配置中为每个表简单的生成 CRUD SQL 操作。生成的SQL 语句包括：<ul>
<li>insert (插入)</li>
<li>update by primary key (根据主键更新记录)</li>
<li>update by example (根据条件更新记录)</li>
<li>delete by primary key (根据主键删除记录)</li>
<li>delete by example (根据条件删除记录)</li>
<li>select by primary key (根据主键查询记录)</li>
<li>select by example (根据条件查询记录集)</li>
<li>count by example (根据条件查询记录总数)<br>根据表的结构，生成的这些语句会有不同的变化（例如，如果表中没有主键，那么 MBG 将不会生成update by primary key方法）。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>注意<ul>
<li>MBG 会自动合并重名XML文件（是合并，保留修改），从而可以反复运行，而不必担心修改丢失。</li>
<li>MBG 不会合并Java文件，它可以覆盖或保留不同命名的文件。Eclipse插件时，MBG自动合并Java文件。</li>
</ul>
</li>
</ul>
<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><p>快速使用MBG步骤如下：</p>
<ul>
<li>1、创建并填写适当的配置文件，必须包含如下：(查看 XML配置参考)<ul>
<li><code>&lt;jdbcConnection&gt;</code> 元素定义如何连接目标数据库</li>
<li><code>&lt;javaModelGenerator&gt;</code> 元素来指定生成 Java 模型对象所属的包</li>
<li><code>&lt;sqlMapGenerator&gt;</code> 元素来指定生成 SQL 映射文件所属的包和的目标项目</li>
<li>(可选) <code>&lt;javaClientGenerator&gt;</code> 元素来指定目标包和目标项目生成的客户端接口和类（如果您不想生成 Java 客户端代码您可以省略<code>&lt;javaClientGenerator&gt;</code>元素）</li>
<li>至少一个数据库<code>&lt;table&gt;</code>元素</li>
</ul>
</li>
<li>2、将文件保存适当的位置（例如：<code>\temp\generatorConfig.xml</code>）</li>
<li><p>3、执行如下命令运行MBG:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar mybatis-generator-core-x.x.x.jar -configfile \temp\generatorConfig.xml -overwrite</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MBG使用配置文件运行，<code>-overwrite</code> 表示覆盖同名Java文件。如果有冲突，MBG会生成一个唯一的文件。（e.g MyClass.java）</p>
</blockquote>
</li>
<li>4、MBG运行后，你需要创建或修改标准的MyBatis配置文件来使用新生成的代码。</li>
</ul>
<h2 id="XML配置参考"><a href="#XML配置参考" class="headerlink" title="XML配置参考"></a>XML配置参考</h2><h3 id="MyBatis-Generator-XML-配置参考"><a href="#MyBatis-Generator-XML-配置参考" class="headerlink" title="MyBatis Generator XML 配置参考"></a>MyBatis Generator XML 配置参考</h3><p>如下是MBG的一个XML配置文件驱动。配置文件告诉MBG：</p>
<ul>
<li>如何链接到数据库</li>
<li>生成什么对象，及其如何生成</li>
<li>哪些表生成对象</li>
</ul>
<p><strong>如下是MBG配置文件实例。你应当查阅每一个元素说明</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE generatorConfiguration</span><br><span class="line">  PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span><br><span class="line">  &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;generatorConfiguration&gt;</span><br><span class="line">  &lt;classPathEntry location=&quot;/Program Files/IBM/SQLLIB/java/db2java.zip&quot; /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;context id=&quot;DB2Tables&quot; targetRuntime=&quot;MyBatis3&quot;&gt;</span><br><span class="line">    &lt;jdbcConnection driverClass=&quot;COM.ibm.db2.jdbc.app.DB2Driver&quot;</span><br><span class="line">        connectionURL=&quot;jdbc:db2:TEST&quot;</span><br><span class="line">        userId=&quot;db2admin&quot;</span><br><span class="line">        password=&quot;db2admin&quot;&gt;</span><br><span class="line">    &lt;/jdbcConnection&gt;</span><br><span class="line"></span><br><span class="line">    &lt;javaTypeResolver &gt;</span><br><span class="line">      &lt;property name=&quot;forceBigDecimals&quot; value=&quot;false&quot; /&gt;</span><br><span class="line">    &lt;/javaTypeResolver&gt;</span><br><span class="line"></span><br><span class="line">    &lt;javaModelGenerator targetPackage=&quot;test.model&quot; targetProject=&quot;\MBGTestProject\src&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">      &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;/javaModelGenerator&gt;</span><br><span class="line"></span><br><span class="line">    &lt;sqlMapGenerator targetPackage=&quot;test.xml&quot;  targetProject=&quot;\MBGTestProject\src&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;/sqlMapGenerator&gt;</span><br><span class="line"></span><br><span class="line">    &lt;javaClientGenerator type=&quot;XMLMAPPER&quot; targetPackage=&quot;test.dao&quot;  targetProject=&quot;\MBGTestProject\src&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;/javaClientGenerator&gt;</span><br><span class="line"></span><br><span class="line">    &lt;table schema=&quot;DB2ADMIN&quot; tableName=&quot;ALLTYPES&quot; domainObjectName=&quot;Customer&quot; &gt;</span><br><span class="line">      &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">      &lt;generatedKey column=&quot;ID&quot; sqlStatement=&quot;DB2&quot; identity=&quot;true&quot; /&gt;</span><br><span class="line">      &lt;columnOverride column=&quot;DATE_FIELD&quot; property=&quot;startDate&quot; /&gt;</span><br><span class="line">      &lt;ignoreColumn column=&quot;FRED&quot; /&gt;</span><br><span class="line">      &lt;columnOverride column=&quot;LONG_VARCHAR_FIELD&quot; jdbcType=&quot;VARCHAR&quot; /&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/context&gt;</span><br><span class="line">&lt;/generatorConfiguration&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="MBG-XML-元素说明"><a href="#MBG-XML-元素说明" class="headerlink" title="MBG XML 元素说明"></a>MBG XML 元素说明</h3><p>查看官方元素说明：<a href="http://www.mybatis.org/generator/configreference/xmlconfig.html" target="_blank" rel="external">http://www.mybatis.org/generator/configreference/xmlconfig.html</a></p>
<h2 id="通过Maven-plugin-运行MBG"><a href="#通过Maven-plugin-运行MBG" class="headerlink" title="通过Maven plugin 运行MBG"></a>通过Maven plugin 运行MBG</h2><p>运行MBG 可以使用<code>命令提示符</code>、<code>Ant任务</code>、<code>Maven Plugin</code>、<code>Java程序</code>。 这里介绍Maven 形式。</p>
<h3 id="最简配置如下"><a href="#最简配置如下" class="headerlink" title="最简配置如下"></a>最简配置如下</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &lt;plugins&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;plugin&gt;</span><br><span class="line">	  &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;</span><br><span class="line">	  &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.3.2&lt;/version&gt;</span><br><span class="line">  &lt;/plugin&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Maven-目标（Goal）和执行（Execution）"><a href="#Maven-目标（Goal）和执行（Execution）" class="headerlink" title="Maven 目标（Goal）和执行（Execution）"></a>Maven 目标（Goal）和执行（Execution）</h3><p>MBG Maven Plugin 可以包含一个目录: <code>mybatis-generator:generate</code> ，如下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugins&gt;</span><br><span class="line">     ...</span><br><span class="line">     &lt;plugin&gt;</span><br><span class="line">   	  &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;</span><br><span class="line">   	  &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">       &lt;version&gt;1.3.2&lt;/version&gt;</span><br><span class="line">       &lt;executions&gt;</span><br><span class="line">         &lt;execution&gt;</span><br><span class="line">           &lt;id&gt;Generate MyBatis Artifacts&lt;/id&gt;</span><br><span class="line">           &lt;goals&gt;</span><br><span class="line">             &lt;goal&gt;generate&lt;/goal&gt;</span><br><span class="line">           &lt;/goals&gt;</span><br><span class="line">         &lt;/execution&gt;</span><br><span class="line">       &lt;/executions&gt;</span><br><span class="line">     &lt;/plugin&gt;</span><br><span class="line">     ...</span><br><span class="line">   &lt;/plugins&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>MBG插件将会绑定到Maven生命周期的 <code>generate-sources</code> 阶段。 所以他会在编译步骤之前执行。 此外注意MBG目标将绑定生成Java和XML资源文件的建立，他们都将包括在生成的JAR包内。</p>
</blockquote>
<ul>
<li><p>通过如下命令执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn mybatis-generator:generate</span><br></pre></td></tr></table></figure>
</li>
<li><p>或则 标准的Maven命令属性传递参数执行 (这条命令会是使MBG覆盖重名的文件)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -Dmybatis.generator.overwrite=true mybatis-generator:generate</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="MBG-参考参数"><a href="#MBG-参考参数" class="headerlink" title="MBG 参考参数"></a>MBG 参考参数</h3><p>如下简单参考参数实例（大多数情况下为默认设置）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugins&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">        &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.3.2&lt;/version&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">            &lt;configurationFile&gt;src/main/resources/generatorConfig.xml&lt;/configurationFile&gt;</span><br><span class="line">            &lt;sqlScript&gt;classpath:mbg/test/common/scripts/CreateDB.sql&lt;/sqlScript&gt;</span><br><span class="line">            &lt;jdbcDriver&gt;org.hsqldb.jdbcDriver&lt;/jdbcDriver&gt;</span><br><span class="line">            &lt;jdbcURL&gt;jdbc:hsqldb:mem:aname&lt;/jdbcURL&gt;</span><br><span class="line">            &lt;jdbcUserId&gt;sa&lt;/jdbcUserId&gt;</span><br><span class="line">            &lt;verbose&gt;true&lt;/verbose&gt;</span><br><span class="line">            &lt;overwrite&gt;true&lt;/overwrite&gt;</span><br><span class="line">             ....</span><br><span class="line">        &lt;/configuration&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure></p>
<p>如下是参考参数，均为可选，部分默认。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>configurationFile</td>
<td>File</td>
<td>指定配置文件的名称。默认值：<code>${basedir}/src/main/resources/generatorConfig.xml</code></td>
</tr>
<tr>
<td>contexts</td>
<td>String</td>
<td>如果指定了该参数，使用逗号隔开<code>context</code>会被执行。 这些指定的<code>context</code>必须和配置文件中 <code>&lt;context&gt;</code> 元素的 <code>id</code> 属性一致。只有指定的这些<code>contextid</code>会被激活执行。如果没有指定该参数，所有的<code>context</code>都会被激活执行。</td>
</tr>
<tr>
<td>jdbcDriver</td>
<td>String</td>
<td>如果您指定了 sqlScript 参数, 当连接数据库时这里的值是JDBC驱动类的权限定名称。</td>
</tr>
<tr>
<td>jdbcPassword</td>
<td>String</td>
<td>如果您指定了 <code>sqlScript</code> 参数, 这是连接数据库的密码。</td>
</tr>
<tr>
<td>jdbcURL</td>
<td>String</td>
<td>如果您指定了 <code>sqlScript</code> 参数, 这是连接数据库的<code>JDBC URL</code></td>
</tr>
<tr>
<td>jdbcUserId</td>
<td>String</td>
<td>如果您指定了 <code>sqlScript</code> 参数, 这里是连接数据库的用户<code>id</code></td>
</tr>
<tr>
<td>outputDirectory</td>
<td>File</td>
<td>将放置 MBG 所生成文件的目录。 这个目录是用于当<code>targetProject</code> 在配置文件中设置特殊值的”MAVEN”时使用(大小写敏感)。 默认值: <code>${project.build.directory}/generated-sources/mybatis-generator</code></td>
</tr>
<tr>
<td>overwrite</td>
<td>boolean</td>
<td>如果为<code>true</code>，新生成的Java文件会覆盖原有的文件。 如果没有指定该参数，存在同名的文件，MBG会给新生成的代码文件生成一个唯一的名字(例如： MyClass.java.1, MyClass.java.2 等等)。 <strong>重要: 生成器一定会自动合并或覆盖已经生成的XML文件。</strong> 默认值: <code>false</code></td>
</tr>
<tr>
<td>sqlScript</td>
<td>String</td>
<td>要在生成代码之前运行的 SQL 脚本文件的位置。 如果为空，不会执行任何脚本。 如果不为空，<code>jdbcDriver</code>, <code>jdbcURL</code> 参数必须提供。 另外如果连接数据库需要认证也需要提供<code>jdbcUserId</code> 和 <code>jdbcPassword</code> 参数。 值可以使一个文件系统的绝对路径或者是一个使用<code>&quot;classpath:&quot;</code>开头放在构建的类路径下的路径。</td>
</tr>
<tr>
<td>tableNames</td>
<td>String</td>
<td>如果指定了该参数，逗号隔开的这个表会被运行， 这些表名必须和<code>&lt;table&gt;</code> 配置中的表面完全一致。只有指定的这些表会被执行。 如果没有指定该参数，所有的表都会被执行。按如下方式指定表明:  table 、schema.table 、catalog..table 等等。</td>
</tr>
<tr>
<td>verbose</td>
<td>boolean</td>
<td>如果指定该参数，执行过程会输出到控制台。</td>
</tr>
</tbody>
</table>
<h2 id="使用生成的对象"><a href="#使用生成的对象" class="headerlink" title="使用生成的对象"></a>使用生成的对象</h2><p>MBG生成如下类型的对象：</p>
<ul>
<li>Java 模型对象</li>
<li>SQL映射文件（可选）</li>
<li>一个xxxByExample方法的使用类。</li>
</ul>
<h3 id="Java-模型对象"><a href="#Java-模型对象" class="headerlink" title="Java 模型对象"></a>Java 模型对象</h3><ul>
<li>MBG 根据数据库表字段生成Java POJO 对象。（根据表特性和配置生成不同类型的实体对象）</li>
<li>如果不使用Eclipse插件，需要手工合并修改后生成的Java对象</li>
<li>任何字段配置<code>&lt;ignoreColumn&gt;</code>,自动生成时不会添加到Java对象中</li>
</ul>
<h4 id="主键类"><a href="#主键类" class="headerlink" title="主键类"></a>主键类</h4><ul>
<li>表中包含一个主键的字段属性,根据表的列名自动生成属性名称。可配置<code>&lt;columnOverride&gt;</code>属性覆盖。</li>
<li>类名默认是<code>&lt;TableName&gt;Key</code>,如果<code>&lt;table&gt;</code>元素配置domainObjectName属性，那么类名是<code>&lt;domainObjectName&gt;Key</code></li>
<li>This class will be generated in the hierarchical model if the table has a primary key. This class will be generated in the conditional model if the table has more then one column in the primary key. This class will not be generated in the flat model.</li>
</ul>
<h4 id="记录类"><a href="#记录类" class="headerlink" title="记录类"></a>记录类</h4><ul>
<li>表中不包含主键、BLOB字段属性.如果这个类集成了主键类，MBG会根据表的列名自动生成属性名称。可通过<code>columnOverride</code>属性覆盖属性名称。</li>
<li>类名默认是<code>&lt;TableName&gt;</code>,如果<code>&lt;table&gt;</code>配置了<code>domainObjectName</code>属性，类名为<code>&lt;domainObjectName&gt;</code></li>
<li>This class will be generated in the hierarchical model if the table has non-BLOB and non-primary key columns. This class will be generated in the conditional model if the table has non-BLOB and non-primary key columns, or if there is only one primary key column or one BLOB column. This class is always generated in the flat model.</li>
</ul>
<h4 id="BLOB-记录类"><a href="#BLOB-记录类" class="headerlink" title="BLOB 记录类"></a>BLOB 记录类</h4><ul>
<li>表中包含BLOB字段属性，如果表中只存在一个字段，该类将继承基础类，或将继承主键类。（注意：MBG 不支持表中只包含BLBO列）MBG 根据表列名自动生成属性名称，可以配置<code>&lt;columnOverride&gt;</code>属性覆盖</li>
<li>BLOB 记录类调用<code>selectByPrimaryKey</code>或<code>selectByExampleWithBLOBs</code>方法返回BLOB字段值.</li>
<li>类名默认是<code>&lt;TableName&gt;WithBLOBs</code>,如果<code>&lt;table&gt;</code>配置了<code>domainObjectName</code>属性那么类名是<code>&lt;domainObjectName&gt;WithBLOBs</code>.</li>
<li>如果表中存在一个BLOB列将生成<code>hierarchical 模式</code>实体对象，如果表中存在多个BLOB列将生成<code>conditional 模式</code>实体对象。 BLOB记录类不会生<code>flat 模式</code> 实体对象</li>
</ul>
<h4 id="Example-类"><a href="#Example-类" class="headerlink" title="Example 类"></a>Example 类</h4><ul>
<li>Example类用来处理MBG动态查询功能. 下列条件方法用于动态生成WHERE子句:<ul>
<li>selectByExample</li>
<li>selectByExampleWithBLOBs</li>
<li>deleteByExample</li>
<li>countByExample</li>
<li>updateByExample</li>
</ul>
</li>
<li>Example类不继承任何实体对象</li>
<li>类名默认是<code>&lt;TableName&gt;Example</code>,如果<code>&lt;table&gt;</code>配置了<code>domainObjectName</code>属性那么类名是<code>&lt;domainObjectName&gt;Example</code>.</li>
<li>如果方法被启动Example类将生成任何*ByExample方法.注意:如果表中有非常多的字段该类可能很大,但 DAO生成的XML是比较小的. 如果您不需要使用动态WHERE子句,您可以禁用生成这些方法.</li>
</ul>
<h3 id="SQL-映射文件"><a href="#SQL-映射文件" class="headerlink" title="SQL 映射文件"></a>SQL 映射文件</h3><ul>
<li>MBG生成SQL映射文件遵循 MyBatis和IBatis DTD规范。</li>
<li>MBG按照配置表生成SQL映射文件，在表的基础上还包含了不同的标签和属性配置。</li>
<li>表名就是SQL映射文件的命名控制。（前提是数据库支持schema 和 catalog）</li>
<li>你需要手工将生成<code>xxxMapper.xml</code> 加入到<code>mybatis-conf.xml</code>文件。 或者使用Spring的自动扫描。（注入）</li>
</ul>
<h4 id="结果集-Result-Map"><a href="#结果集-Result-Map" class="headerlink" title="结果集(Result Map)"></a>结果集(Result Map)</h4><ul>
<li>resultMap元素（结果集对象）用于数据库表列映射Java对象的属性，不包括如下情况：<ul>
<li>任何列配置<code>&lt;ignoreColumn&gt;</code>属性将被会被忽略</li>
<li>任何BLOB字段</li>
</ul>
</li>
</ul>
<ul>
<li>配置<code>&lt;columnOverride&gt;</code>属性覆盖默认的属性和JDBC类型</li>
<li>对与自定义连接查询结果集<strong>继承一个结果集</strong>是一种常见的用法。对于其他连接查询也想使用（继承）该结果集。在MBG自动生成的时候需要配置前缀.详见<code>&lt;table&gt;</code>元素<code>alias</code>配置前缀，这样可以区分表中相同字段</li>
<li>如果<code>table</code>存在BLOB字段且配置了<code>enableSelectByExample</code>、<code>enableSelectByPrimaryKey</code>属性,MBG会生成BLOB结果集,table默认这两个配置都是true所以大部分情况下都会生成resultMap.</li>
</ul>
<h4 id="Where条件SQL语句"><a href="#Where条件SQL语句" class="headerlink" title="Where条件SQL语句"></a>Where条件SQL语句</h4><ul>
<li><p>This element contains a reusable where clause that is used by the “by example” methods. The where clause will not include any BLOB fields if they exist in the table. Most databases do not support BLOB fields in the WHERE clause.</p>
</li>
<li><p>This element will be generated if any of the “by example” statements are enabled.</p>
</li>
</ul>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>略，请参考官方文档。 官方文档这一部分写的也太烂了。</p>
<h3 id="Java-客户端对象"><a href="#Java-客户端对象" class="headerlink" title="Java 客户端对象"></a>Java 客户端对象</h3><ul>
<li>MBG 生成几种类型的Java客户端对象，使得Java的客户端对象更容易与生成的XML进行交互</li>
<li>生成Java客户端对象是可选的。通过配置<code>&lt;javaClientGenerator&gt;</code> MyBatis 3 生成Java客户端对象类型：<ul>
<li>XMLMAPPER 与 支持MyBatis3.x的映射</li>
</ul>
</li>
</ul>
<h4 id="通用DAO方法"><a href="#通用DAO方法" class="headerlink" title="通用DAO方法"></a>通用DAO方法</h4><p>根据表的特性，以及配置选项，Java客户端自动生成如下方法：</p>
<ul>
<li>countByExample</li>
<li>deleteByPrimaryKey</li>
<li>deleteByExample</li>
<li>insert</li>
<li>insertSelective</li>
<li>selectByPrimaryKey</li>
<li>selectByExample</li>
<li>selectByExampleWithBLOBs</li>
<li>updateByPrimaryKey (否更新BLOB字段需要重写方法)</li>
<li>updateByPrimaryKeySelective (只更新参数类非空字段)</li>
<li>updateByExample (否更新BLOB字段需要重写方法)</li>
<li>updateByExampleSelective (只更新参数类非空字段)</li>
</ul>
<p>对于包含BLOB的表,MBG通过生成不同的对象和方法使您更容易使用BLOB字段,是否忽略它们,这取决于具体情况.</p>
<h4 id="XMLMAPPER-客户端"><a href="#XMLMAPPER-客户端" class="headerlink" title="XMLMAPPER 客户端"></a>XMLMAPPER 客户端</h4><p>XMLMAPPER客户端是将接口方法映射到生成的XML映射文件中.例如,MBG自动生成的接口名为<code>MyTableMapper.</code>您可以如下使用该接口:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line">  MyTableMapper mapper = sqlSession.getMapper(MyTableMapper.class);</span><br><span class="line">  List&lt;MyTable&gt; allRecords = mapper.selectByExample(null);</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">  sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Example-用法"><a href="#Example-用法" class="headerlink" title="Example 用法"></a>Example 用法</h4><p>略，实际项目中很少用。 一般不会生成Example 对象。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2014/05/11/2014/MyBatis Generator/" itemprop="url">
                  MyBatis Generator
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2014-05-11T22:53:00+08:00" content="2014-05-11">
              2014-05-11
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Java-Web/" itemprop="url" rel="index">
                    <span itemprop="name">Java Web</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/Java-Web/MyBatis/" itemprop="url" rel="index">
                    <span itemprop="name">MyBatis</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2014/05/11/2014/MyBatis Generator/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2014/05/11/2014/MyBatis Generator/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>MyBatis 也提供了一些工具如 MyBatis Generator(<a href="http://www.mybatis.org/generator/)，可以被用来从已经存在的数据库" target="_blank" rel="external">http://www.mybatis.org/generator/)，可以被用来从已经存在的数据库</a> schema 中，产生持久化代码如数据库实体（database entities）,映射器 Mapper 接口，MapperXML 配置文件。</p>
<h2 id="MyBatis-Generator-介绍"><a href="#MyBatis-Generator-介绍" class="headerlink" title="MyBatis Generator 介绍"></a>MyBatis Generator 介绍</h2><ul>
<li>MyBatis Generator (MBG) 是一个Mybatis的代码生成器</li>
<li>它可以将数据库表生成基础对象。(不再需要手工创建对象和配置文件)</li>
<li>MBG 能够创建简单的CDUR(增删改查)。（仍然需要手写SQL和对象，用于级联查询和存储过程）</li>
</ul>
<hr>
<p>MyBatis 生成如下：</p>
<ul>
<li>匹配表结构的Java POJO 对象， 可能包括<ul>
<li>一个和表主键匹配的类（如果存在主键）</li>
<li>一个包含了非主键字段的类（BLOB字段除外）</li>
<li>一个包含BLOB字段的类（如果表包含了BLOB字段）</li>
<li>一个允许动态查询、更新和删除的类<br>这些类之间会有适当的继承关系。 可以配置生成器来生成不同类型的 POJO 的层次结构。 例如，您可能会选择针对每个表生成一个单独的实体对象。</li>
</ul>
</li>
<li>MBG在配置中为每个表简单的生成 CRUD SQL 操作。生成的SQL 语句包括：<ul>
<li>insert (插入)</li>
<li>update by primary key (根据主键更新记录)</li>
<li>update by example (根据条件更新记录)</li>
<li>delete by primary key (根据主键删除记录)</li>
<li>delete by example (根据条件删除记录)</li>
<li>select by primary key (根据主键查询记录)</li>
<li>select by example (根据条件查询记录集)</li>
<li>count by example (根据条件查询记录总数)<br>根据表的结构，生成的这些语句会有不同的变化（例如，如果表中没有主键，那么 MBG 将不会生成update by primary key方法）。</li>
</ul>
</li>
</ul>
<hr>
<ul>
<li>注意<ul>
<li>MBG 会自动合并重名XML文件（是合并，保留修改），从而可以反复运行，而不必担心修改丢失。</li>
<li>MBG 不会合并Java文件，它可以覆盖或保留不同命名的文件。Eclipse插件时，MBG自动合并Java文件。</li>
</ul>
</li>
</ul>
<h2 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h2><p>快速使用MBG步骤如下：</p>
<ul>
<li>1、创建并填写适当的配置文件，必须包含如下：(查看 XML配置参考)<ul>
<li><code>&lt;jdbcConnection&gt;</code> 元素定义如何连接目标数据库</li>
<li><code>&lt;javaModelGenerator&gt;</code> 元素来指定生成 Java 模型对象所属的包</li>
<li><code>&lt;sqlMapGenerator&gt;</code> 元素来指定生成 SQL 映射文件所属的包和的目标项目</li>
<li>(可选) <code>&lt;javaClientGenerator&gt;</code> 元素来指定目标包和目标项目生成的客户端接口和类（如果您不想生成 Java 客户端代码您可以省略<code>&lt;javaClientGenerator&gt;</code>元素）</li>
<li>至少一个数据库<code>&lt;table&gt;</code>元素</li>
</ul>
</li>
<li>2、将文件保存适当的位置（例如：<code>\temp\generatorConfig.xml</code>）</li>
<li><p>3、执行如下命令运行MBG:</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar mybatis-generator-core-x.x.x.jar -configfile \temp\generatorConfig.xml -overwrite</span><br></pre></td></tr></table></figure>
<blockquote>
<p>MBG使用配置文件运行，<code>-overwrite</code> 表示覆盖同名Java文件。如果有冲突，MBG会生成一个唯一的文件。（e.g MyClass.java）</p>
</blockquote>
</li>
<li>4、MBG运行后，你需要创建或修改标准的MyBatis配置文件来使用新生成的代码。</li>
</ul>
<h2 id="XML配置参考"><a href="#XML配置参考" class="headerlink" title="XML配置参考"></a>XML配置参考</h2><h3 id="MyBatis-Generator-XML-配置参考"><a href="#MyBatis-Generator-XML-配置参考" class="headerlink" title="MyBatis Generator XML 配置参考"></a>MyBatis Generator XML 配置参考</h3><p>如下是MBG的一个XML配置文件驱动。配置文件告诉MBG：</p>
<ul>
<li>如何链接到数据库</li>
<li>生成什么对象，及其如何生成</li>
<li>哪些表生成对象</li>
</ul>
<p><strong>如下是MBG配置文件实例。你应当查阅每一个元素说明</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE generatorConfiguration</span><br><span class="line">  PUBLIC &quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span><br><span class="line">  &quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;generatorConfiguration&gt;</span><br><span class="line">  &lt;classPathEntry location=&quot;/Program Files/IBM/SQLLIB/java/db2java.zip&quot; /&gt;</span><br><span class="line"></span><br><span class="line">  &lt;context id=&quot;DB2Tables&quot; targetRuntime=&quot;MyBatis3&quot;&gt;</span><br><span class="line">    &lt;jdbcConnection driverClass=&quot;COM.ibm.db2.jdbc.app.DB2Driver&quot;</span><br><span class="line">        connectionURL=&quot;jdbc:db2:TEST&quot;</span><br><span class="line">        userId=&quot;db2admin&quot;</span><br><span class="line">        password=&quot;db2admin&quot;&gt;</span><br><span class="line">    &lt;/jdbcConnection&gt;</span><br><span class="line"></span><br><span class="line">    &lt;javaTypeResolver &gt;</span><br><span class="line">      &lt;property name=&quot;forceBigDecimals&quot; value=&quot;false&quot; /&gt;</span><br><span class="line">    &lt;/javaTypeResolver&gt;</span><br><span class="line"></span><br><span class="line">    &lt;javaModelGenerator targetPackage=&quot;test.model&quot; targetProject=&quot;\MBGTestProject\src&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">      &lt;property name=&quot;trimStrings&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;/javaModelGenerator&gt;</span><br><span class="line"></span><br><span class="line">    &lt;sqlMapGenerator targetPackage=&quot;test.xml&quot;  targetProject=&quot;\MBGTestProject\src&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;/sqlMapGenerator&gt;</span><br><span class="line"></span><br><span class="line">    &lt;javaClientGenerator type=&quot;XMLMAPPER&quot; targetPackage=&quot;test.dao&quot;  targetProject=&quot;\MBGTestProject\src&quot;&gt;</span><br><span class="line">      &lt;property name=&quot;enableSubPackages&quot; value=&quot;true&quot; /&gt;</span><br><span class="line">    &lt;/javaClientGenerator&gt;</span><br><span class="line"></span><br><span class="line">    &lt;table schema=&quot;DB2ADMIN&quot; tableName=&quot;ALLTYPES&quot; domainObjectName=&quot;Customer&quot; &gt;</span><br><span class="line">      &lt;property name=&quot;useActualColumnNames&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">      &lt;generatedKey column=&quot;ID&quot; sqlStatement=&quot;DB2&quot; identity=&quot;true&quot; /&gt;</span><br><span class="line">      &lt;columnOverride column=&quot;DATE_FIELD&quot; property=&quot;startDate&quot; /&gt;</span><br><span class="line">      &lt;ignoreColumn column=&quot;FRED&quot; /&gt;</span><br><span class="line">      &lt;columnOverride column=&quot;LONG_VARCHAR_FIELD&quot; jdbcType=&quot;VARCHAR&quot; /&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/context&gt;</span><br><span class="line">&lt;/generatorConfiguration&gt;</span><br></pre></td></tr></table></figure></p>
<h3 id="MBG-XML-元素说明"><a href="#MBG-XML-元素说明" class="headerlink" title="MBG XML 元素说明"></a>MBG XML 元素说明</h3><p>查看官方元素说明：<a href="http://www.mybatis.org/generator/configreference/xmlconfig.html" target="_blank" rel="external">http://www.mybatis.org/generator/configreference/xmlconfig.html</a></p>
<h2 id="通过Maven-plugin-运行MBG"><a href="#通过Maven-plugin-运行MBG" class="headerlink" title="通过Maven plugin 运行MBG"></a>通过Maven plugin 运行MBG</h2><p>运行MBG 可以使用<code>命令提示符</code>、<code>Ant任务</code>、<code>Maven Plugin</code>、<code>Java程序</code>。 这里介绍Maven 形式。</p>
<h3 id="最简配置如下"><a href="#最简配置如下" class="headerlink" title="最简配置如下"></a>最简配置如下</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"> &lt;plugins&gt;</span><br><span class="line">  ...</span><br><span class="line">  &lt;plugin&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.3.2&lt;/version&gt;</span><br><span class="line">  &lt;/plugin&gt;</span><br><span class="line">  ...</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure>
<h3 id="Maven-目标（Goal）和执行（Execution）"><a href="#Maven-目标（Goal）和执行（Execution）" class="headerlink" title="Maven 目标（Goal）和执行（Execution）"></a>Maven 目标（Goal）和执行（Execution）</h3><p>MBG Maven Plugin 可以包含一个目录: <code>mybatis-generator:generate</code> ，如下配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugins&gt;</span><br><span class="line">    ...</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">      &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;</span><br><span class="line">      &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">      &lt;version&gt;1.3.2&lt;/version&gt;</span><br><span class="line">      &lt;executions&gt;</span><br><span class="line">        &lt;execution&gt;</span><br><span class="line">          &lt;id&gt;Generate MyBatis Artifacts&lt;/id&gt;</span><br><span class="line">          &lt;goals&gt;</span><br><span class="line">            &lt;goal&gt;generate&lt;/goal&gt;</span><br><span class="line">          &lt;/goals&gt;</span><br><span class="line">        &lt;/execution&gt;</span><br><span class="line">      &lt;/executions&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">    ...</span><br><span class="line">  &lt;/plugins&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>MBG插件将会绑定到Maven生命周期的 <code>generate-sources</code> 阶段。 所以他会在编译步骤之前执行。 此外注意MBG目标将绑定生成Java和XML资源文件的建立，他们都将包括在生成的JAR包内。</p>
</blockquote>
<ul>
<li><p>通过如下命令执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn mybatis-generator:generate</span><br></pre></td></tr></table></figure>
</li>
<li><p>或则 标准的Maven命令属性传递参数执行 (这条命令会是使MBG覆盖重名的文件)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn -Dmybatis.generator.overwrite=true mybatis-generator:generate</span><br></pre></td></tr></table></figure>
</li>
</ul>
<h3 id="MBG-参考参数"><a href="#MBG-参考参数" class="headerlink" title="MBG 参考参数"></a>MBG 参考参数</h3><p>如下简单参考参数实例（大多数情况下为默认设置）：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;plugins&gt;</span><br><span class="line">    &lt;plugin&gt;</span><br><span class="line">        &lt;groupId&gt;org.mybatis.generator&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;mybatis-generator-maven-plugin&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.3.2&lt;/version&gt;</span><br><span class="line">        &lt;configuration&gt;</span><br><span class="line">            &lt;configurationFile&gt;src/main/resources/generatorConfig.xml&lt;/configurationFile&gt;</span><br><span class="line">            &lt;sqlScript&gt;classpath:mbg/test/common/scripts/CreateDB.sql&lt;/sqlScript&gt;</span><br><span class="line">            &lt;jdbcDriver&gt;org.hsqldb.jdbcDriver&lt;/jdbcDriver&gt;</span><br><span class="line">            &lt;jdbcURL&gt;jdbc:hsqldb:mem:aname&lt;/jdbcURL&gt;</span><br><span class="line">            &lt;jdbcUserId&gt;sa&lt;/jdbcUserId&gt;</span><br><span class="line">            &lt;verbose&gt;true&lt;/verbose&gt;</span><br><span class="line">            &lt;overwrite&gt;true&lt;/overwrite&gt;</span><br><span class="line">             ....</span><br><span class="line">        &lt;/configuration&gt;</span><br><span class="line">    &lt;/plugin&gt;</span><br><span class="line">&lt;/plugins&gt;</span><br></pre></td></tr></table></figure></p>
<p>如下是参考参数，均为可选，部分默认。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>类型</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>configurationFile</td>
<td>File</td>
<td>指定配置文件的名称。默认值：<code>${basedir}/src/main/resources/generatorConfig.xml</code></td>
</tr>
<tr>
<td>contexts</td>
<td>String</td>
<td>如果指定了该参数，使用逗号隔开<code>context</code>会被执行。 这些指定的<code>context</code>必须和配置文件中 <code>&lt;context&gt;</code> 元素的 <code>id</code> 属性一致。只有指定的这些<code>contextid</code>会被激活执行。如果没有指定该参数，所有的<code>context</code>都会被激活执行。</td>
</tr>
<tr>
<td>jdbcDriver</td>
<td>String</td>
<td>如果您指定了 sqlScript 参数, 当连接数据库时这里的值是JDBC驱动类的权限定名称。</td>
</tr>
<tr>
<td>jdbcPassword</td>
<td>String</td>
<td>如果您指定了 <code>sqlScript</code> 参数, 这是连接数据库的密码。</td>
</tr>
<tr>
<td>jdbcURL</td>
<td>String</td>
<td>如果您指定了 <code>sqlScript</code> 参数, 这是连接数据库的<code>JDBC URL</code></td>
</tr>
<tr>
<td>jdbcUserId</td>
<td>String</td>
<td>如果您指定了 <code>sqlScript</code> 参数, 这里是连接数据库的用户<code>id</code></td>
</tr>
<tr>
<td>outputDirectory</td>
<td>File</td>
<td>将放置 MBG 所生成文件的目录。 这个目录是用于当<code>targetProject</code> 在配置文件中设置特殊值的”MAVEN”时使用(大小写敏感)。 默认值: <code>${project.build.directory}/generated-sources/mybatis-generator</code></td>
</tr>
<tr>
<td>overwrite</td>
<td>boolean</td>
<td>如果为<code>true</code>，新生成的Java文件会覆盖原有的文件。 如果没有指定该参数，存在同名的文件，MBG会给新生成的代码文件生成一个唯一的名字(例如： MyClass.java.1, MyClass.java.2 等等)。 <strong>重要: 生成器一定会自动合并或覆盖已经生成的XML文件。</strong> 默认值: <code>false</code></td>
</tr>
<tr>
<td>sqlScript</td>
<td>String</td>
<td>要在生成代码之前运行的 SQL 脚本文件的位置。 如果为空，不会执行任何脚本。 如果不为空，<code>jdbcDriver</code>, <code>jdbcURL</code> 参数必须提供。 另外如果连接数据库需要认证也需要提供<code>jdbcUserId</code> 和 <code>jdbcPassword</code> 参数。 值可以使一个文件系统的绝对路径或者是一个使用<code>&quot;classpath:&quot;</code>开头放在构建的类路径下的路径。</td>
</tr>
<tr>
<td>tableNames</td>
<td>String</td>
<td>如果指定了该参数，逗号隔开的这个表会被运行， 这些表名必须和<code>&lt;table&gt;</code> 配置中的表面完全一致。只有指定的这些表会被执行。 如果没有指定该参数，所有的表都会被执行。按如下方式指定表明:  table 、schema.table 、catalog..table 等等。</td>
</tr>
<tr>
<td>verbose</td>
<td>boolean</td>
<td>如果指定该参数，执行过程会输出到控制台。</td>
</tr>
</tbody>
</table>
<h2 id="使用生成的对象"><a href="#使用生成的对象" class="headerlink" title="使用生成的对象"></a>使用生成的对象</h2><p>MBG生成如下类型的对象：</p>
<ul>
<li>Java 模型对象</li>
<li>SQL映射文件（可选）</li>
<li>一个xxxByExample方法的使用类。</li>
</ul>
<h3 id="Java-模型对象"><a href="#Java-模型对象" class="headerlink" title="Java 模型对象"></a>Java 模型对象</h3><ul>
<li>MBG 根据数据库表字段生成Java POJO 对象。（根据表特性和配置生成不同类型的实体对象）</li>
<li>如果不使用Eclipse插件，需要手工合并修改后生成的Java对象</li>
<li>任何字段配置<code>&lt;ignoreColumn&gt;</code>,自动生成时不会添加到Java对象中</li>
</ul>
<h4 id="主键类"><a href="#主键类" class="headerlink" title="主键类"></a>主键类</h4><ul>
<li>表中包含一个主键的字段属性,根据表的列名自动生成属性名称。可配置<code>&lt;columnOverride&gt;</code>属性覆盖。</li>
<li>类名默认是<code>&lt;TableName&gt;Key</code>,如果<code>&lt;table&gt;</code>元素配置domainObjectName属性，那么类名是<code>&lt;domainObjectName&gt;Key</code></li>
<li>This class will be generated in the hierarchical model if the table has a primary key. This class will be generated in the conditional model if the table has more then one column in the primary key. This class will not be generated in the flat model.</li>
</ul>
<h4 id="记录类"><a href="#记录类" class="headerlink" title="记录类"></a>记录类</h4><ul>
<li>表中不包含主键、BLOB字段属性.如果这个类集成了主键类，MBG会根据表的列名自动生成属性名称。可通过<code>columnOverride</code>属性覆盖属性名称。</li>
<li>类名默认是<code>&lt;TableName&gt;</code>,如果<code>&lt;table&gt;</code>配置了<code>domainObjectName</code>属性，类名为<code>&lt;domainObjectName&gt;</code></li>
<li>This class will be generated in the hierarchical model if the table has non-BLOB and non-primary key columns. This class will be generated in the conditional model if the table has non-BLOB and non-primary key columns, or if there is only one primary key column or one BLOB column. This class is always generated in the flat model.</li>
</ul>
<h4 id="BLOB-记录类"><a href="#BLOB-记录类" class="headerlink" title="BLOB 记录类"></a>BLOB 记录类</h4><ul>
<li>表中包含BLOB字段属性，如果表中只存在一个字段，该类将继承基础类，或将继承主键类。（注意：MBG 不支持表中只包含BLBO列）MBG 根据表列名自动生成属性名称，可以配置<code>&lt;columnOverride&gt;</code>属性覆盖</li>
<li>BLOB 记录类调用<code>selectByPrimaryKey</code>或<code>selectByExampleWithBLOBs</code>方法返回BLOB字段值.</li>
<li>类名默认是<code>&lt;TableName&gt;WithBLOBs</code>,如果<code>&lt;table&gt;</code>配置了<code>domainObjectName</code>属性那么类名是<code>&lt;domainObjectName&gt;WithBLOBs</code>.</li>
<li>如果表中存在一个BLOB列将生成<code>hierarchical 模式</code>实体对象，如果表中存在多个BLOB列将生成<code>conditional 模式</code>实体对象。 BLOB记录类不会生<code>flat 模式</code> 实体对象</li>
</ul>
<h4 id="Example-类"><a href="#Example-类" class="headerlink" title="Example 类"></a>Example 类</h4><ul>
<li>Example类用来处理MBG动态查询功能. 下列条件方法用于动态生成WHERE子句:<ul>
<li>selectByExample</li>
<li>selectByExampleWithBLOBs</li>
<li>deleteByExample</li>
<li>countByExample</li>
<li>updateByExample</li>
</ul>
</li>
<li>Example类不继承任何实体对象</li>
<li>类名默认是<code>&lt;TableName&gt;Example</code>,如果<code>&lt;table&gt;</code>配置了<code>domainObjectName</code>属性那么类名是<code>&lt;domainObjectName&gt;Example</code>.</li>
<li>如果方法被启动Example类将生成任何*ByExample方法.注意:如果表中有非常多的字段该类可能很大,但 DAO生成的XML是比较小的. 如果您不需要使用动态WHERE子句,您可以禁用生成这些方法.</li>
</ul>
<h3 id="SQL-映射文件"><a href="#SQL-映射文件" class="headerlink" title="SQL 映射文件"></a>SQL 映射文件</h3><ul>
<li>MBG生成SQL映射文件遵循 MyBatis和IBatis DTD规范。</li>
<li>MBG按照配置表生成SQL映射文件，在表的基础上还包含了不同的标签和属性配置。</li>
<li>表名就是SQL映射文件的命名控制。（前提是数据库支持schema 和 catalog）</li>
<li>你需要手工将生成<code>xxxMapper.xml</code> 加入到<code>mybatis-conf.xml</code>文件。 或者使用Spring的自动扫描。（注入）</li>
</ul>
<h4 id="结果集-Result-Map"><a href="#结果集-Result-Map" class="headerlink" title="结果集(Result Map)"></a>结果集(Result Map)</h4><ul>
<li>resultMap元素（结果集对象）用于数据库表列映射Java对象的属性，不包括如下情况：<ul>
<li>任何列配置<code>&lt;ignoreColumn&gt;</code>属性将被会被忽略</li>
<li>任何BLOB字段</li>
</ul>
</li>
</ul>
<ul>
<li>配置<code>&lt;columnOverride&gt;</code>属性覆盖默认的属性和JDBC类型</li>
<li>对与自定义连接查询结果集<strong>继承一个结果集</strong>是一种常见的用法。对于其他连接查询也想使用（继承）该结果集。在MBG自动生成的时候需要配置前缀.详见<code>&lt;table&gt;</code>元素<code>alias</code>配置前缀，这样可以区分表中相同字段</li>
<li>如果<code>table</code>存在BLOB字段且配置了<code>enableSelectByExample</code>、<code>enableSelectByPrimaryKey</code>属性,MBG会生成BLOB结果集,table默认这两个配置都是true所以大部分情况下都会生成resultMap.</li>
</ul>
<h4 id="Where条件SQL语句"><a href="#Where条件SQL语句" class="headerlink" title="Where条件SQL语句"></a>Where条件SQL语句</h4><ul>
<li><p>This element contains a reusable where clause that is used by the “by example” methods. The where clause will not include any BLOB fields if they exist in the table. Most databases do not support BLOB fields in the WHERE clause.</p>
</li>
<li><p>This element will be generated if any of the “by example” statements are enabled.</p>
</li>
</ul>
<h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>略，请参考官方文档。 官方文档这一部分写的也太烂了。</p>
<h3 id="Java-客户端对象"><a href="#Java-客户端对象" class="headerlink" title="Java 客户端对象"></a>Java 客户端对象</h3><ul>
<li>MBG 生成几种类型的Java客户端对象，使得Java的客户端对象更容易与生成的XML进行交互</li>
<li>生成Java客户端对象是可选的。通过配置<code>&lt;javaClientGenerator&gt;</code> MyBatis 3 生成Java客户端对象类型：<ul>
<li>XMLMAPPER 与 支持MyBatis3.x的映射</li>
</ul>
</li>
</ul>
<h4 id="通用DAO方法"><a href="#通用DAO方法" class="headerlink" title="通用DAO方法"></a>通用DAO方法</h4><p>根据表的特性，以及配置选项，Java客户端自动生成如下方法：</p>
<ul>
<li>countByExample</li>
<li>deleteByPrimaryKey</li>
<li>deleteByExample</li>
<li>insert</li>
<li>insertSelective</li>
<li>selectByPrimaryKey</li>
<li>selectByExample</li>
<li>selectByExampleWithBLOBs</li>
<li>updateByPrimaryKey (否更新BLOB字段需要重写方法)</li>
<li>updateByPrimaryKeySelective (只更新参数类非空字段)</li>
<li>updateByExample (否更新BLOB字段需要重写方法)</li>
<li>updateByExampleSelective (只更新参数类非空字段)</li>
</ul>
<p>对于包含BLOB的表,MBG通过生成不同的对象和方法使您更容易使用BLOB字段,是否忽略它们,这取决于具体情况.</p>
<h4 id="XMLMAPPER-客户端"><a href="#XMLMAPPER-客户端" class="headerlink" title="XMLMAPPER 客户端"></a>XMLMAPPER 客户端</h4><p>XMLMAPPER客户端是将接口方法映射到生成的XML映射文件中.例如,MBG自动生成的接口名为<code>MyTableMapper.</code>您可以如下使用该接口:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">SqlSession sqlSession = sqlSessionFactory.openSession();</span><br><span class="line"></span><br><span class="line">try &#123;</span><br><span class="line">  MyTableMapper mapper = sqlSession.getMapper(MyTableMapper.class);</span><br><span class="line">  List&lt;MyTable&gt; allRecords = mapper.selectByExample(null);</span><br><span class="line">&#125; finally &#123;</span><br><span class="line">  sqlSession.close();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="Example-用法"><a href="#Example-用法" class="headerlink" title="Example 用法"></a>Example 用法</h4><p>略，实际项目中很少用。 一般不会生成Example 对象。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="cmp-cc" />
          <p class="site-author-name" itemprop="name">cmp-cc</p>
          <p class="site-description motion-element" itemprop="description"></p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">51</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">37</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="fa fa-rss"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/cmp-cc" target="_blank">
                  
                    <i class="fa fa-github"></i> GitHub
                  
                </a>
              </span>
            
          
        </div>

        
        

        
        <div class="links-of-blogroll motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2013 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">cmp-cc</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  


  




<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>

  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=0.5.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=0.5.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=0.5.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"cmp-cc"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();


  </script>

  
    
      <script src="/vendors/ua-parser-js/dist/ua-parser.min.js"></script>
      <script src="/js/src/hook-duoshuo.js"></script>
    
  

 <script type="text/javascript">
  window.onload = function(){setTimeout(function(){/*无登陆账户*/if(!document.getElementsByClassName("ds-account-control")[0]){var cmp_cc_blog_user=localStorage.getItem("cmp-cc_blog_user");var author_name_value = cmp_cc_blog_user?'value="'+cmp_cc_blog_user+'"':'';var i = '<div class="ds-control-group" style="float:right;padding:6px;"><input type="text" '+author_name_value+'id="author_name_proxy" id="ds-dialog-name"  class="custom_input" style="color:#777;width=80%;font-size:13px;border:1px solid #ccc;height:25px;box-shadow: inset 0 1px 1px;padding: 2px 0px 0px 8px;" placeholder="昵称 or 登陆" required></div>';/*展开一个回复，再关闭。 多说没有参数配置啊~ 让人觉得不优雅*/var $last_ds_post_reply = $(".ds-post-reply:last");$last_ds_post_reply.click().click();$(".ds-post-options.ds-gradient-bg").append(i);$(".ds-post-button").click(function(){$(this).submit();$("#ds-wrapper").hide();var author_name = $("#author_name_proxy").val();$("#ds-wrapper #ds-dialog-name").val(author_name);$("#ds-wrapper form").submit();/*www.cmp-cc.github.com*/localStorage.setItem("cmp-cc_blog_user",author_name);$(".custom_input").val(author_name);});}},300);} 
 </script>





  
  
  

  

  
<script type="text/javascript" async src="//push.zhanzhang.baidu.com/push.js">
</script>


</body>
</html>
